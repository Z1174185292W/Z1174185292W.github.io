<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":true,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="WEB后端服务第11天【注意】在使用pycharm工具编写Django等框架时，首先在Settings&gt;Languages &amp; Frameworks&gt;下配置Django或其他框架的支持，以便在使用Python Console时更加兼容。常用的配置还有Template Languages，其他按需配置。 一、Django入门1.1 基本概念1.2 创建环境与app项目安装依赖包">
<meta property="og:type" content="article">
<meta property="og:title" content="python-web-django">
<meta property="og:url" content="http://example.com/2022/08/17/python-web-flask-3/index.html">
<meta property="og:site_name" content="PeacefulRace">
<meta property="og:description" content="WEB后端服务第11天【注意】在使用pycharm工具编写Django等框架时，首先在Settings&gt;Languages &amp; Frameworks&gt;下配置Django或其他框架的支持，以便在使用Python Console时更加兼容。常用的配置还有Template Languages，其他按需配置。 一、Django入门1.1 基本概念1.2 创建环境与app项目安装依赖包">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-08-17T02:53:05.661Z">
<meta property="article:modified_time" content="2022-08-17T03:33:12.588Z">
<meta property="article:author" content="Private">
<meta property="article:tag" content="python-web">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2022/08/17/python-web-flask-3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>python-web-django | PeacefulRace</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">PeacefulRace</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">学习笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">6</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">26</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/17/python-web-flask-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Private">
      <meta itemprop="description" content="程序语言记录">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PeacefulRace">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          python-web-django
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-08-17 10:53:05 / 修改时间：11:33:12" itemprop="dateCreated datePublished" datetime="2022-08-17T10:53:05+08:00">2022-08-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="WEB后端服务第11天"><a href="#WEB后端服务第11天" class="headerlink" title="WEB后端服务第11天"></a>WEB后端服务第11天</h1><p>【注意】在使用pycharm工具编写Django等框架时，首先在Settings&gt;Languages &amp; Frameworks&gt;下配置Django或其他框架的支持，以便在使用Python Console时更加兼容。常用的配置还有Template Languages，其他按需配置。</p>
<h2 id="一、Django入门"><a href="#一、Django入门" class="headerlink" title="一、Django入门"></a>一、Django入门</h2><h3 id="1-1-基本概念"><a href="#1-1-基本概念" class="headerlink" title="1.1 基本概念"></a>1.1 基本概念</h3><h3 id="1-2-创建环境与app项目"><a href="#1-2-创建环境与app项目" class="headerlink" title="1.2 创建环境与app项目"></a>1.2 创建环境与app项目</h3><p>安装依赖包</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django==<span class="number">2.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>进入““终端”CMD命令，通过django-admin命令创建django项目。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject helloDjango</span><br></pre></td></tr></table></figure>

<p>通过django-admin命令创建app应用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startapp mainapp</span><br></pre></td></tr></table></figure>

<p>在一个Django项目中，存在很多的app应用（模块），创建好的app需要注册到主工程中（settings.py）</p>
<h3 id="1-3-django项目结构"><a href="#1-3-django项目结构" class="headerlink" title="1.3 django项目结构"></a>1.3 django项目结构</h3><p>项目结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">helloDjango</span><br><span class="line">	|--- helloDjango 主工程目录</span><br><span class="line">		|--- settings.py	设置文件，数据库连接，app注册，中间件及模板配置</span><br><span class="line">		|--- urls.py	总路由</span><br><span class="line">		|--- wsgi.py	Django实现wsgi的脚本</span><br><span class="line">		|--- __init__.py</span><br><span class="line">	|--- mainapp	应用模块（主）</span><br><span class="line">		|--- __init__.py</span><br><span class="line">		|--- admin.py	# 后台管理配置脚本</span><br><span class="line">		|--- models.py	# 数据模型类声明所在脚本</span><br><span class="line">		|--- views.py	# 声明当前应用的视图处理函数或类</span><br><span class="line">		|--- urls.py	# 自己增加的当前应用模块的子路由</span><br><span class="line">		|--- tests.py	# 当前应用模块的单元测试类</span><br><span class="line">		|--- apps.py	# 声明当前应用的基本信息</span><br><span class="line">	|--- manage.py	 WEB应用的启动脚本，项目工程的入口</span><br></pre></td></tr></table></figure>

<h3 id="1-4-Django请求流程"><a href="#1-4-Django请求流程" class="headerlink" title="1.4 Django请求流程"></a>1.4 Django请求流程</h3><ol>
<li>到urls分发器</li>
<li>urls分发器根据路由规则（正则）分发到views</li>
<li>views去调用Model，交互数据</li>
<li>views将数据渲染到模板中</li>
<li>模板呈现给用户</li>
</ol>
<h2 id="二、数据库连接与ORM模型"><a href="#二、数据库连接与ORM模型" class="headerlink" title="二、数据库连接与ORM模型"></a>二、数据库连接与ORM模型</h2><h3 id="2-1-数据库连接配置"><a href="#2-1-数据库连接配置" class="headerlink" title="2.1 数据库连接配置"></a>2.1 数据库连接配置</h3><p>默认是sqlite3数据库，在使用ORM模型之前，需要先生成迁移文件，再执行迁移命令，在数据库中生成这些模型对应的表。</p>
<ul>
<li>先生成迁移文件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br></pre></td></tr></table></figure>

<ul>
<li>开始迁移（生成表、修改表、删除表）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<p>注意：一旦生成了迁移文件并且迁移成功之后，不要删除迁移文件。</p>
<h3 id="2-2-初步使用ORM模型"><a href="#2-2-初步使用ORM模型" class="headerlink" title="2.2 初步使用ORM模型"></a>2.2 初步使用ORM模型</h3><p>在app模块中的models.py定义一个用户（客户）模型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserEntity</span>(models.Model):</span><br><span class="line">    <span class="comment"># 默认情况下会自动创建id主键</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    age = models.IntegerField(default=<span class="number">0</span>)</span><br><span class="line">    phone = models.CharField(max_length=<span class="number">11</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        <span class="comment"># 指定当前模型类映射成哪一个表</span></span><br><span class="line">        db_table = <span class="string">&#x27;app_user&#x27;</span></span><br></pre></td></tr></table></figure>

<p>模型创建完成后，先后执行生成迁移文件和迁移。</p>
<h3 id="2-3-CURD"><a href="#2-3-CURD" class="headerlink" title="2.3 CURD"></a>2.3 CURD</h3><p>查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserEntity.objects.<span class="built_in">all</span>()	<span class="comment"># 查询所有</span></span><br><span class="line">UserEntity.objects.get(pk=<span class="built_in">id</span>)	<span class="comment"># 根据主键值查询一个实体对象</span></span><br></pre></td></tr></table></figure>

<p>增加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">u = UserEntity()</span><br><span class="line">u.name = <span class="string">&#x27;disen&#x27;</span></span><br><span class="line">u.age = <span class="number">20</span></span><br><span class="line">u.phone = <span class="string">&#x27;177&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存模型对象</span></span><br><span class="line">u.save()</span><br></pre></td></tr></table></figure>

<p>删除</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u = UserEntity.objects.get(<span class="number">1</span>)</span><br><span class="line">u.delete() <span class="comment"># 删除</span></span><br></pre></td></tr></table></figure>

<p>更新</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">u = UserEntity.objects.get(<span class="number">3</span>)</span><br><span class="line">u.name = <span class="string">&#x27;cheng&#x27;</span></span><br><span class="line">u.save()</span><br></pre></td></tr></table></figure>

<h2 id="三、Admin的site站点配置"><a href="#三、Admin的site站点配置" class="headerlink" title="三、Admin的site站点配置"></a>三、Admin的site站点配置</h2><h2 id="四、综合案例-水果管理"><a href="#四、综合案例-水果管理" class="headerlink" title="四、综合案例-水果管理"></a>四、综合案例-水果管理</h2><h3 id="3-1-模型设计"><a href="#3-1-模型设计" class="headerlink" title="3.1 模型设计"></a>3.1 模型设计</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Fruit 水果模型类（name, price, source, cate_type_id）</span><br><span class="line"># FruitImage 水果图片模型类(fruit_id, url, width, height, name)</span><br><span class="line"># CateType 水果分类(name, order_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Store 水果商店(name, name, boss_name, phone, address, city, lat, lon)</span><br><span class="line"># StoreDetail 水果商店的详情</span><br></pre></td></tr></table></figure>

<h3 id="3-2-模板的基本使用"><a href="#3-2-模板的基本使用" class="headerlink" title="3.2 模板的基本使用"></a>3.2 模板的基本使用</h3><p>循环语句块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for item in items %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>分支循环</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if 条件表达式 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; 变量名 &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>在views.py视图函数中，渲染模板</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> render(request, <span class="string">&#x27;fruit/list.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<h3 id="3-3-页面设计"><a href="#3-3-页面设计" class="headerlink" title="3.3 页面设计"></a>3.3 页面设计</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% block name %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br></pre></td></tr></table></figure>

<h1 id="WEB后端服务第12天-Django第二天"><a href="#WEB后端服务第12天-Django第二天" class="headerlink" title="WEB后端服务第12天-Django第二天"></a>WEB后端服务第12天-Django第二天</h1><h2 id="一、ORM模型之字段类型和约束"><a href="#一、ORM模型之字段类型和约束" class="headerlink" title="一、ORM模型之字段类型和约束"></a>一、ORM模型之字段类型和约束</h2><h3 id="1-1-字段类型"><a href="#1-1-字段类型" class="headerlink" title="1.1 字段类型"></a>1.1 字段类型</h3><h3 id="1-2-约束"><a href="#1-2-约束" class="headerlink" title="1.2 约束"></a>1.2 约束</h3><h3 id="1-3-FileField和ImageField"><a href="#1-3-FileField和ImageField" class="headerlink" title="1.3 FileField和ImageField"></a>1.3 FileField和ImageField</h3><p>文件字段和图片字段都属于MEDIA的多媒体类型的文件，需要在settings.py设置脚本中指定MEDIA_ROOT、MEDIA_URL、STATIC_URL、STATICFILES_DIRS</p>
<p>注意：使用ImageField时，必须安装Pillow库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pillow</span><br></pre></td></tr></table></figure>

<p>扩展：github: <a target="_blank" rel="noopener" href="https://github.com/disenQF/StoreOA.git">https://github.com/disenQF/StoreOA.git</a></p>
<h2 id="二、模型的Meta元信息"><a href="#二、模型的Meta元信息" class="headerlink" title="二、模型的Meta元信息"></a>二、模型的Meta元信息</h2><p>在模型类中，声明内部类Meta，类成员可以如下的变量：</p>
<ul>
<li>db_table</li>
<li>ordering</li>
<li>verbose_name</li>
<li>verbose_name_plural</li>
<li>unique_together</li>
<li>abstract 布尔类型，表示当前的模型类是否为抽象类，如果是抽象类，则不会创建表。</li>
</ul>
<h3 id="3-渲染模板的render-方法有哪些参数，分别代表什么含义"><a href="#3-渲染模板的render-方法有哪些参数，分别代表什么含义" class="headerlink" title="3. 渲染模板的render()方法有哪些参数，分别代表什么含义"></a>3. 渲染模板的render()方法有哪些参数，分别代表什么含义</h3><ul>
<li>request请求对象，是django.http.HttpRequest类的对象</li>
<li>模板的html文件，是字符串类型，文件位置相对于templates目录的。</li>
<li>context上下文，是dict字典类型，可以使用locals()将本地的变量转成字典对象。</li>
</ul>
<h2 id="三、CURD深度使用"><a href="#三、CURD深度使用" class="headerlink" title="三、CURD深度使用"></a>三、CURD深度使用</h2><h3 id="3-1-了解模型类中的objects是什么？"><a href="#3-1-了解模型类中的objects是什么？" class="headerlink" title="3.1 了解模型类中的objects是什么？"></a>3.1 了解模型类中的objects是什么？</h3><p>默认情况下，由创建模型类的元类在模型类中创建django.db.models.Manager类的对象，并赋给objects。Manager类实际是QuerySet类的子类。</p>
<p>可以在模型类中，创建objects，但是必须为Manager类对象。不能是普通的字段。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CateTypeEntity</span>(models.Model):</span><br><span class="line">	name = models.CharField(max_length)</span><br><span class="line">	<span class="comment"># objects = models.IntegerField(default=0)  # 错误的写法</span></span><br><span class="line">	objects = models.Manager()  <span class="comment"># 正确的写法</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-filter和exclude查询"><a href="#3-2-filter和exclude查询" class="headerlink" title="3.2 filter和exclude查询"></a>3.2 filter和exclude查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">模型类.objects.<span class="built_in">filter</span>(属性名__条件=条件值)</span><br><span class="line">模型类.objects.<span class="built_in">filter</span>(属性名=条件值)</span><br><span class="line">模型类.objects.<span class="built_in">filter</span>(属性名__时间标签__条件=条件值)</span><br></pre></td></tr></table></figure>

<p><strong>条件</strong>包含</p>
<ul>
<li>大于gt、小于lt、大于等于gte、小于等于lte</li>
<li>字符串相关：contains包含（区分大小写），icontains，(i)startswith、(i)endswith</li>
<li>null相关：isnull()、isnotnull()</li>
<li>范围：in</li>
</ul>
<p><strong>时间属性</strong>包含</p>
<ul>
<li>year, month, day</li>
<li>hour, minute, second</li>
</ul>
<h3 id="3-3-QuerySet对象的方法"><a href="#3-3-QuerySet对象的方法" class="headerlink" title="3.3 QuerySet对象的方法"></a>3.3 QuerySet对象的方法</h3><p>QuerySet对象的本身是可以被迭代的。</p>
<p>返回QuerySet对象的方法有：</p>
<ul>
<li>filter()</li>
<li>exclude()</li>
<li>all()</li>
<li>value()</li>
<li>values_list()</li>
<li>order_by(‘name’, ‘-city’)</li>
</ul>
<p>统计方法和判断是否存在数据方法</p>
<ul>
<li>count()</li>
<li>exists()</li>
</ul>
<h1 id="WEB后端服务第13天-Django第三天"><a href="#WEB后端服务第13天-Django第三天" class="headerlink" title="WEB后端服务第13天-Django第三天"></a>WEB后端服务第13天-Django第三天</h1><p>官方文档：<a target="_blank" rel="noopener" href="http://docs.djangoproject.com/zh-hans/2.1/">http://docs.djangoproject.com/zh-hans/2.1/</a></p>
<h2 id="一、F和Q的用法"><a href="#一、F和Q的用法" class="headerlink" title="一、F和Q的用法"></a>一、F和Q的用法</h2><p>1.1 F的选择字段值</p>
<p>django.db.models.F用于获取字段的值并参与计算或作业更新条件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FruitEntity.objects.update(price=F(<span class="string">&#x27;price&#x27;</span>) * <span class="number">0.88</span>)  <span class="comment"># 全场8.8折</span></span><br></pre></td></tr></table></figure>

<p>1.2 Q的多条件</p>
<p>Q是用来指定多个查询条件的逻辑关系：与 &amp;，或 |，非 -</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询价格低于1的，或高于200的水果, 或原产地是xian且名字中包含“果”</span></span><br><span class="line">    fruits2 = FruitEntity.objects.<span class="built_in">filter</span>(</span><br><span class="line">        Q(price__lte=<span class="number">1</span>) | Q(price__gte=<span class="number">200</span>) | Q(Q(source=<span class="string">&#x27;xian&#x27;</span>) &amp; Q(name__contains=<span class="string">&quot;果&quot;</span>))).values()</span><br></pre></td></tr></table></figure>



<h2 id="二、原生的SQL语句查询"><a href="#二、原生的SQL语句查询" class="headerlink" title="二、原生的SQL语句查询"></a>二、原生的SQL语句查询</h2><p>针对复杂查询来说，通过QuerySet查询不是特别方便，则使用原生的SQL查询。</p>
<ul>
<li><p>QuerySet提供两种原生SQL查询：</p>
<ol>
<li><p>QuerySet.raw()</p>
<p>要求：查询的字段必须是模型类中声明的字段，且必须存在主键列。查询的结果是RawQuerySet类对象，可以迭代，元素类型是模型类对象。</p>
<p>另外，查询sql语句中可以使用”%s”或”%(name)s”占位符，在其后可以使用元组或字典参数传值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">raw_queryset = FruitEntity.objects.raw(<span class="string">&#x27;select id, name, price from t_fruit where price &lt; %s order by price DESC LIMIT %s, 5&#x27;</span>, (<span class="number">10</span>, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> raw_queryset:</span><br><span class="line">    <span class="built_in">print</span>(fruit)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raw_queryset = FruitEntity.objects.raw(<span class="string">&#x27;select id, name, price from t_fruit where price &lt; %(price)s order by price DESC LIMIT %(page)s, 5&#x27;</span>, &#123;<span class="string">&#x27;price&#x27;</span>:<span class="number">10</span>, <span class="string">&#x27;page&#x27;</span>:<span class="number">0</span>&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>QuerySet.extra()</p>
<p>extra()扩展查询，针对QuerySet查询结果集中，额外增加查询条件或排序等相关操作。返回结果还是<strong>QuerySet</strong>对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">qs1 = FruitEntity.objects.extra(where=[<span class="string">&#x27;price&lt;%s&#x27;</span>], params=[<span class="string">&#x27;10&#x27;</span>])</span><br><span class="line"></span><br><span class="line">qs2 = FruitEntity.objects.extra(where=[<span class="string">&#x27;price&lt;%s or name like %s&#x27;</span>], params=[<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;果&#x27;</span>])</span><br><span class="line"></span><br><span class="line">qs3 = FruitEntity.objects.extra(where=[<span class="string">&#x27;price&lt;%s or name like %s&#x27;</span>, <span class="string">&#x27;source=%s&#x27;</span>], params=[<span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;果&#x27;</span>, <span class="string">&#x27;xian&#x27;</span>])</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>使用django.db.connection数据库连接对象进行原生SQL查询。</p>
<p>connection对象表示与数据库连接的对象，可以通过connection连接对象获取游标cursor对象，再通过cursor的execute()/fetchall()/rowcount相关方法或函数来执行原生的SQL和执行结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cursor = connection.cursor()</span><br><span class="line">cursor.execute(<span class="string">&#x27;select * from t_fruit&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">	<span class="built_in">print</span>(row)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cursor.execute(<span class="string">&#x27;update t_fruit set price=2 where id=1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(cursor.rowcount)</span><br><span class="line">connection.commit()  <span class="comment"># 提交更新</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="三、模型类之间的关系"><a href="#三、模型类之间的关系" class="headerlink" title="三、模型类之间的关系"></a>三、模型类之间的关系</h2><h3 id="3-1-扩展：显性方式创建objects"><a href="#3-1-扩展：显性方式创建objects" class="headerlink" title="3.1 扩展：显性方式创建objects"></a>3.1 扩展：显性方式创建objects</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OrderManager</span>(models.Manager):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">get_queryset</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().get_queryset().<span class="built_in">filter</span>(~models.Q(pay_status=<span class="number">5</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计2018年全年销售总额</span></span><br><span class="line">OrderModel.objects.<span class="built_in">filter</span>(create_time__year=<span class="number">2018</span>).aggregate(total_price=Sum(<span class="string">&#x27;price&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="3-2-一对一关系"><a href="#3-2-一对一关系" class="headerlink" title="3.2 一对一关系"></a>3.2 一对一关系</h3><p>一对一的关系可以通过models.OneToOneField(关联模型类, on_delete=models.CASCADE)建立，on_delete除了CASCADE级联删除之外，还有models.SET_NULL级联设置为null。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RealProfile</span>(models.Model):</span><br><span class="line">    <span class="comment"># 声明一对一的关联关系</span></span><br><span class="line">    user = models.OneToOneField(UserEntity, verbose_name=<span class="string">&#x27;账号&#x27;</span>, on_delete=models.CASCADE)</span><br><span class="line">    real_name = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;真实姓名&#x27;</span>)</span><br><span class="line">    number = models.CharField(max_length=<span class="number">30</span>, verbose_name=<span class="string">&#x27;证件号&#x27;</span>)</span><br><span class="line">    real_type = models.IntegerField(verbose_name=<span class="string">&#x27;证件类型&#x27;</span>, choices=((<span class="number">0</span>, <span class="string">&#x27;身份证&#x27;</span>), (<span class="number">1</span>, <span class="string">&#x27;护照&#x27;</span>), (<span class="number">2</span>, <span class="string">&#x27;驾驶证&#x27;</span>)))</span><br><span class="line">    image1 = models.ImageField(upload_to=<span class="string">&#x27;user/real&#x27;</span>, verbose_name=<span class="string">&#x27;正面照&#x27;</span>)</span><br><span class="line">    image2 = models.ImageField(upload_to=<span class="string">&#x27;user/real&#x27;</span>, verbose_name=<span class="string">&#x27;反面照&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>主表：用户表，从表：实名认证表</p>
<p>从表对象获取主表的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u1 = RealProfile.objects.<span class="built_in">filter</span>(real_name=<span class="string">&#x27;狄青&#x27;</span>).first()</span><br><span class="line">u1.user.phone  <span class="comment"># 直接访问主表对象的数据</span></span><br></pre></td></tr></table></figure>

<p>主表中获取从表的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">login_u1 = UserEntity.objects.get(pk=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 以隐性方式 读取从表的数据：对象.关联模型类全小写名称.属性</span></span><br><span class="line">login_u1.realprofile.number  <span class="comment"># realprofile 一对一的关系模型类的名称（全小写）</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-一对多或多对一的关系"><a href="#3-3-一对多或多对一的关系" class="headerlink" title="3.3 一对多或多对一的关系"></a>3.3 一对多或多对一的关系</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 声明水果商品与购物车的关系表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FruitCartEntity</span>(models.Model):</span><br><span class="line">    cart = models.ForeignKey(CartEntity, on_delete=models.CASCADE, verbose_name=<span class="string">&#x27;购物车&#x27;</span>)</span><br><span class="line">    fruit = models.ForeignKey(FruitEntity, on_delete=models.CASCADE, verbose_name=<span class="string">&#x27;水果名&#x27;</span>)</span><br><span class="line">    cnt = models.IntegerField(verbose_name=<span class="string">&#x27;数量&#x27;</span>, default=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.fruit.name + <span class="string">&#x27;:&#x27;</span> + self.cart.no</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">price1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.fruit.price  <span class="comment"># 从获取主的对象属性</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">price</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 属性方法在后台显示时没有verbose_name，如何解决？</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">round</span>(self.fruit.price * self.cnt, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;t_fruit_cart&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;购物车详情表&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主读取多个从对象的信息</span></span><br><span class="line">login_u = UserEntity.objects.get(pk=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 查询当前用户的购物车中的所有商品及数量相关的信息</span></span><br><span class="line">cart_fruit = login_u.cartentity.fruitcartentity_set.<span class="built_in">all</span>()</span><br><span class="line"><span class="keyword">for</span> fruit_cart <span class="keyword">in</span> cart_fruits:</span><br><span class="line">    <span class="built_in">print</span>(fruit_cart.fruit.name, fruit_cart.fruit.price, fruit_cart.cnt)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-4-多对多"><a href="#3-4-多对多" class="headerlink" title="3.4 多对多"></a>3.4 多对多</h3><p>models.ManyToManyField()</p>
<h1 id="WEB后端服务第14天-Django第四天"><a href="#WEB后端服务第14天-Django第四天" class="headerlink" title="WEB后端服务第14天-Django第四天"></a>WEB后端服务第14天-Django第四天</h1><h2 id="一、模型关系的深入应用"><a href="#一、模型关系的深入应用" class="headerlink" title="一、模型关系的深入应用"></a>一、模型关系的深入应用</h2><h3 id="1-1-多对多的应用"><a href="#1-1-多对多的应用" class="headerlink" title="1.1 多对多的应用"></a>1.1 多对多的应用</h3><p>需求：用户收藏商品，需要建立第三方表，完成用户收藏多个商品，或一个商品被多位用户收藏。</p>
<p>在FruitEntity模型类中，增加users属性，内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认情况下，反向引用的名称是当前类的名称（小写）_set，可以通过related_name来指定</span></span><br><span class="line">    <span class="comment"># db_table=&#x27;t_collect&#x27; 使用第三张表建立fruit和user的多对多关系</span></span><br><span class="line">    users = models.ManyToManyField(UserEntity, db_table=<span class="string">&#x27;t_collect&#x27;</span>, related_name=<span class="string">&#x27;fruits&#x27;</span>, verbose_name=<span class="string">&#x27;收藏用户列表&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>当迁移完成后，模拟用户收藏商品：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">u1 = UserEntity.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">u1.fruits.add(FruitEntity.objects.get(pk=<span class="number">1</span>))</span><br><span class="line">u1.fruits.add(FruitEntity.objects.get(pk=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">u2 = UserEntity.objects.get(pk=<span class="number">2</span>)</span><br><span class="line">u2.fruits.add(FruitEntity.objects.get(pk=<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<p>查看某一件商品，被哪些用户收藏</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fruit1 = FruitEntity.objects.get(pk=<span class="number">2</span>)</span><br><span class="line">fruit1.users.<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>

<p>用户取消收藏商品</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u1.fruits.remove(FruitEntity.objects.get(pk=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<p>任务：增加标签模型类（id, name, order_num）并且和商品建立多对多的关系</p>
<p>问题：模型类自关联</p>
<h2 id="二、模板语法"><a href="#二、模板语法" class="headerlink" title="二、模板语法"></a>二、模板语法</h2><h3 id="2-1-MTV设计中TV的关系"><a href="#2-1-MTV设计中TV的关系" class="headerlink" title="2.1 MTV设计中TV的关系"></a>2.1 MTV设计中TV的关系</h3><ul>
<li>V视图处理函数可以渲染（使用）多个模板</li>
<li>一个模板T可以被任意的V视图函数使用</li>
</ul>
<h3 id="2-2-模板的加载过程"><a href="#2-2-模板的加载过程" class="headerlink" title="2.2 模板的加载过程"></a>2.2 模板的加载过程</h3><p>模板加载对象：django.template.loader</p>
<ul>
<li><p>加载</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">template = loader.get_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>渲染</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html = template.render(context)  <span class="comment"># context是一个dict类型对象</span></span><br></pre></td></tr></table></figure></li>
<li><p>加载+渲染</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html = loader.render_to_string(<span class="string">&quot;index.html&quot;</span>, context)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-3-模板中使用“-”点语法"><a href="#2-3-模板中使用“-”点语法" class="headerlink" title="2.3 模板中使用“.”点语法"></a>2.3 模板中使用“.”点语法</h3><p>使用“.”访问变量Variable的属性，系统尝试以下顺序查询：</p>
<ul>
<li><p>字典</p>
</li>
<li><p>属性或方法</p>
</li>
<li><p>列表的数值索引</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: green&quot;</span>&gt;</span></span><br><span class="line">        第三个用户名：&#123;&#123; users.2.name &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span></span><br><span class="line">        请客的人：&#123;&#123; error_index &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: white; background-color: blue;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>VIP:<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; vip.name.upper &#125;&#125;-&#123;&#123; vip.money &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for key, value in vip.items %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; key &#125;&#125; = &#123;&#123; value &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">user_list3</span>(<span class="params">request</span>):</span><br><span class="line">    users = UserEntity.objects.<span class="built_in">all</span>()</span><br><span class="line">    msg = <span class="string">&#x27;the best&#x27;</span></span><br><span class="line"></span><br><span class="line">    error_index = random.randint(<span class="number">0</span>, users.count()-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    vip = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;disen&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;money&#x27;</span>: <span class="number">20000</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># # 加载模板</span></span><br><span class="line">    <span class="comment"># template = loader.get_template(&#x27;user/list.html&#x27;)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># # 渲染模板</span></span><br><span class="line">    <span class="comment"># html = template.render(context=&#123;</span></span><br><span class="line">    <span class="comment">#     &#x27;msg&#x27;: msg,</span></span><br><span class="line">    <span class="comment">#     &#x27;users&#x27;: users,</span></span><br><span class="line">    <span class="comment"># &#125;)</span></span><br><span class="line"></span><br><span class="line">    html = loader.render_to_string(<span class="string">&#x27;user/list.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(html, status=<span class="number">200</span>)  <span class="comment"># 增加响应头？？</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-4-表达式标签"><a href="#2-4-表达式标签" class="headerlink" title="2.4 表达式标签"></a>2.4 表达式标签</h3><ul>
<li><p><code>&#123;% if 条件 %&#125; &#123;% endif %&#125;</code></p>
<ul>
<li>条件表达式支持关系运算符<ul>
<li>or</li>
<li>and</li>
<li>not</li>
<li>in</li>
<li>==、!=、&gt;、&lt;、&gt;=、&lt;=</li>
</ul>
</li>
</ul>
</li>
<li><p><code>&#123;% ifequal 值1 值2 %&#125; &#123;% endifequal %&#125;</code></p>
</li>
<li><p><code>&#123;% ifnotequal 值1 值2 %&#125; &#123;% endifnotequal %&#125;</code></p>
<p>The <code>&#123;% ifequal %&#125; and &#123;% ifnotequal %&#125;</code>template tags are removed in django4.0.</p>
</li>
<li><p><code>&#123;% for 变量 in 可迭代对象 %&#125;  &#123;% endfor %&#125;</code></p>
<ul>
<li><code>&#123;% empty %&#125;</code>当可迭代对象为空（非None），显示empty标签下面的内容</li>
<li><code>&#123;% cycle  值1 值2 值3 值4 %&#125;</code></li>
<li><code>&#123;&#123; forloop.counter &#125;&#125;</code> 循环计数器，从1开始</li>
</ul>
</li>
<li><p>注释：渲染模板之后不会存在</p>
<ul>
<li><code>&#123;# 单行注释 #&#125;</code></li>
<li><code>&#123;% comment %&#125; 多行注释的文本 &#123;% endcomment %&#125;</code></li>
</ul>
</li>
<li><p>escape 安全标签</p>
<ul>
<li><code>&#123;% autoescape on|off %&#125;</code> 开启escape时，会将变量的 大于号、小于号、单引号、双引号及&amp;等转成escape的表示，如大于号为 &amp;gt;</li>
<li><code>&#123;&#123; info|escape &#125;&#125;</code> escape也可以换成safe表示不转换escape.</li>
</ul>
</li>
</ul>
<h3 id="2-5-模板的过滤器"><a href="#2-5-模板的过滤器" class="headerlink" title="2.5 模板的过滤器"></a>2.5 模板的过滤器</h3><ul>
<li><p>数值运算</p>
<ul>
<li>| add:5</li>
<li>| add:-5</li>
<li>| divisibleby:2</li>
<li>| <code>&#123;% widthratio 变量 分母 分子 %&#125;</code></li>
</ul>
</li>
<li><p>字符串</p>
</li>
<li><p>格式化</p>
<ul>
<li><p>日期格式化</p>
<p><code>now|date:&quot;Y-m-d H:i:s&quot;</code></p>
</li>
<li><p>文件大小格式化</p>
<p><code>file_size|filesizeformat</code></p>
</li>
<li><p>小数值格式化</p>
<figure class="highlight plaintext"><figcaption><span>默认n是1位小数</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 列表</span><br><span class="line"></span><br><span class="line">- HTML转义</span><br><span class="line"></span><br></pre></td></tr></table></figure>
 不转义
 转义，显示html源码标签
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 默认值</span><br><span class="line"></span><br><span class="line">### 2.6 自定义过滤器</span><br><span class="line"></span><br><span class="line">在app的init.py脚本编写</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from django.template.defaultfilters import register</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">@register.filter(&#x27;ellipse&#x27;)</span><br><span class="line">def ellipse(value):</span><br><span class="line">    return os.path.split(value)[-1]</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="2-7-扩展：os-stat-获取文件大小"><a href="#2-7-扩展：os-stat-获取文件大小" class="headerlink" title="2.7 扩展：os.stat()获取文件大小"></a>2.7 扩展：os.stat()获取文件大小</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file_dir = os.path.join(settings.BASE_DIR, <span class="string">&#x27;mainapp/&#x27;</span>)</span><br><span class="line">    files = &#123; file_name:os.stat(</span><br><span class="line">        file_dir+file_name) <span class="keyword">for</span> file_name <span class="keyword">in</span> os.listdir(file_dir) <span class="keyword">if</span> os.path.isfile(file_dir+file_name) &#125;</span><br></pre></td></tr></table></figure>

<h1 id="WEB后端服务第15天-Django第五天"><a href="#WEB后端服务第15天-Django第五天" class="headerlink" title="WEB后端服务第15天-Django第五天"></a>WEB后端服务第15天-Django第五天</h1><h2 id="一、csrf（防止跨站请求伪造）"><a href="#一、csrf（防止跨站请求伪造）" class="headerlink" title="一、csrf（防止跨站请求伪造）"></a>一、csrf（防止跨站请求伪造）</h2><h3 id="1-1-csrf-token标签"><a href="#1-1-csrf-token标签" class="headerlink" title="1.1 csrf_token标签"></a>1.1 csrf_token标签</h3><p>在模板的<code>&lt;form&gt;</code>内部使用即可，会生成隐藏字段，名称为csrfmiddlewaretoken，它的值是在渲染模板时产生的，并存储在session，当表单提交到后端时，通过csrfMiddleWare中间件验证。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;form&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：只针对post请求</p>
<p>扩展1：make_password和check_password</p>
<p>扩展2：request.session</p>
<h3 id="1-2-取消csrf"><a href="#1-2-取消csrf" class="headerlink" title="1.2 取消csrf"></a>1.2 取消csrf</h3><ul>
<li>在settings.py的中间件的配置中，将CsrfViewMiddleware删除</li>
<li><code>@csrf_exempt</code>装饰view处理函数</li>
</ul>
<h2 id="二、模板布局标签"><a href="#二、模板布局标签" class="headerlink" title="二、模板布局标签"></a>二、模板布局标签</h2><h3 id="2-1-block-extends-include"><a href="#2-1-block-extends-include" class="headerlink" title="2.1 block/extends/include"></a>2.1 block/extends/include</h3><h3 id="2-2-显示父模板的内容"><a href="#2-2-显示父模板的内容" class="headerlink" title="2.2 显示父模板的内容"></a>2.2 显示父模板的内容</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; block.super &#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、app模块内部模板"><a href="#三、app模块内部模板" class="headerlink" title="三、app模块内部模板"></a>三、app模块内部模板</h2><ul>
<li>每个app下都可以增加templates目录，存放它自己的模板文件</li>
<li>内部的模板templates目录，不需要在settings.py中设置</li>
<li>如果app模块之外存在templates目录，且在settings.py中已设置，则加载模板时，则优先从此目录中加载模板文件。</li>
</ul>
<h2 id="四、URL路由配置"><a href="#四、URL路由配置" class="headerlink" title="四、URL路由配置"></a>四、URL路由配置</h2><h3 id="4-1-URL分二级（总路由和子路由（app模块的路由））"><a href="#4-1-URL分二级（总路由和子路由（app模块的路由））" class="headerlink" title="4.1 URL分二级（总路由和子路由（app模块的路由））"></a>4.1 URL分二级（总路由和子路由（app模块的路由））</h3><ul>
<li><p>主工程目录下urls.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">	path(<span class="string">&#x27;url&#x27;</span>, 视图函数, name=<span class="literal">None</span>),</span><br><span class="line">    path(<span class="string">&#x27;url/&#x27;</span>, include(<span class="string">&#x27;app_label.urls&#x27;</span>, namespace=<span class="literal">None</span>))  <span class="comment"># 包含子路由</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
<li><p>app目录下的urls.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">	path(<span class="string">&#x27;url&#x27;</span>, 视图函数, name=<span class="literal">None</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
</ul>
<p>include的namespace和path的name都在反向解析中使用，即反向获取url路径：<code>namespace.name</code></p>
<h3 id="4-2-url和path两种路由的配置"><a href="#4-2-url和path两种路由的配置" class="headerlink" title="4.2 url和path两种路由的配置"></a>4.2 url和path两种路由的配置</h3><p>url()配置兼容Django1.x的老版本</p>
<p>path()，re_path()是Django2之后的路由函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line"><span class="comment"># from django.conf.urls import url</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> orderapp <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;list&#x27;</span>, views.order_list),</span><br><span class="line">    re_path(<span class="string">r&#x27;^list2$&#x27;</span>, views.order_list),</span><br><span class="line">    <span class="comment"># url(r&#x27;^list2$&#x27;, views.order_list),</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>url()支持正则，通过正则在url路径中向处理函数传参：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r&#x27;^list2/(?P&lt;city_code&gt;\w+)/(?P&lt;order_num&gt;\d+)$&#x27;</span>, views.order_list),</span><br><span class="line"><span class="comment"># re_path(r&#x27;^list2/(?P&lt;city_code&gt;\w+)/(?P&lt;order_num&gt;\d+)$&#x27;, views.order_list),</span></span><br></pre></td></tr></table></figure>

<p>以上是按关键传参方式。也可以按位置传参(从左到右)，如下所示</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r&#x27;^list2/(\w+)/(\d+)$&#x27;</span>, views.order_list),</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">order_list</span>(<span class="params">request, order_num, city_code</span>):</span><br><span class="line">    <span class="built_in">print</span>(order_num, city_code)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;list_order.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<p>以上的url路由传参可以使用path()的<code>&lt;name&gt;</code>实现，如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">&#x27;list/&lt;city_code&gt;/&lt;order_num&gt;&#x27;</span>, views.order_list),</span><br></pre></td></tr></table></figure>

<p>如果路由中的参数是uuid类型，则使用参数转换器进行匹配，如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">&#x27;cancel/&lt;uuid:order_num&gt;&#x27;</span>, views.cancel_order),</span><br></pre></td></tr></table></figure>

<p>除了uuid转换器之外，还有str, int, slug。如果路由中参数的规则比较复杂时，建议使用re_path()配置路由中的参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re_path(<span class="string">r&#x27;^search/(?P&lt;phone&gt;1[3-57-9][\d]&#123;9&#125;)$&#x27;</span>, views.search),</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">request, phone</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;hi, phone: %s&#x27;</span> % phone)</span><br></pre></td></tr></table></figure>

<h2 id="五、反向解析"><a href="#五、反向解析" class="headerlink" title="五、反向解析"></a>五、反向解析</h2><h3 id="5-1-使用include的namespace和path的name属性"><a href="#5-1-使用include的namespace和path的name属性" class="headerlink" title="5.1 使用include的namespace和path的name属性"></a>5.1 使用include的namespace和path的name属性</h3><p>主路由：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">&#x27;order/&#x27;</span>, include(<span class="string">&#x27;orderapp.urls&#x27;</span>, namespace=<span class="string">&#x27;order&#x27;</span>)),</span><br></pre></td></tr></table></figure>

<p>子路由：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app_name = <span class="string">&#x27;orderapp&#x27;</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;list/&lt;city_code&gt;/&lt;order_num&gt;&#x27;</span>, views.order_list, name=<span class="string">&#x27;list&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;cancel/&lt;uuid:order_num&gt;&#x27;</span>, views.cancel_order, name=<span class="string">&#x27;cancel&#x27;</span>),</span><br><span class="line">    re_path(<span class="string">r&#x27;^search/(?P&lt;phone&gt;1[3-57-9][\d]&#123;9&#125;)$&#x27;</span>, views.search, name=<span class="string">&#x27;search&#x27;</span>),</span><br><span class="line">    <span class="comment"># url(r&#x27;^list2/(?P&lt;city_code&gt;\w+)/(?P&lt;order_num&gt;\d+)$&#x27;, views.order_list),</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>【注意】如果子路由指定了namespace命名空间，则子路由的脚本中必须声明<code>app_name</code>属性，属性一般是app模块名称。</p>
<h3 id="5-2-在网页中获取路径"><a href="#5-2-在网页中获取路径" class="headerlink" title="5.2 在网页中获取路径"></a>5.2 在网页中获取路径</h3><p>在网页中使用<code>&#123;% url 'namespace或app_name:name' 参数 %&#125;</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;orderapp:list&#x27; &#x27;xa&#x27; 1001 %&#125;&quot;</span>&gt;</span>订单<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>参数可以是多个，每个参数之间使用空格分隔。</p>
<p>参数默认使用位置传参，也可以使用关键参数传参。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;orderapp:list&#x27; order_num=1002 city_code=&#x27;xa&#x27; %&#125;&quot;</span>&gt;</span>订单<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-在视图函数中获取路径"><a href="#5-3-在视图函数中获取路径" class="headerlink" title="5.3 在视图函数中获取路径"></a>5.3 在视图函数中获取路径</h3><p>在视图函数中，使用reverse()函数来反向获取url请求路径。再通过redirect或HttpResponseRedirect()来重定向。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url = reverse(<span class="string">&#x27;order:search&#x27;</span>, args=(<span class="string">&#x27;13888888888&#x27;</span>,))</span><br><span class="line">    <span class="keyword">return</span> redirect(url)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url = reverse(<span class="string">&#x27;order:list&#x27;</span>, kwargs=<span class="built_in">dict</span>(city_code=<span class="string">&#x27;ShanxiXA&#x27;</span>, order_num=<span class="number">11009</span>))</span><br><span class="line">    <span class="keyword">return</span> HttpResponseRedirect(url)</span><br></pre></td></tr></table></figure>

<ul>
<li>reverse()可以使用kwargs字典类型传参，也可以使用args以位置方式传参。</li>
<li>HttpResponseRedirect()和redirect()是一样的，即redirect()返回就是HttpResponseRedirect类对象。</li>
</ul>
<h2 id="六、自定义error视图模板"><a href="#六、自定义error视图模板" class="headerlink" title="六、自定义error视图模板"></a>六、自定义error视图模板</h2><p>常见的错误响应状态码：403，400，404，405(请求方法不允许)，500 (服务器异常)</p>
<p>在templates模板中定义404.html或500.html，要求将settings.py的DEBUG设置为false.</p>
<p>404.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#x27;base.html&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span></span><br><span class="line">        Sorry, 您请求的资源&#123;&#123; request_path &#125;&#125;不存在。</span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>);</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>不存在。</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        3秒后自动跳转到<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>主页<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&gt;。</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、模型类扩展知识点"><a href="#七、模型类扩展知识点" class="headerlink" title="七、模型类扩展知识点"></a>七、模型类扩展知识点</h2><h3 id="7-1-validators验证"><a href="#7-1-validators验证" class="headerlink" title="7.1 validators验证"></a>7.1 validators验证</h3><p>如果验证不通过，可以抛出ValidationError信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</span><br></pre></td></tr></table></figure>

<p>自定义验证器类(用于模型类字段的)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserValidator</span>:</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">valid_phone</span>(<span class="params">cls, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;1[1-57-9]\d&#123;9&#125;&#x27;</span>, value):</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;手机号格式不正确&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserEntity</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;账号&#x27;</span>)</span><br><span class="line">    age = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;年龄&#x27;</span>)</span><br><span class="line">    phone = models.CharField(max_length=<span class="number">11</span>,</span><br><span class="line">                             verbose_name=<span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">                             validators=[UserValidator.valid_phone],</span><br><span class="line">                             blank=<span class="literal">True</span>,  <span class="comment"># 站点的表单字段值可以为空</span></span><br><span class="line">                             null=<span class="literal">True</span>)  <span class="comment"># 数据表的字段可以是null值</span></span><br></pre></td></tr></table></figure>

<p>在models.CharField(validators=[])指定哪些验证方法。</p>
<h3 id="7-2-QuerySet的bulk-create-批量创建"><a href="#7-2-QuerySet的bulk-create-批量创建" class="headerlink" title="7.2 QuerySet的bulk_create([])批量创建"></a>7.2 QuerySet的bulk_create([])批量创建</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">c1 = CateTypeEntity()</span><br><span class="line">c1.name = <span class="string">&#x27;水果1&#x27;</span></span><br><span class="line">c1.order_num = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">c2 = CateTypeEntity()</span><br><span class="line">c2.name = <span class="string">&#x27;水果2&#x27;</span></span><br><span class="line">c2.order_num = <span class="number">11</span></span><br><span class="line"></span><br><span class="line">CateTypeEntity.objects.bulk_create([c1, c2])</span><br></pre></td></tr></table></figure>

<h3 id="7-3-QuerySet-values-或values-list-返回指定字段"><a href="#7-3-QuerySet-values-或values-list-返回指定字段" class="headerlink" title="7.3 QuerySet.values()或values_list()返回指定字段"></a>7.3 QuerySet.values()或values_list()返回指定字段</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserEntity.objects.values(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)  <span class="comment"># 只查看id和name两个字段</span></span><br><span class="line">&lt;QuerySet [&#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;disen&#x27;</span>&#125;, &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;jack&#x27;</span>&#125;, &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;ping&#x27;</span>&#125;, &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;wong&#x27;</span>&#125;, &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;xi&#x27;</span>&#125;]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-request请求对象的属性"><a href="#7-4-request请求对象的属性" class="headerlink" title="7.4 request请求对象的属性"></a>7.4 request请求对象的属性</h3><p>GET/POST/COOKIES/FILES都是QueryDict类，QueryDict自动进行url的中文编码处理。</p>
<p><code>method, path, content_type, encoding, session</code></p>
<h1 id="WEB后端服务第16天-Django第6天"><a href="#WEB后端服务第16天-Django第6天" class="headerlink" title="WEB后端服务第16天-Django第6天"></a>WEB后端服务第16天-Django第6天</h1><h2 id="一、请求与响应详解"><a href="#一、请求与响应详解" class="headerlink" title="一、请求与响应详解"></a>一、请求与响应详解</h2><h3 id="1-1-request对象"><a href="#1-1-request对象" class="headerlink" title="1.1 request对象"></a>1.1 request对象</h3><h4 id="1-1-1-扩展：mysql连接配置"><a href="#1-1-1-扩展：mysql连接配置" class="headerlink" title="1.1.1 扩展：mysql连接配置"></a>1.1.1 扩展：mysql连接配置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;advance1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;192.168.200.116&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="number">3306</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CHARSET&#x27;</span>: <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认情况下，需要安装mysqlclient，我们也可以安装pymysql，但需要在主目录下进行初始化安装。主工程目录下的__init__.py脚本中的内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<h4 id="1-1-2-请求对象中的QueryDict属性"><a href="#1-1-2-请求对象中的QueryDict属性" class="headerlink" title="1.1.2 请求对象中的QueryDict属性"></a>1.1.2 请求对象中的QueryDict属性</h4><ul>
<li>GET    查询参数</li>
<li>POST  表单参数，包含post两个请求方法的参数</li>
<li>COOKIES  客户端中的当前domain的所有的Cookie信息</li>
<li>META  wsgi中请求的元信息（服务器环境信息，客户端请求信息）== environ<ul>
<li>REMOTE_ADDR  客户端IP</li>
<li>PATH_INFO  请求路径</li>
<li>REQUEST_METHOD 请求方法</li>
<li>QUERY_STRING  查询参数</li>
<li>CONTENT_TYPE  </li>
</ul>
</li>
<li>FILES  上传的表单参数中所有的文件对象，MultiValueDict类对象，文件对象的类型是InMemoryUploadedFile</li>
<li>SESSION  会话中存储的数据（可以跨多个请求）</li>
</ul>
<p>GET请求的案例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Regist2<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;phone&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            爱好：</span><br><span class="line">            &#123;% for love in loves %&#125;</span><br><span class="line">                &#123;# 默认选择第一项和最后一项的爱好 #&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span><br><span class="line"><span class="tag">                       &#123;% <span class="attr">if</span> <span class="attr">forloop.first</span> <span class="attr">or</span> <span class="attr">forloop.last</span> %&#125;</span></span><br><span class="line"><span class="tag">                            <span class="attr">checked</span></span></span><br><span class="line"><span class="tag">                       &#123;% <span class="attr">endif</span> %&#125;</span></span><br><span class="line"><span class="tag">                       <span class="attr">name</span>=<span class="string">&quot;love&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; love &#125;&#125;&quot;</span>&gt;</span> &#123;&#123; love &#125;&#125;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        GET请求的查询参数<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            &#123;% for key, value in request.GET.items %&#125;</span><br><span class="line">                &#123;% if key != &#x27;love&#x27; %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; key &#125;&#125;: &#123;&#123; value &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                爱好：</span><br><span class="line">                &#123;% for item in select_loves %&#125;</span><br><span class="line">                    &#123;&#123; item &#125;&#125;,</span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@csrf_exempt</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">regist_2</span>(<span class="params">request, user_id=<span class="literal">None</span></span>):</span><br><span class="line">    loves = [<span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Django&#x27;</span>, <span class="string">&#x27;Flask&#x27;</span>, <span class="string">&#x27;Django REST Framework&#x27;</span>, <span class="string">&#x27;Linux&#x27;</span>, <span class="string">&#x27;H5&#x27;</span>]</span><br><span class="line">    <span class="comment"># 获取参数名相同的多个参数值</span></span><br><span class="line">    select_loves = request.GET.getlist(<span class="string">&#x27;love&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;regist2.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<p>POST/PUT-ajax请求案例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Regist3<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;phone&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;up_ajax()&quot;</span>&gt;</span>ajax发起put请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">up_ajax</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                data = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">phone</span>: <span class="string">&#x27;123456789&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">loves</span>: [<span class="string">&#x27;唱&#x27;</span>, <span class="string">&#x27;跳&#x27;</span>, <span class="string">&#x27;RAP&#x27;</span>, <span class="string">&#x27;篮球&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                &#125;;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">fetch</span>(<span class="string">&#x27;&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">body</span>: <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="number">0</span>].<span class="property">serialize</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">text</span>()).<span class="title function_">then</span>(<span class="function"><span class="params">html</span>=&gt;</span> &#123;<span class="variable language_">document</span>.<span class="title function_">write</span>(html)&#125;)</span></span><br><span class="line"><span class="language-javascript">             &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">P</span>&gt;</span></span><br><span class="line">        POST请求参数：</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            &#123;% for key, value in request.POST.items %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; key &#125;&#125;: &#123;&#123; value &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">P</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        PUT的参数（body）：&#123;&#123; request.body &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        content-type: &#123;&#123; request.content_type &#125;&#125;;&#123;&#123; request.encoding &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@csrf_exempt</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">regist</span>(<span class="params">request, user_id=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(request.POST)  <span class="comment"># 只接收post请求方法上传的form表单数据</span></span><br><span class="line">    <span class="built_in">print</span>(request.method)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;regist3.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<p>POST实现文件上传案例</p>
<h4 id="1-1-3-请求对象中的普通信息"><a href="#1-1-3-请求对象中的普通信息" class="headerlink" title="1.1.3 请求对象中的普通信息"></a>1.1.3 请求对象中的普通信息</h4><ul>
<li>path 请求路径</li>
<li>method  请求方法， GET/POST/PUT/DELETE</li>
<li>content_type  数据类型，如 请求头的Content-Type:text/html;charset=utf-8，content_type只接收数据类型text/html。charset=utf-8的部分编码则由encoding存储。</li>
<li>encoding  数据编码</li>
<li>body  字节码数据，一般接收上传的json数据，put上传的数据可以使用body来获取。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Regist<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;phone&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;生日&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;up_ajax()&quot;</span>&gt;</span>ajax上传json数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">up_ajax</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                data = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>: <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="number">0</span>].<span class="property">name</span>.<span class="property">value</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">phone</span>: <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="number">0</span>].<span class="property">phone</span>.<span class="property">value</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">fetch</span>(<span class="string">&#x27;&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data),</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">text</span>()).<span class="title function_">then</span>(<span class="function"><span class="params">text</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">document</span>.<span class="title function_">write</span>(text)</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        请求路径-path：&#123;&#123; request.path &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        请求的URI(统一资源标识符): http://&#123;&#123; request.get_host &#125;&#125;:&#123;&#123; request.get_port &#125;&#125;&#123;&#123; request.get_full_path &#125;&#125;</span><br><span class="line">&#123;#                             &#123;&#123; request.get_raw_uri &#125;&#125;#&#125;</span><br><span class="line">&#123;#        The undocumented HttpRequest.get_raw_uri() method is removed.#&#125;</span><br><span class="line">&#123;#        The HttpRequest.build_absolute_uri() method may be a suitable alternative.#&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">pre</span>&gt;</span></span><br><span class="line">            URL: 统一资源定位符，资源的网络地址</span><br><span class="line">            URI: 统一资源标识符，用于RESTful规范中，可以理解为URL</span><br><span class="line">        <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        请求方法：&#123;&#123; request.method &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        content_type: &#123;&#123; request.content_type &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        encoding: &#123;&#123; request.encoding &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        content_params: &#123;&#123; request.content_params &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        body: &#123;&#123; request.body &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>github仓库：<a href="mailto:&#x67;&#x69;&#116;&#x40;&#103;&#x69;&#116;&#x68;&#x75;&#x62;&#46;&#99;&#111;&#109;">&#x67;&#x69;&#116;&#x40;&#103;&#x69;&#116;&#x68;&#x75;&#x62;&#46;&#99;&#111;&#109;</a>:disenQF/advanceDjango1.git</p>
<h3 id="1-2-response对象"><a href="#1-2-response对象" class="headerlink" title="1.2 response对象"></a>1.2 response对象</h3><p>响应对象是视图函数返回的对象。由我们自己创建，当然，django有很多快捷方法，如render()/redirect()快速生成response响应对象。</p>
<p>常用的响应类：</p>
<ul>
<li>HttpResponse</li>
<li>HttpResponseRedirect</li>
<li>JsonResponse</li>
</ul>
<p>响应对象中包含的属性：</p>
<ul>
<li><p>content响应的内容</p>
<ul>
<li><p>如果HttpResponse对象，则content可以是字节码也可以是字符串</p>
</li>
<li><p>JsonResponse，则content可以是dict字典</p>
</li>
</ul>
</li>
<li><p>status 响应的状态码</p>
</li>
<li><p>content_type 响应的数据类型</p>
</li>
</ul>
<h2 id="二、会话技术详解"><a href="#二、会话技术详解" class="headerlink" title="二、会话技术详解"></a>二、会话技术详解</h2><p>一次会话(session)或连接从浏览器的一个Request开始，到服务器返回Response结束。可以在多个页面需要传递部分数据。</p>
<p>Django的session的数据默认存储在django_session表中。但session依赖于cookie技术。客户端如果禁用了cookie，则session也会失效。</p>
<h3 id="2-1-cookie"><a href="#2-1-cookie" class="headerlink" title="2.1 cookie"></a>2.1 cookie</h3><h3 id="2-2-session"><a href="#2-2-session" class="headerlink" title="2.2 session"></a>2.2 session</h3><h3 id="2-3-Token"><a href="#2-3-Token" class="headerlink" title="2.3 Token"></a>2.3 Token</h3><h1 id="WEB后端服务第17天-Django第7天"><a href="#WEB后端服务第17天-Django第7天" class="headerlink" title="WEB后端服务第17天-Django第7天"></a>WEB后端服务第17天-Django第7天</h1><h2 id="一、验证码"><a href="#一、验证码" class="headerlink" title="一、验证码"></a>一、验证码</h2><h3 id="1-1-验证码方式"><a href="#1-1-验证码方式" class="headerlink" title="1.1 验证码方式"></a>1.1 验证码方式</h3><ul>
<li>图片验证码</li>
<li>滑动验证码</li>
<li>短信验证码</li>
<li>邮箱验证码</li>
</ul>
<h3 id="1-2-验证码使用场景"><a href="#1-2-验证码使用场景" class="headerlink" title="1.2 验证码使用场景"></a>1.2 验证码使用场景</h3><ul>
<li>防止爬虫程序</li>
<li>防止非人为操作</li>
</ul>
<h3 id="1-3-基于PIL库实现图片验证码"><a href="#1-3-基于PIL库实现图片验证码" class="headerlink" title="1.3 基于PIL库实现图片验证码"></a>1.3 基于PIL库实现图片验证码</h3><h4 id="1-3-1-PIL初步使用"><a href="#1-3-1-PIL初步使用" class="headerlink" title="1.3.1 PIL初步使用"></a>1.3.1 PIL初步使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">new_img_code</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 创建画布</span></span><br><span class="line">    img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (<span class="number">80</span>, <span class="number">40</span>), (<span class="number">100</span>, <span class="number">100</span>, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从画布中获取画笔</span></span><br><span class="line">    draw = ImageDraw.Draw(img, <span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建字体对象和字体颜色</span></span><br><span class="line">    font_color = (<span class="number">0</span>, <span class="number">20</span>, <span class="number">100</span>)</span><br><span class="line">    font = ImageFont.truetype(font=<span class="string">&#x27;static/fonts/arial.ttf&#x27;</span>, size=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始画内容</span></span><br><span class="line">    draw.text((<span class="number">5</span>, <span class="number">5</span>), <span class="string">&#x27;wf&#x27;</span>, font=font, fill=font_color)</span><br><span class="line">    <span class="comment"># draw.line((0, 0), (255, 0, 0), 20)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        x = random.randint(<span class="number">0</span>, <span class="number">80</span>)</span><br><span class="line">        y = random.randint(<span class="number">0</span>, <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">        r = random.randint(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">        g = random.randint(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">        b = random.randint(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">        draw.point((x, y), (r, g, b))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将画布写入内存字节数组中</span></span><br><span class="line">    <span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line">    buffer = BytesIO()</span><br><span class="line">    img.save(buffer, <span class="string">&#x27;png&#x27;</span>)  <span class="comment"># 写入</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(content=buffer.getvalue(), content_type=<span class="string">&#x27;image/png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="1-3-2-随机验证码"><a href="#1-3-2-随机验证码" class="headerlink" title="1.3.2 随机验证码"></a>1.3.2 随机验证码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_random_str</span>(<span class="params">start, end</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(random.randint(start, end))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new_code_str</span>(<span class="params"><span class="built_in">len</span></span>):</span><br><span class="line">    code_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>):</span><br><span class="line">        flag = random.randint(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">        start, end = (<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>)) <span class="keyword">if</span> flag == <span class="number">1</span> \</span><br><span class="line">            <span class="keyword">else</span> (<span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>)) <span class="keyword">if</span> flag == <span class="number">2</span> \</span><br><span class="line">            <span class="keyword">else</span> (<span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>), <span class="built_in">ord</span>(<span class="string">&#x27;9&#x27;</span>))</span><br><span class="line">        code_str += _random_str(start, end)</span><br><span class="line">    <span class="keyword">return</span> code_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(new_code_str(<span class="number">6</span>))</span><br></pre></td></tr></table></figure>

<h2 id="二、分页器Paginator"><a href="#二、分页器Paginator" class="headerlink" title="二、分页器Paginator"></a>二、分页器Paginator</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><h3 id="2-response-set-cookie-方法的参数有哪些"><a href="#2-response-set-cookie-方法的参数有哪些" class="headerlink" title="2. response.set_cookie()方法的参数有哪些"></a>2. response.set_cookie()方法的参数有哪些</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_cookie(key, value, path=<span class="string">&#x27;/&#x27;</span>, domain=<span class="literal">None</span>, max_age=<span class="literal">None</span>, expires=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-清除所有session的方法是什么"><a href="#3-清除所有session的方法是什么" class="headerlink" title="3. 清除所有session的方法是什么"></a>3. 清除所有session的方法是什么</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.session.clear()</span><br></pre></td></tr></table></figure>

<h2 id="三、类视图CBV"><a href="#三、类视图CBV" class="headerlink" title="三、类视图CBV"></a>三、类视图CBV</h2><h3 id="3-1-概念"><a href="#3-1-概念" class="headerlink" title="3.1 概念"></a>3.1 概念</h3><p>Django中视图(View)写法有两种：</p>
<ul>
<li>FBV(Function-based View)基于函数的视图，之前都是使用FBV模式。</li>
<li>CBV(Class-bases View)基于类的视图，应用面向对象（OOB）设计思想，通过继承、重写等相关特性实现业务功能。</li>
</ul>
<h3 id="3-2-Django提供很多的View"><a href="#3-2-Django提供很多的View" class="headerlink" title="3.2 Django提供很多的View"></a>3.2 Django提供很多的View</h3><ul>
<li><p>View</p>
</li>
<li><p>TemplateView</p>
</li>
<li><p>RedirectView</p>
</li>
<li><p>ListView</p>
</li>
<li><p>EditView</p>
</li>
<li><p>FormView</p>
</li>
<li><p>DetailView</p>
</li>
<li><p>DeleteView</p>
</li>
</ul>
<h3 id="3-3-使用的过程"><a href="#3-3-使用的过程" class="headerlink" title="3.3 使用的过程"></a>3.3 使用的过程</h3><ul>
<li><p>在views.py中定义View的子类，并初始关键属性或重写方法</p>
<p>在View中处理的流程如下：</p>
<ul>
<li>dispatch(request, *args, **kwargs)分发请求到get/post/put/delete/等方法处理函数中</li>
<li>http_method_not_allowed()请求方法不允许的响应</li>
<li>options()探测请求方法的Allow信息</li>
</ul>
</li>
<li><p>在路由的视图函数位置上使用View.as_view()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> stockapp <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app_name = <span class="string">&#x27;stockapp&#x27;</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;stocks/&lt;stock_id&gt;/&#x27;</span>, csrf_exempt(views.StockView.as_view()), name=<span class="string">&#x27;stocks&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;goods/&lt;wd&gt;/&#x27;</span>, views.GoodsView.as_view(), name=<span class="string">&#x27;goods&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;query/&lt;wd&gt;/&#x27;</span>, views.QueryView.as_view(), name=<span class="string">&#x27;query&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StockView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="comment"># @csrf_exempt</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().dispatch(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, **kwargs</span>):</span><br><span class="line">        stock_id = kwargs.get(<span class="string">&#x27;stock_id&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;stock/list.html&#x27;</span>, <span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;post请求&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="四、中间件Middleware"><a href="#四、中间件Middleware" class="headerlink" title="四、中间件Middleware"></a>四、中间件Middleware</h2><h3 id="4-1-概念"><a href="#4-1-概念" class="headerlink" title="4.1 概念"></a>4.1 概念</h3><p>中间件基于AOP(面向切面编程)设计思想，目的是扩展业务功能，即不修改原业务基础上，增加新的功能，类似于装饰器。中间件有很多使用场景：验证权限、限制ip(黑名单)、限制请求次数、跨域请求、访问日志/统计、记录错误信息。</p>
<p>Django的中间件有五个勾子函数【重要】：</p>
<ul>
<li><strong>process_request()</strong> 从django框架到urls路由过程</li>
<li><strong>process_view(request, callback, callback_args, callback_kwargs)</strong> 从urls路由到view视图函数的过程</li>
<li><strong>process_template_response()</strong> 在view视图函数中渲染模板的过程【不常用】</li>
<li><strong>process_exception(request, exception)</strong> 从请求到响应的整个过程，如果发生了异常，则会被此函数处理</li>
<li><strong>process_response(request, response)</strong> 从视图函数中向Django响应数据时，即返回HttpResponse()对象后</li>
</ul>
<h3 id="4-2-自定义中间件"><a href="#4-2-自定义中间件" class="headerlink" title="4.2 自定义中间件"></a>4.2 自定义中间件</h3><p>中间件的基本类：django.utils.deprecation.MiddlewareMixin</p>
<p>在项目的目录下，创建middleware包和check_login.py脚本，内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CheckLoginMiddleware</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="comment"># 从请求到路由urls过程，触发此函数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-----------CheckLoginMiddleware-------------&#x27;</span>, <span class="string">&#x27;process_request&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(request.path, request.COOKIES)</span><br><span class="line">        dontfilters = [<span class="string">&#x27;/user/login/&#x27;</span>, <span class="string">&#x27;/user/code/&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> request.path <span class="keyword">not</span> <span class="keyword">in</span> dontfilters:</span><br><span class="line">            <span class="comment"># 验证用户是否登录</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> request.COOKIES.get(<span class="string">&#x27;token&#x27;</span>):</span><br><span class="line">                <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;&lt;h3&gt;Login&lt;/h3&gt;&lt;form&gt;&lt;input&gt;&lt;button&gt;Login&lt;/button&gt;&lt;/form&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_view</span>(<span class="params">self, request, callback, callback_args, callback_kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-----------CheckLoginMiddleware-------------&#x27;</span>, <span class="string">&#x27;process_view&#x27;</span>)</span><br><span class="line">        <span class="comment"># callback 是调用的view函数</span></span><br><span class="line">        <span class="comment"># 新增一个关键参数，类似于匹配路由 stock/&lt;stock_id&gt;/&lt;page&gt;/</span></span><br><span class="line">        callback_kwargs[<span class="string">&#x27;page&#x27;</span>] = request.GET.get(<span class="string">&#x27;page&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(callback, callback_args, callback_kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-----------CheckLoginMiddleware-------------&#x27;</span>, <span class="string">&#x27;process_response&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>在settings.py的注册中间件类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;middleware.check_login.CheckLoginMiddleware&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="五、Django日志"><a href="#五、Django日志" class="headerlink" title="五、Django日志"></a>五、Django日志</h2><h3 id="5-1-Django日志LOGGING的组成部分"><a href="#5-1-Django日志LOGGING的组成部分" class="headerlink" title="5.1 Django日志LOGGING的组成部分"></a>5.1 Django日志LOGGING的组成部分</h3><ul>
<li>日志的版本号 version</li>
<li>日志的格式化 formatters</li>
<li>日志的处理器 handlers</li>
<li>日志的记录器 loggers，默认存在“django.server”，”django.request”</li>
<li>日志的过滤器 filters</li>
</ul>
<h3 id="5-2-配置日志"><a href="#5-2-配置日志" class="headerlink" title="5.2 配置日志"></a>5.2 配置日志</h3><p>在settings.py脚本中配置，内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 配置Django的日志</span></span><br><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="number">1.0</span>,</span><br><span class="line">    <span class="string">&#x27;formatters&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;base&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;[%(asctime)s  %(name)s ] %(message)s&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;datefmt&#x27;</span>: <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;out&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;INFO&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;formatter&#x27;</span>: <span class="string">&#x27;base&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;file&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;logging.FileHandler&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;WARNING&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;formatter&#x27;</span>: <span class="string">&#x27;base&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;filename&#x27;</span>: <span class="string">f&#x27;<span class="subst">&#123;BASE_DIR&#125;</span>/warn.log&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment"># 日志记录器名称 django.server</span></span><br><span class="line">        <span class="string">&#x27;django.server&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;out&#x27;</span>, <span class="string">&#x27;file&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;CRITICAL&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;mylogger&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;out&#x27;</span>, <span class="string">&#x27;file&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;INFO&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-使用日志"><a href="#5-3-使用日志" class="headerlink" title="5.3 使用日志"></a>5.3 使用日志</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.getLogger(<span class="string">&#x27;mylogger&#x27;</span>).error(<span class="string">&#x27;请求发生错误&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="六、缓存Cache"><a href="#六、缓存Cache" class="headerlink" title="六、缓存Cache"></a>六、缓存Cache</h2><h3 id="6-1-配置缓存"><a href="#6-1-配置缓存" class="headerlink" title="6.1 配置缓存"></a>6.1 配置缓存</h3><h4 id="6-1-1-文件缓存"><a href="#6-1-1-文件缓存" class="headerlink" title="6.1.1 文件缓存"></a>6.1.1 文件缓存</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置缓存Cache</span></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.filebased.FileBasedCache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">f&#x27;<span class="subst">&#123;BASE_DIR&#125;</span>/mycache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;TIMEOUT&#x27;</span>: <span class="number">300</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;MAX_ENTRIES&#x27;</span>: <span class="number">500</span>,</span><br><span class="line">            <span class="string">&#x27;CULL_FREQUENCY&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-使用缓存"><a href="#6-2-使用缓存" class="headerlink" title="6.2 使用缓存"></a>6.2 使用缓存</h3><h4 id="6-2-1-文件缓存的使用"><a href="#6-2-1-文件缓存的使用" class="headerlink" title="6.2.1 文件缓存的使用"></a>6.2.1 文件缓存的使用</h4><p>导包</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br></pre></td></tr></table></figure>

<p>增加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cache.<span class="built_in">set</span>(key, value, timeout)</span><br><span class="line">cache.add(key, value, timeout, version)</span><br></pre></td></tr></table></figure>

<p>读取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cache.has_key(key)</span><br><span class="line">value = cache.get(key)</span><br></pre></td></tr></table></figure>

<p>删除</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cache.delete(key)</span><br></pre></td></tr></table></figure>

<h1 id="WEB后端服务第18天-Django第8天"><a href="#WEB后端服务第18天-Django第8天" class="headerlink" title="WEB后端服务第18天-Django第8天"></a>WEB后端服务第18天-Django第8天</h1><h2 id="一、Django缓存进阶"><a href="#一、Django缓存进阶" class="headerlink" title="一、Django缓存进阶"></a>一、Django缓存进阶</h2><p>Django中提供了六种常见缓存策略：</p>
<ul>
<li>开发调试</li>
<li>内存</li>
<li>文件</li>
<li>数据库</li>
<li>Memcache缓存（python-memcached模块）</li>
<li>Memcache缓存（pylibmc模块）</li>
</ul>
<h3 id="1-1-cache-page页面缓存"><a href="#1-1-cache-page页面缓存" class="headerlink" title="1.1 cache_page页面缓存"></a>1.1 cache_page页面缓存</h3><ul>
<li><p>@cache_page方案</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@cache_page(<span class="params">timeout=<span class="number">10</span>, cache=<span class="string">&#x27;html&#x27;</span>, key_prefix=<span class="string">&#x27;page&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 验证是否登录</span></span><br><span class="line">    chrs = string.ascii_letters</span><br><span class="line">    char = random.choice(chrs)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;用户列表页面：&lt;br&gt; %s&#x27;</span> % char)</span><br></pre></td></tr></table></figure></li>
<li><p>cache.set/add() 保存html</p>
<p>在中间件的process_request和process_response()两个勾子函数中实现页面缓存。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CachePageMiddleware</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="comment"># 配置缓存的页面路径</span></span><br><span class="line">    cache_page_paths = [</span><br><span class="line">        <span class="string">&#x27;/user/list/&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="comment"># 判断当前的请求是否支持缓存</span></span><br><span class="line">        <span class="keyword">if</span> request.path <span class="keyword">in</span> self.cache_page_paths:</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 判断页面是否已经缓存</span></span><br><span class="line">            <span class="keyword">if</span> cache.has_key(request.path):</span><br><span class="line">                <span class="keyword">return</span> HttpResponse(cache.get(request.path))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        <span class="comment"># 判断当前的请求路径是否要被缓存</span></span><br><span class="line">        <span class="keyword">if</span> request.path <span class="keyword">in</span> self.cache_page_paths:</span><br><span class="line">            <span class="comment"># 缓存页面</span></span><br><span class="line">            cache.<span class="built_in">set</span>(request.path, response.content, timeout=<span class="number">5</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-2-Redis缓存配置"><a href="#1-2-Redis缓存配置" class="headerlink" title="1.2 Redis缓存配置"></a>1.2 Redis缓存配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django_redis.cache.RedisCache&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;redis://192.168.200.116:6379/10&#x27;</span>,  <span class="comment"># redis://username:password@host:port/db</span></span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;CLIENT_CLASS&#x27;</span>: <span class="string">&#x27;django_redis.client.DefaultClient&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;SOCKET_CONNECT_TIMEOUT&#x27;</span>: <span class="number">10</span>,  <span class="comment"># 300秒</span></span><br><span class="line">            <span class="string">&#x27;SOCKET_TIMEOUT&#x27;</span>: <span class="number">10</span>,  <span class="comment"># 300秒</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-Session缓存"><a href="#1-3-Session缓存" class="headerlink" title="1.3 Session缓存"></a>1.3 Session缓存</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置session</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.cache&#x27;</span></span><br><span class="line">SESSION_COOKIE_NAME = <span class="string">&#x27;SESSION_ID&#x27;</span>  <span class="comment"># sessionid</span></span><br><span class="line">SESSION_COOKIE_PATH = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">SESSION_CACHE_ALIAS = <span class="string">&#x27;default&#x27;</span></span><br><span class="line">SESSION_COOKIE_AGE = <span class="number">1209600</span>  <span class="comment"># 2周有效时间</span></span><br></pre></td></tr></table></figure>

<h2 id="二、Django信号机制"><a href="#二、Django信号机制" class="headerlink" title="二、Django信号机制"></a>二、Django信号机制</h2><h3 id="2-1-信号的优点"><a href="#2-1-信号的优点" class="headerlink" title="2.1 信号的优点"></a>2.1 信号的优点</h3><ul>
<li>监控Django的内部事件</li>
<li>复杂业务之间解耦</li>
</ul>
<h3 id="2-2-接收内置的信号"><a href="#2-2-接收内置的信号" class="headerlink" title="2.2 接收内置的信号"></a>2.2 接收内置的信号</h3><ul>
<li>普通的接收信号，使用信号对象的connect()函数，如：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> pre_delete</span><br><span class="line"></span><br><span class="line"><span class="comment"># 声明信号处理的函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">model_delete_pre</span>(<span class="params">sender, **kwargs</span>):</span><br><span class="line">    <span class="keyword">from</span> user.models <span class="keyword">import</span> Order</span><br><span class="line">    <span class="keyword">if</span> sender == Order:</span><br><span class="line">    	<span class="built_in">print</span>(info % (<span class="string">&#x27;订单模型&#x27;</span>, kwargs.get(<span class="string">&#x27;instance&#x27;</span>).<span class="built_in">id</span>, kwargs.get(<span class="string">&#x27;instance&#x27;</span>).title))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收信号</span></span><br><span class="line">pre_delete.connect(model_delete_pre)</span><br></pre></td></tr></table></figure>

<p>【注意】信号处理函数的参数声明一般是固定的，**kwargs是一种简单的写法，也可以写成关键参数形式，但不灵活。</p>
<ul>
<li>支持装饰器的方式接收信号与连接信息处理函数，如：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> pre_delete, post_delete</span><br><span class="line"><span class="keyword">from</span> django.dispatch <span class="keyword">import</span> receiver</span><br><span class="line"></span><br><span class="line"><span class="meta">@receiver(<span class="params">post_delete</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_model_post</span>(<span class="params">sender, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(sender, <span class="string">&#x27;删除成功&#x27;</span>, kwargs)</span><br><span class="line"></span><br><span class="line">pre_delete.connect(model_delete_pre)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-自定义信号"><a href="#2-3-自定义信号" class="headerlink" title="2.3 自定义信号"></a>2.3 自定义信号</h3><ul>
<li>创建信号</li>
</ul>
<p>在项目下创建signals包，并在init.py脚本中声明信号</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> dispatch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义信号，providing_args-声明发送信号的参数列表</span></span><br><span class="line"><span class="comment"># codeSignal = dispatch.Signal(providing_args=[&#x27;path&#x27;, &#x27;phone&#x27;, &#x27;code&#x27;])</span></span><br><span class="line"><span class="comment"># The providing_args argument for django.dispatch.Signal is removed.</span></span><br><span class="line">codeSignal = dispatch.Signal()</span><br></pre></td></tr></table></figure>

<ul>
<li><p>发送信号</p>
<p>根据业务的需求，在适当位置发送信号</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">new_code</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 生成手机验证码</span></span><br><span class="line">    <span class="comment"># 随机产生验证码：大小写字母+数字</span></span><br><span class="line">    code_text = code.new_code_str(<span class="number">4</span>)</span><br><span class="line">    <span class="built_in">print</span>(code_text)</span><br><span class="line"></span><br><span class="line">    phone = request.GET.get(<span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(phone)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送信号，sender 名称可以根据需求设定，关键参数列表，根据信号定义的参数表传值</span></span><br><span class="line">    signals.codeSignal.send(<span class="string">&#x27;new_code&#x27;</span>, path=request.path, phone=phone, code=code_text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;发送验证码到%s成功&#x27;</span> % phone)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>接收信号</p>
<p>可以在app模块的init.py脚本中接收特定的信号。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> signals <span class="keyword">import</span> codeSignal</span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> dispatch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收信号</span></span><br><span class="line"><span class="meta">@dispatch.receiver(<span class="params">codeSignal</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cache_code</span>(<span class="params">sender, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;dispatch.receiver&lt;codeSignal&gt;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(sender, kwargs)</span><br></pre></td></tr></table></figure>

<h2 id="三、高并发解决方案Celery-Redis队列"><a href="#三、高并发解决方案Celery-Redis队列" class="headerlink" title="三、高并发解决方案Celery+Redis队列"></a>三、高并发解决方案Celery+Redis队列</h2><h3 id="3-1-概念-1"><a href="#3-1-概念-1" class="headerlink" title="3.1 概念"></a>3.1 概念</h3><p>Celery解决C10K问题，通过消息中间件和后台的任务执行单元解决高并发问题。</p>
<p>Celery的组成部分：</p>
<ul>
<li>消息中间件Broker，Celery本身并没有实现功能，知识一种接口或规范，在使用Celery时，必须指定消息中间件实现方案（Redis发布、订阅，RabbitMQ）</li>
<li>任务执行单元Worker，后台进程</li>
<li>任务执行单元的结果存储Result。</li>
</ul>
<h3 id="3-2-配置"><a href="#3-2-配置" class="headerlink" title="3.2 配置"></a>3.2 配置</h3><p>文档：<a target="_blank" rel="noopener" href="http://docs.celeryproject.org/en/latest/django/index.html">http://docs.celeryproject.org/en/latest/django/index.html</a></p>
<p>注意：Windows在Celery4.0之后，不支持多进程方式，更换成协程方式(eventlet, gevent)</p>
<p>安装库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install celery==<span class="number">4.4</span><span class="number">.0</span>rc3 eventlet</span><br></pre></td></tr></table></figure>

<p>在主项目的目录下，创建celery.py，内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import, unicode_literals</span><br><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"></span><br><span class="line">os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;advanceDjango.settings&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = celery(<span class="string">&#x27;advanceDjango&#x27;</span>, broker=<span class="string">&#x27;redis://127.0.0.1:6379/8&#x27;</span>)</span><br><span class="line">app.config_from_object(<span class="string">&#x27;django.conf:settings&#x27;</span>)  <span class="comment"># 配置Celery，加载settings.py</span></span><br><span class="line"></span><br><span class="line">app.autodiscover_tasks()  <span class="comment"># 自动发现task任务</span></span><br></pre></td></tr></table></figure>

<p>在主项目的init.py脚本中，增加<strong>all</strong>属性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import, unicode_literals</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .celery <span class="keyword">import</span> app <span class="keyword">as</span> celery_app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向项目模块中增加celery_app对象</span></span><br><span class="line">__all__ = (<span class="string">&#x27;celery_app&#x27;</span>,)</span><br></pre></td></tr></table></figure>

<p>在app应用模块中，创建tasks.py文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> shared_task</span><br><span class="line"></span><br><span class="line"><span class="meta">@shared_task</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qbuy</span>(<span class="params">goods_id, user_id</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;goods_id: %s -&gt; user_id: %s&#x27;</span> % (goods_id, user_id))</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;goods_id: %s -&gt; user_id: %s&#x27;</span> % (goods_id, user_id)</span><br></pre></td></tr></table></figure>

<p>在主项目的settings.py文件，配置Celery的选项</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CELERY_IMPORTS = (<span class="string">&#x27;stockapp.tasks&#x27;</span>, )</span><br></pre></td></tr></table></figure>

<p>启动Celery</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; celery -A advanceDjango worker -P eventlet -l info</span><br></pre></td></tr></table></figure>

<p>-P指定执行单元的实现方式，指定eventlet表示以协程方式实现后台执行单元的异步操作。</p>
<p>调用异步任务，@shared_task修改的任务函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qbuy.delay(<span class="string">&#x27;10009&#x27;</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>如果Celery服务接收任务，并执行，可以看到执行的结果。但是结果发出的警告，表示没有处理执行单元完成任务的结果。</p>
<p><strong>存储任务结果</strong></p>
<ul>
<li>存储到redis</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app = Celery(<span class="string">&#x27;advanceDjango&#x27;</span>, broker=<span class="string">&#x27;redis://192.168.200.116:6379/8&#x27;</span>, 			  			                    backend=<span class="string">&#x27;redis://192.168.200.116:6379/7&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>在创建时，指定Celery()的backend参数，指定results存储到redis中。</p>
<ul>
<li>django-celery-results</li>
</ul>
<p>安装存储任务执行结果库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-celery-results</span><br></pre></td></tr></table></figure>

<p>在settings.py文件中，配置result存储方案</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">	....</span><br><span class="line">	<span class="string">&#x27;django_celery_results&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">CELERY_RESULT_BACKEND = <span class="string">&#x27;django-db&#x27;</span></span><br><span class="line"><span class="comment"># CELERY_CACHE_BACKEND = &#x27;django-cache&#x27;  # 缓存信息</span></span><br></pre></td></tr></table></figure>

<p>迁移Celery结果相关的库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate django_celery_results</span><br></pre></td></tr></table></figure>

<p>迁移成功之后，重新启动Celery。</p>
<p>调试任务</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">async_result = qbuy.delay(<span class="string">&#x27;10009&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">async_result.ready()  <span class="comment"># 返回False或True，True表示结果已就绪</span></span><br><span class="line">async_result.result  <span class="comment"># 查看任务结果</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-抢购的实现"><a href="#3-3-抢购的实现" class="headerlink" title="3.3 抢购的实现"></a>3.3 抢购的实现</h3><p>涉及的技术点：ajax请求，redis的hash，cache使用</p>
<h3 id="3-4-Celery其他配置"><a href="#3-4-Celery其他配置" class="headerlink" title="3.4 Celery其他配置"></a>3.4 Celery其他配置</h3><p>格式化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>时区：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>scheduler计划任务</p>
<p>文档：<a target="_blank" rel="noopener" href="http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html">http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-celery-beat</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;django_celery_results&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django_celery_beat&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">python manage.py migrate django_celery_beat</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CELERY_TIMEZONE = TIME_ZONE</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置计划任务调度类</span></span><br><span class="line">CELERY_BEAT_SCHEDULE = <span class="string">&#x27;django_celery_beat.schedulers.DatabaseScheduler&#x27;</span></span><br><span class="line"></span><br><span class="line">CELERY_BEAT_SCHEDULE = &#123;</span><br><span class="line">    <span class="string">U&#x27;定时同步数据2&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;task&#x27;</span>: <span class="string">&#x27;stockapp.tasks.con_data&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;schedule&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;args&#x27;</span>: (<span class="string">&#x27;同步oracle&#x27;</span>, )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@shared_task</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">con_data</span>(<span class="params">content</span>):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;开始同步数据：%s&#x27;</span> % content)</span><br><span class="line">	logging.getLogger(<span class="string">&#x27;&#x27;</span>).info(<span class="string">&#x27;开始同步数据：%s&#x27;</span> % content)</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;同步完成&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">celery -A advanceDjango worker -B -l info -f celery.log</span></span><br></pre></td></tr></table></figure>

<h1 id="WEB后端服务第19天-Django第9天"><a href="#WEB后端服务第19天-Django第9天" class="headerlink" title="WEB后端服务第19天-Django第9天"></a>WEB后端服务第19天-Django第9天</h1><h2 id="一、基于Celery-Redis实现抢购方案"><a href="#一、基于Celery-Redis实现抢购方案" class="headerlink" title="一、基于Celery+Redis实现抢购方案"></a>一、基于Celery+Redis实现抢购方案</h2><p>项目：<a href="mailto:&#103;&#x69;&#x74;&#64;&#103;&#x69;&#116;&#x68;&#x75;&#98;&#46;&#99;&#111;&#109;">&#103;&#x69;&#x74;&#64;&#103;&#x69;&#116;&#x68;&#x75;&#98;&#46;&#99;&#111;&#109;</a>:disenQF/QBuyPro.git</p>
<h3 id="1-1-业务描述"><a href="#1-1-业务描述" class="headerlink" title="1.1 业务描述"></a>1.1 业务描述</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">实现抢购活动开始后，每位用户每天只限抢购一件商品。</span><br><span class="line">活动信息：图片、标题、商品、价格折扣、开始时间、结束时间</span><br><span class="line"></span><br><span class="line">另外：每天限量 5</span><br></pre></td></tr></table></figure>

<h3 id="1-2-设计模型类"><a href="#1-2-设计模型类" class="headerlink" title="1.2 设计模型类"></a>1.2 设计模型类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Goods</span>(models.Model):</span><br><span class="line">    <span class="comment"># 名称</span></span><br><span class="line">    <span class="comment"># 单价</span></span><br><span class="line">    <span class="comment"># 描述</span></span><br><span class="line">    <span class="comment"># 图片</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginUser</span>(models.Model):</span><br><span class="line">    <span class="comment"># 登录名</span></span><br><span class="line">    <span class="comment"># 登录口令</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ActiveModel</span>(models.Model):</span><br><span class="line">    <span class="comment"># 名称</span></span><br><span class="line">    <span class="comment"># 图片</span></span><br><span class="line">    <span class="comment"># 开始时间</span></span><br><span class="line">    <span class="comment"># 结束时间</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ActiveGoodsModel</span>(model.Model):</span><br><span class="line">    <span class="comment"># 活动ID - ForiegnKey(ActiveModel=)</span></span><br><span class="line">    <span class="comment"># 商品ID - ForeignKey(Goods, related_name=)</span></span><br><span class="line">    <span class="comment"># 折扣 rate  小数</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 增加订单和订单详情模型</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="二、Django中引入富文本方案"><a href="#二、Django中引入富文本方案" class="headerlink" title="二、Django中引入富文本方案"></a>二、Django中引入富文本方案</h2><h3 id="2-1-tinymce方案"><a href="#2-1-tinymce方案" class="headerlink" title="2.1 tinymce方案"></a>2.1 tinymce方案</h3><h3 id="2-2-mdeditor方案"><a href="#2-2-mdeditor方案" class="headerlink" title="2.2 mdeditor方案"></a>2.2 mdeditor方案</h3><h3 id="2-3-ueditor方案"><a href="#2-3-ueditor方案" class="headerlink" title="2.3 ueditor方案"></a>2.3 ueditor方案</h3><p>参考文档：<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/d236a33a8c01">http://www.jianshu.com/p/d236a33a8c01</a></p>
<h1 id="WEB后端服务第20天-Django第10天"><a href="#WEB后端服务第20天-Django第10天" class="headerlink" title="WEB后端服务第20天-Django第10天"></a>WEB后端服务第20天-Django第10天</h1><h2 id="一、Django-RESTful框架入门"><a href="#一、Django-RESTful框架入门" class="headerlink" title="一、Django-RESTful框架入门"></a>一、Django-RESTful框架入门</h2><p>文档：<a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/">https://www.django-rest-framework.org/</a></p>
<h3 id="1-1-REST概要"><a href="#1-1-REST概要" class="headerlink" title="1.1  REST概要"></a>1.1  REST概要</h3><p><strong>概念</strong></p>
<p>​    REST即表述性状态传递（英文：Representational State Transfer，简称REST）是Roy Fielding博士在2000年他的博士论文中提出来的一种软件架构风格。它是一种针对网络应用的设计和开发方式，可以降低开发的复杂性，提高系统的可伸缩性。</p>
<p>​    REST通常基于使用HTTP，URI，和XML（标准通用标记语言下的一个子集）以及HTML（标准通用标记语言下的一个应用）这些现有的广泛流行的协议和标准。RESTful API设计规范：<a target="_blank" rel="noopener" href="http://wangwei.info/about-rest-api/">http://wangwei.info/about-rest-api/</a></p>
<p><strong>RESTful API四大基本原则：</strong></p>
<ul>
<li>为每个资源设置URI</li>
<li>通过XML / JSON进行数据传递</li>
<li>无状态连接，服务器端不应保存过多上下文状态，即每个请求都是独立的</li>
<li>使用HTTP动词：GET POST PUT DELETE</li>
</ul>
<h3 id="1-2-安装包"><a href="#1-2-安装包" class="headerlink" title="1.2 安装包"></a>1.2 安装包</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install djangorestframework markdown django-<span class="built_in">filter</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-开始使用"><a href="#1-3-开始使用" class="headerlink" title="1.3 开始使用"></a>1.3 开始使用</h3><h4 id="1-3-1-创建api包，并在init-py中声明api-router对象"><a href="#1-3-1-创建api包，并在init-py中声明api-router对象" class="headerlink" title="1.3.1 创建api包，并在init.py中声明api_router对象"></a>1.3.1 创建api包，并在init.py中声明api_router对象</h4><h4 id="1-3-2-在api包下创建user-py脚本，并在脚本中声明序列化类和视图"><a href="#1-3-2-在api包下创建user-py脚本，并在脚本中声明序列化类和视图" class="headerlink" title="1.3.2 在api包下创建user.py脚本，并在脚本中声明序列化类和视图"></a>1.3.2 在api包下创建user.py脚本，并在脚本中声明序列化类和视图</h4><h4 id="1-3-3-在init-py脚本中，注册视图"><a href="#1-3-3-在init-py脚本中，注册视图" class="headerlink" title="1.3.3 在init.py脚本中，注册视图"></a>1.3.3 在init.py脚本中，注册视图</h4><h4 id="1-3-4-主urls-py配置和settings-py配置"><a href="#1-3-4-主urls-py配置和settings-py配置" class="headerlink" title="1.3.4 主urls.py配置和settings.py配置"></a>1.3.4 主urls.py配置和settings.py配置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">	<span class="string">&#x27;DEFAULT_PAGINATION_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.pagination.PageNumberPagination&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PAGE_SIZE&#x27;</span>: <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-5-访问并尝试CURD操作"><a href="#1-3-5-访问并尝试CURD操作" class="headerlink" title="1.3.5 访问并尝试CURD操作"></a>1.3.5 访问并尝试CURD操作</h4><h2 id="二、数据序列化"><a href="#二、数据序列化" class="headerlink" title="二、数据序列化"></a>二、数据序列化</h2><p>序列化：将模型类对象转成json格式字符串的数据，并返回给前端。可以序列化一个模型类对象，也可以序列化多个模型类对象queryset(many=True)</p>
<p>反序列化：将json数据转换成模型类对象，反序列化还可以用来进一步验证信息和保存数据，但验证的时候不一定保存数据入库，但是保存数据入库的时候一定要验证数据。</p>
<p>序列化和反序列化的功能本质上都属于序列化器的功能。</p>
<h3 id="2-1-三种序列化类"><a href="#2-1-三种序列化类" class="headerlink" title="2.1 三种序列化类"></a>2.1 三种序列化类</h3><ul>
<li><p>Serializer</p>
<ul>
<li>声明相关的字段</li>
<li>实现create(**validate_data)和update(instance, **validate_data)两个函数</li>
</ul>
</li>
<li><p>ModelSerializer</p>
<p>声明class的Meta类，并指定相关属性</p>
<ul>
<li>model</li>
<li>fields字段列表</li>
</ul>
</li>
<li><p>HyperlinkedModelSerializer</p>
</li>
</ul>
<h3 id="2-2-序列化与反序列化"><a href="#2-2-序列化与反序列化" class="headerlink" title="2.2 序列化与反序列化"></a>2.2 序列化与反序列化</h3><ul>
<li>查询模型类的数据：对象，queryset+many=True</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> api.user <span class="keyword">import</span> UserSerializer</span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> UserModel</span><br><span class="line"></span><br><span class="line">s1 = UserSerializer(UserModel.objects.get(pk=<span class="number">1</span>))</span><br><span class="line">s2 = UserSerializer(UserModel.objects.<span class="built_in">all</span>(), many=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将模型的对象转成dict或list</span></span><br><span class="line">s1.data</span><br><span class="line">s2.data</span><br></pre></td></tr></table></figure>

<ul>
<li><p>content =JSONReader().reader(serializer.data) 渲染成json数据的字符串</p>
</li>
<li><p>JSONParser().parse(io.BytesIO(content))对已渲染的json字符串进行反序列化</p>
<p>可以在views视图处理函数中使用，对于POST请求对象，可以直接使用JSONParser()对象对request请求对象进行反向解析。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data = JSONParser().parse(request)</span><br><span class="line"></span><br><span class="line">serializer = UserSerializer(data=data)</span><br><span class="line">serializer.save()  <span class="comment"># 将数据保存到数据库中</span></span><br></pre></td></tr></table></figure>

<p>【注意】序列化类创建时常用的参数：instance、data、context、partial、many</p>
<h3 id="2-3-关联关系的序列化"><a href="#2-3-关联关系的序列化" class="headerlink" title="2.3 关联关系的序列化"></a>2.3 关联关系的序列化</h3><ul>
<li>serializers.StringRelatedField 获取关联模型类对象的str()返回的字符串</li>
<li>serializers.PrimarykeyRelatedField 获取关联模型对象的pk主键id值</li>
<li>serializers.SlugRelatedField(slug_field=’关联模型的字段’)</li>
<li>serializers.HyperlinkedRelatedField</li>
</ul>
<p>如果关联的模型存在序列化类，则内嵌关联模型的序列化类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ActiveGoodsSerializer</span>(serializers.HyperlinkedModelSerializer):</span><br><span class="line">    goods = GoodsSerializer()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = ActiveGoodsModel</span><br><span class="line">        fields = (<span class="string">&#x27;goods&#x27;</span>, <span class="string">&#x27;rate&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ActiveSerializer</span>(serializers.HyperlinkedModelSerializer):</span><br><span class="line">    <span class="comment"># activies = serializers.StringRelatedField(many=True)</span></span><br><span class="line">    activies = ActiveGoodsSerializer(many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = ActiveModel</span><br><span class="line">        fields = (<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;start_time&#x27;</span>, <span class="string">&#x27;end_time&#x27;</span>, <span class="string">&#x27;img1&#x27;</span>, <span class="string">&#x27;activies&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="三、请求与响应"><a href="#三、请求与响应" class="headerlink" title="三、请求与响应"></a>三、请求与响应</h2><h3 id="3-1-请求对象Request"><a href="#3-1-请求对象Request" class="headerlink" title="3.1 请求对象Request"></a>3.1 请求对象Request</h3><p>继承HttpRequest，扩展了一部分功能，增加data属性，可以处理PUT/PATCH/POST方法的参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.data  <span class="comment"># request.POST</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-响应对象Response"><a href="#3-2-响应对象Response" class="headerlink" title="3.2 响应对象Response"></a>3.2 响应对象Response</h3><p>继承TemplateResponse，在创建响应对象时，提供data属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> Response(data)</span><br></pre></td></tr></table></figure>

<p>rest_framework框架提供status模块，提供响应的信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">HTTP_100_CONTINUE = <span class="number">100</span></span><br><span class="line">HTTP_101_SWITCHING_PROTOCOLS = <span class="number">101</span></span><br><span class="line">HTTP_200_OK = <span class="number">200</span></span><br><span class="line">HTTP_201_CREATED = <span class="number">201</span></span><br><span class="line">HTTP_202_ACCEPTED = <span class="number">202</span></span><br><span class="line">HTTP_203_NON_AUTHORITATIVE_INFORMATION = <span class="number">203</span></span><br><span class="line">HTTP_204_NO_CONTENT = <span class="number">204</span></span><br><span class="line">HTTP_205_RESET_CONTENT = <span class="number">205</span></span><br><span class="line">HTTP_206_PARTIAL_CONTENT = <span class="number">206</span></span><br><span class="line">HTTP_207_MULTI_STATUS = <span class="number">207</span></span><br><span class="line">HTTP_208_ALREADY_REPORTED = <span class="number">208</span></span><br><span class="line">HTTP_226_IM_USED = <span class="number">226</span></span><br><span class="line">HTTP_300_MULTIPLE_CHOICES = <span class="number">300</span></span><br><span class="line">HTTP_301_MOVED_PERMANENTLY = <span class="number">301</span></span><br><span class="line">HTTP_302_FOUND = <span class="number">302</span></span><br><span class="line">HTTP_303_SEE_OTHER = <span class="number">303</span></span><br><span class="line">HTTP_304_NOT_MODIFIED = <span class="number">304</span></span><br><span class="line">HTTP_305_USE_PROXY = <span class="number">305</span></span><br><span class="line">HTTP_306_RESERVED = <span class="number">306</span></span><br><span class="line">HTTP_307_TEMPORARY_REDIRECT = <span class="number">307</span></span><br><span class="line">HTTP_308_PERMANENT_REDIRECT = <span class="number">308</span></span><br><span class="line">HTTP_400_BAD_REQUEST = <span class="number">400</span></span><br><span class="line">HTTP_401_UNAUTHORIZED = <span class="number">401</span></span><br><span class="line">HTTP_402_PAYMENT_REQUIRED = <span class="number">402</span></span><br><span class="line">HTTP_403_FORBIDDEN = <span class="number">403</span></span><br><span class="line">HTTP_404_NOT_FOUND = <span class="number">404</span></span><br><span class="line">HTTP_405_METHOD_NOT_ALLOWED = <span class="number">405</span></span><br><span class="line">HTTP_406_NOT_ACCEPTABLE = <span class="number">406</span></span><br><span class="line">HTTP_407_PROXY_AUTHENTICATION_REQUIRED = <span class="number">407</span></span><br><span class="line">HTTP_408_REQUEST_TIMEOUT = <span class="number">408</span></span><br><span class="line">HTTP_409_CONFLICT = <span class="number">409</span></span><br><span class="line">HTTP_410_GONE = <span class="number">410</span></span><br><span class="line">HTTP_411_LENGTH_REQUIRED = <span class="number">411</span></span><br><span class="line">HTTP_412_PRECONDITION_FAILED = <span class="number">412</span></span><br><span class="line">HTTP_413_REQUEST_ENTITY_TOO_LARGE = <span class="number">413</span></span><br><span class="line">HTTP_414_REQUEST_URI_TOO_LONG = <span class="number">414</span></span><br><span class="line">HTTP_415_UNSUPPORTED_MEDIA_TYPE = <span class="number">415</span></span><br><span class="line">HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE = <span class="number">416</span></span><br><span class="line">HTTP_417_EXPECTATION_FAILED = <span class="number">417</span></span><br><span class="line">HTTP_418_IM_A_TEAPOT = <span class="number">418</span></span><br><span class="line">HTTP_422_UNPROCESSABLE_ENTITY = <span class="number">422</span></span><br><span class="line">HTTP_423_LOCKED = <span class="number">423</span></span><br><span class="line">HTTP_424_FAILED_DEPENDENCY = <span class="number">424</span></span><br><span class="line">HTTP_426_UPGRADE_REQUIRED = <span class="number">426</span></span><br><span class="line">HTTP_428_PRECONDITION_REQUIRED = <span class="number">428</span></span><br><span class="line">HTTP_429_TOO_MANY_REQUESTS = <span class="number">429</span></span><br><span class="line">HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE = <span class="number">431</span></span><br><span class="line">HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS = <span class="number">451</span></span><br><span class="line">HTTP_500_INTERNAL_SERVER_ERROR = <span class="number">500</span></span><br><span class="line">HTTP_501_NOT_IMPLEMENTED = <span class="number">501</span></span><br><span class="line">HTTP_502_BAD_GATEWAY = <span class="number">502</span></span><br><span class="line">HTTP_503_SERVICE_UNAVAILABLE = <span class="number">503</span></span><br><span class="line">HTTP_504_GATEWAY_TIMEOUT = <span class="number">504</span></span><br><span class="line">HTTP_505_HTTP_VERSION_NOT_SUPPORTED = <span class="number">505</span></span><br><span class="line">HTTP_506_VARIANT_ALSO_NEGOTIATES = <span class="number">506</span></span><br><span class="line">HTTP_507_INSUFFICIENT_STORAGE = <span class="number">507</span></span><br><span class="line">HTTP_508_LOOP_DETECTED = <span class="number">508</span></span><br><span class="line">HTTP_509_BANDWIDTH_LIMIT_EXCEEDED = <span class="number">509</span></span><br><span class="line">HTTP_510_NOT_EXTENDED = <span class="number">510</span></span><br><span class="line">HTTP_511_NETWORK_AUTHENTICATION_REQUIRED = <span class="number">511</span></span><br></pre></td></tr></table></figure>

<h2 id="四、API授权"><a href="#四、API授权" class="headerlink" title="四、API授权"></a>四、API授权</h2><h3 id="4-1-默认授权认证"><a href="#4-1-默认授权认证" class="headerlink" title="4.1 默认授权认证"></a>4.1 默认授权认证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">	<span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: [</span><br><span class="line">		<span class="string">&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认情况下，APIView中的相关接口方法是不验证权限（授权）的，对资源来说不是很安全。可以通过以下的方式增加验证。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    authentication_classes = (SessionAuthentication, BasicAuthentication)</span><br><span class="line">    permission_classes = (IsAuthenticated,)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, <span class="built_in">format</span>=<span class="literal">None</span></span>):</span><br><span class="line">        content = &#123;</span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: unicode(request.user),  <span class="comment"># `django.contrib.auth.User` 实例。</span></span><br><span class="line">            <span class="string">&#x27;auth&#x27;</span>: unicode(request.auth),  <span class="comment"># None</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Response(content)</span><br></pre></td></tr></table></figure>

<p>可以指定TokenAuthentication</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TokenAuthentication</span>(<span class="title class_ inherited__">BaseAuthentication</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Simple token based authentication.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Clients should authenticate by passing the token key in the &quot;Authorization&quot;</span></span><br><span class="line"><span class="string">    HTTP header, prepended with the string &quot;Token &quot;.  For example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Authorization: Token 401f7ac837da42b97f613d789819ff93537bee6a</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    keyword = <span class="string">&#x27;Token&#x27;</span></span><br><span class="line">    model = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_model</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.model <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self.model</span><br><span class="line">        <span class="keyword">from</span> rest_framework.authtoken.models <span class="keyword">import</span> Token</span><br><span class="line">        <span class="keyword">return</span> Token</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    A custom token model may be used, but must have the following properties.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    * key -- The string identifying the token</span></span><br><span class="line"><span class="string">    * user -- The user to which the token belongs</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">authenticate</span>(<span class="params">self, request</span>):</span><br><span class="line">        auth = get_authorization_header(request).split()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> auth <span class="keyword">or</span> auth[<span class="number">0</span>].lower() != self.keyword.lower().encode():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(auth) == <span class="number">1</span>:</span><br><span class="line">            msg = _(<span class="string">&#x27;Invalid token header. No credentials provided.&#x27;</span>)</span><br><span class="line">            <span class="keyword">raise</span> exceptions.AuthenticationFailed(msg)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(auth) &gt; <span class="number">2</span>:</span><br><span class="line">            msg = _(<span class="string">&#x27;Invalid token header. Token string should not contain spaces.&#x27;</span>)</span><br><span class="line">            <span class="keyword">raise</span> exceptions.AuthenticationFailed(msg)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            token = auth[<span class="number">1</span>].decode()</span><br><span class="line">        <span class="keyword">except</span> UnicodeError:</span><br><span class="line">            msg = _(<span class="string">&#x27;Invalid token header. Token string should not contain invalid characters.&#x27;</span>)</span><br><span class="line">            <span class="keyword">raise</span> exceptions.AuthenticationFailed(msg)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.authenticate_credentials(token)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">authenticate_credentials</span>(<span class="params">self, key</span>):</span><br><span class="line">        model = self.get_model()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            token = model.objects.select_related(<span class="string">&#x27;user&#x27;</span>).get(key=key)</span><br><span class="line">        <span class="keyword">except</span> model.DoesNotExist:</span><br><span class="line">            <span class="keyword">raise</span> exceptions.AuthenticationFailed(_(<span class="string">&#x27;Invalid token.&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> token.user.is_active:</span><br><span class="line">            <span class="keyword">raise</span> exceptions.AuthenticationFailed(_(<span class="string">&#x27;User inactive or deleted.&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (token.user, token)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">authenticate_header</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> self.keyword</span><br></pre></td></tr></table></figure>

<h3 id="4-2-自定义Token身份认证"><a href="#4-2-自定义Token身份认证" class="headerlink" title="4.2 自定义Token身份认证"></a>4.2 自定义Token身份认证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.translation <span class="keyword">import</span> ugettext_lazy <span class="keyword">as</span> _</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BaseAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> exceptions</span><br><span class="line"><span class="keyword">from</span> rest_framework.authtoken.models <span class="keyword">import</span> Token</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> HTTP_HEADER_ENCODING</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取请求头里的token信息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_authorization_header</span>(<span class="params">request</span>):</span><br><span class="line">    auth = request.META.get(<span class="string">&#x27;HTTP_AUTHORIZATION&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(auth, <span class="built_in">str</span>):</span><br><span class="line">        <span class="comment"># Work around django test client oddness</span></span><br><span class="line">        auth = auth.encode(HTTP_HEADER_ENCODING)</span><br><span class="line">    <span class="keyword">return</span> auth</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义的ExpiringTokenAuthentication认证方式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExpiringTokenAuthentication</span>(<span class="title class_ inherited__">BaseAuthentication</span>):</span><br><span class="line">    </span><br><span class="line">    model = Token</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">authenticate</span>(<span class="params">self, request</span>):</span><br><span class="line">        auth = get_authorization_header(request):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> auth:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                token = auth.decode()</span><br><span class="line">            <span class="keyword">except</span> UnicodeError:</span><br><span class="line">                msg = _(<span class="string">&#x27;验证token无效&#x27;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">raise</span> exceptions.AuthenticationFailed(msg)</span><br><span class="line">            <span class="keyword">return</span> self.authenticate_credentials(token)</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/python-web/" rel="tag"># python-web</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/17/python%E7%BB%84%E4%BB%B6/" rel="prev" title="python组件">
      <i class="fa fa-chevron-left"></i> python组件
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/09/05/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/" rel="next" title="实用工具">
      实用工具 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AC%AC11%E5%A4%A9"><span class="nav-text">WEB后端服务第11天</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81Django%E5%85%A5%E9%97%A8"><span class="nav-text">一、Django入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text">1.1 基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%88%9B%E5%BB%BA%E7%8E%AF%E5%A2%83%E4%B8%8Eapp%E9%A1%B9%E7%9B%AE"><span class="nav-text">1.2 创建环境与app项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-django%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-text">1.3 django项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-Django%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B"><span class="nav-text">1.4 Django请求流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E4%B8%8EORM%E6%A8%A1%E5%9E%8B"><span class="nav-text">二、数据库连接与ORM模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E9%85%8D%E7%BD%AE"><span class="nav-text">2.1 数据库连接配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8ORM%E6%A8%A1%E5%9E%8B"><span class="nav-text">2.2 初步使用ORM模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-CURD"><span class="nav-text">2.3 CURD</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81Admin%E7%9A%84site%E7%AB%99%E7%82%B9%E9%85%8D%E7%BD%AE"><span class="nav-text">三、Admin的site站点配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B-%E6%B0%B4%E6%9E%9C%E7%AE%A1%E7%90%86"><span class="nav-text">四、综合案例-水果管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="nav-text">3.1 模型设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-text">3.2 模板的基本使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1"><span class="nav-text">3.3 页面设计</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AC%AC12%E5%A4%A9-Django%E7%AC%AC%E4%BA%8C%E5%A4%A9"><span class="nav-text">WEB后端服务第12天-Django第二天</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81ORM%E6%A8%A1%E5%9E%8B%E4%B9%8B%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%BA%A6%E6%9D%9F"><span class="nav-text">一、ORM模型之字段类型和约束</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="nav-text">1.1 字段类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E7%BA%A6%E6%9D%9F"><span class="nav-text">1.2 约束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-FileField%E5%92%8CImageField"><span class="nav-text">1.3 FileField和ImageField</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%A8%A1%E5%9E%8B%E7%9A%84Meta%E5%85%83%E4%BF%A1%E6%81%AF"><span class="nav-text">二、模型的Meta元信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%B8%B2%E6%9F%93%E6%A8%A1%E6%9D%BF%E7%9A%84render-%E6%96%B9%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B%E5%8F%82%E6%95%B0%EF%BC%8C%E5%88%86%E5%88%AB%E4%BB%A3%E8%A1%A8%E4%BB%80%E4%B9%88%E5%90%AB%E4%B9%89"><span class="nav-text">3. 渲染模板的render()方法有哪些参数，分别代表什么含义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81CURD%E6%B7%B1%E5%BA%A6%E4%BD%BF%E7%94%A8"><span class="nav-text">三、CURD深度使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E4%BA%86%E8%A7%A3%E6%A8%A1%E5%9E%8B%E7%B1%BB%E4%B8%AD%E7%9A%84objects%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-text">3.1 了解模型类中的objects是什么？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-filter%E5%92%8Cexclude%E6%9F%A5%E8%AF%A2"><span class="nav-text">3.2 filter和exclude查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-QuerySet%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-text">3.3 QuerySet对象的方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AC%AC13%E5%A4%A9-Django%E7%AC%AC%E4%B8%89%E5%A4%A9"><span class="nav-text">WEB后端服务第13天-Django第三天</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81F%E5%92%8CQ%E7%9A%84%E7%94%A8%E6%B3%95"><span class="nav-text">一、F和Q的用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%8E%9F%E7%94%9F%E7%9A%84SQL%E8%AF%AD%E5%8F%A5%E6%9F%A5%E8%AF%A2"><span class="nav-text">二、原生的SQL语句查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E6%A8%A1%E5%9E%8B%E7%B1%BB%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text">三、模型类之间的关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E6%89%A9%E5%B1%95%EF%BC%9A%E6%98%BE%E6%80%A7%E6%96%B9%E5%BC%8F%E5%88%9B%E5%BB%BAobjects"><span class="nav-text">3.1 扩展：显性方式创建objects</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E4%B8%80%E5%AF%B9%E4%B8%80%E5%85%B3%E7%B3%BB"><span class="nav-text">3.2 一对一关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E4%B8%80%E5%AF%B9%E5%A4%9A%E6%88%96%E5%A4%9A%E5%AF%B9%E4%B8%80%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text">3.3 一对多或多对一的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E5%A4%9A%E5%AF%B9%E5%A4%9A"><span class="nav-text">3.4 多对多</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AC%AC14%E5%A4%A9-Django%E7%AC%AC%E5%9B%9B%E5%A4%A9"><span class="nav-text">WEB后端服务第14天-Django第四天</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E6%A8%A1%E5%9E%8B%E5%85%B3%E7%B3%BB%E7%9A%84%E6%B7%B1%E5%85%A5%E5%BA%94%E7%94%A8"><span class="nav-text">一、模型关系的深入应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-text">1.1 多对多的应用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95"><span class="nav-text">二、模板语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-MTV%E8%AE%BE%E8%AE%A1%E4%B8%ADTV%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text">2.1 MTV设计中TV的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="nav-text">2.2 模板的加载过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%A8%A1%E6%9D%BF%E4%B8%AD%E4%BD%BF%E7%94%A8%E2%80%9C-%E2%80%9D%E7%82%B9%E8%AF%AD%E6%B3%95"><span class="nav-text">2.3 模板中使用“.”点语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%87%E7%AD%BE"><span class="nav-text">2.4 表达式标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E6%A8%A1%E6%9D%BF%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-text">2.5 模板的过滤器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-%E6%89%A9%E5%B1%95%EF%BC%9Aos-stat-%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F"><span class="nav-text">2.7 扩展：os.stat()获取文件大小</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AC%AC15%E5%A4%A9-Django%E7%AC%AC%E4%BA%94%E5%A4%A9"><span class="nav-text">WEB后端服务第15天-Django第五天</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81csrf%EF%BC%88%E9%98%B2%E6%AD%A2%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%EF%BC%89"><span class="nav-text">一、csrf（防止跨站请求伪造）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-csrf-token%E6%A0%87%E7%AD%BE"><span class="nav-text">1.1 csrf_token标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%8F%96%E6%B6%88csrf"><span class="nav-text">1.2 取消csrf</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%A8%A1%E6%9D%BF%E5%B8%83%E5%B1%80%E6%A0%87%E7%AD%BE"><span class="nav-text">二、模板布局标签</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-block-extends-include"><span class="nav-text">2.1 block&#x2F;extends&#x2F;include</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%98%BE%E7%A4%BA%E7%88%B6%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%86%85%E5%AE%B9"><span class="nav-text">2.2 显示父模板的内容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81app%E6%A8%A1%E5%9D%97%E5%86%85%E9%83%A8%E6%A8%A1%E6%9D%BF"><span class="nav-text">三、app模块内部模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81URL%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="nav-text">四、URL路由配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-URL%E5%88%86%E4%BA%8C%E7%BA%A7%EF%BC%88%E6%80%BB%E8%B7%AF%E7%94%B1%E5%92%8C%E5%AD%90%E8%B7%AF%E7%94%B1%EF%BC%88app%E6%A8%A1%E5%9D%97%E7%9A%84%E8%B7%AF%E7%94%B1%EF%BC%89%EF%BC%89"><span class="nav-text">4.1 URL分二级（总路由和子路由（app模块的路由））</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-url%E5%92%8Cpath%E4%B8%A4%E7%A7%8D%E8%B7%AF%E7%94%B1%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-text">4.2 url和path两种路由的配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="nav-text">五、反向解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E4%BD%BF%E7%94%A8include%E7%9A%84namespace%E5%92%8Cpath%E7%9A%84name%E5%B1%9E%E6%80%A7"><span class="nav-text">5.1 使用include的namespace和path的name属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E5%9C%A8%E7%BD%91%E9%A1%B5%E4%B8%AD%E8%8E%B7%E5%8F%96%E8%B7%AF%E5%BE%84"><span class="nav-text">5.2 在网页中获取路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E5%9C%A8%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0%E4%B8%AD%E8%8E%B7%E5%8F%96%E8%B7%AF%E5%BE%84"><span class="nav-text">5.3 在视图函数中获取路径</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89error%E8%A7%86%E5%9B%BE%E6%A8%A1%E6%9D%BF"><span class="nav-text">六、自定义error视图模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E6%A8%A1%E5%9E%8B%E7%B1%BB%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-text">七、模型类扩展知识点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-validators%E9%AA%8C%E8%AF%81"><span class="nav-text">7.1 validators验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-QuerySet%E7%9A%84bulk-create-%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BA"><span class="nav-text">7.2 QuerySet的bulk_create([])批量创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-QuerySet-values-%E6%88%96values-list-%E8%BF%94%E5%9B%9E%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5"><span class="nav-text">7.3 QuerySet.values()或values_list()返回指定字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-request%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="nav-text">7.4 request请求对象的属性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AC%AC16%E5%A4%A9-Django%E7%AC%AC6%E5%A4%A9"><span class="nav-text">WEB后端服务第16天-Django第6天</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94%E8%AF%A6%E8%A7%A3"><span class="nav-text">一、请求与响应详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-request%E5%AF%B9%E8%B1%A1"><span class="nav-text">1.1 request对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-1-%E6%89%A9%E5%B1%95%EF%BC%9Amysql%E8%BF%9E%E6%8E%A5%E9%85%8D%E7%BD%AE"><span class="nav-text">1.1.1 扩展：mysql连接配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-2-%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1%E4%B8%AD%E7%9A%84QueryDict%E5%B1%9E%E6%80%A7"><span class="nav-text">1.1.2 请求对象中的QueryDict属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-3-%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1%E4%B8%AD%E7%9A%84%E6%99%AE%E9%80%9A%E4%BF%A1%E6%81%AF"><span class="nav-text">1.1.3 请求对象中的普通信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-response%E5%AF%B9%E8%B1%A1"><span class="nav-text">1.2 response对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3"><span class="nav-text">二、会话技术详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-cookie"><span class="nav-text">2.1 cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-session"><span class="nav-text">2.2 session</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-Token"><span class="nav-text">2.3 Token</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AC%AC17%E5%A4%A9-Django%E7%AC%AC7%E5%A4%A9"><span class="nav-text">WEB后端服务第17天-Django第7天</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-text">一、验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E9%AA%8C%E8%AF%81%E7%A0%81%E6%96%B9%E5%BC%8F"><span class="nav-text">1.1 验证码方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E9%AA%8C%E8%AF%81%E7%A0%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">1.2 验证码使用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%9F%BA%E4%BA%8EPIL%E5%BA%93%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-text">1.3 基于PIL库实现图片验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-1-PIL%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8"><span class="nav-text">1.3.1 PIL初步使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-2-%E9%9A%8F%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-text">1.3.2 随机验证码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%88%86%E9%A1%B5%E5%99%A8Paginator"><span class="nav-text">二、分页器Paginator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1"><span class="nav-text">1.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-response-set-cookie-%E6%96%B9%E6%B3%95%E7%9A%84%E5%8F%82%E6%95%B0%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="nav-text">2. response.set_cookie()方法的参数有哪些</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%B8%85%E9%99%A4%E6%89%80%E6%9C%89session%E7%9A%84%E6%96%B9%E6%B3%95%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">3. 清除所有session的方法是什么</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%B1%BB%E8%A7%86%E5%9B%BECBV"><span class="nav-text">三、类视图CBV</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E6%A6%82%E5%BF%B5"><span class="nav-text">3.1 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Django%E6%8F%90%E4%BE%9B%E5%BE%88%E5%A4%9A%E7%9A%84View"><span class="nav-text">3.2 Django提供很多的View</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E4%BD%BF%E7%94%A8%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="nav-text">3.3 使用的过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E4%B8%AD%E9%97%B4%E4%BB%B6Middleware"><span class="nav-text">四、中间件Middleware</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E6%A6%82%E5%BF%B5"><span class="nav-text">4.1 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-text">4.2 自定义中间件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81Django%E6%97%A5%E5%BF%97"><span class="nav-text">五、Django日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-Django%E6%97%A5%E5%BF%97LOGGING%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="nav-text">5.1 Django日志LOGGING的组成部分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97"><span class="nav-text">5.2 配置日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E4%BD%BF%E7%94%A8%E6%97%A5%E5%BF%97"><span class="nav-text">5.3 使用日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E7%BC%93%E5%AD%98Cache"><span class="nav-text">六、缓存Cache</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E9%85%8D%E7%BD%AE%E7%BC%93%E5%AD%98"><span class="nav-text">6.1 配置缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-1-%E6%96%87%E4%BB%B6%E7%BC%93%E5%AD%98"><span class="nav-text">6.1.1 文件缓存</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98"><span class="nav-text">6.2 使用缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-%E6%96%87%E4%BB%B6%E7%BC%93%E5%AD%98%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">6.2.1 文件缓存的使用</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AC%AC18%E5%A4%A9-Django%E7%AC%AC8%E5%A4%A9"><span class="nav-text">WEB后端服务第18天-Django第8天</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81Django%E7%BC%93%E5%AD%98%E8%BF%9B%E9%98%B6"><span class="nav-text">一、Django缓存进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-cache-page%E9%A1%B5%E9%9D%A2%E7%BC%93%E5%AD%98"><span class="nav-text">1.1 cache_page页面缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Redis%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE"><span class="nav-text">1.2 Redis缓存配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-Session%E7%BC%93%E5%AD%98"><span class="nav-text">1.3 Session缓存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Django%E4%BF%A1%E5%8F%B7%E6%9C%BA%E5%88%B6"><span class="nav-text">二、Django信号机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E4%BF%A1%E5%8F%B7%E7%9A%84%E4%BC%98%E7%82%B9"><span class="nav-text">2.1 信号的优点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%8E%A5%E6%94%B6%E5%86%85%E7%BD%AE%E7%9A%84%E4%BF%A1%E5%8F%B7"><span class="nav-text">2.2 接收内置的信号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BF%A1%E5%8F%B7"><span class="nav-text">2.3 自定义信号</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E9%AB%98%E5%B9%B6%E5%8F%91%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88Celery-Redis%E9%98%9F%E5%88%97"><span class="nav-text">三、高并发解决方案Celery+Redis队列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E6%A6%82%E5%BF%B5-1"><span class="nav-text">3.1 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E9%85%8D%E7%BD%AE"><span class="nav-text">3.2 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E6%8A%A2%E8%B4%AD%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">3.3 抢购的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-Celery%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="nav-text">3.4 Celery其他配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AC%AC19%E5%A4%A9-Django%E7%AC%AC9%E5%A4%A9"><span class="nav-text">WEB后端服务第19天-Django第9天</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E4%BA%8ECelery-Redis%E5%AE%9E%E7%8E%B0%E6%8A%A2%E8%B4%AD%E6%96%B9%E6%A1%88"><span class="nav-text">一、基于Celery+Redis实现抢购方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E4%B8%9A%E5%8A%A1%E6%8F%8F%E8%BF%B0"><span class="nav-text">1.1 业务描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%9E%8B%E7%B1%BB"><span class="nav-text">1.2 设计模型类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Django%E4%B8%AD%E5%BC%95%E5%85%A5%E5%AF%8C%E6%96%87%E6%9C%AC%E6%96%B9%E6%A1%88"><span class="nav-text">二、Django中引入富文本方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-tinymce%E6%96%B9%E6%A1%88"><span class="nav-text">2.1 tinymce方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-mdeditor%E6%96%B9%E6%A1%88"><span class="nav-text">2.2 mdeditor方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-ueditor%E6%96%B9%E6%A1%88"><span class="nav-text">2.3 ueditor方案</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AC%AC20%E5%A4%A9-Django%E7%AC%AC10%E5%A4%A9"><span class="nav-text">WEB后端服务第20天-Django第10天</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81Django-RESTful%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8"><span class="nav-text">一、Django-RESTful框架入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-REST%E6%A6%82%E8%A6%81"><span class="nav-text">1.1  REST概要</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%AE%89%E8%A3%85%E5%8C%85"><span class="nav-text">1.2 安装包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8"><span class="nav-text">1.3 开始使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-1-%E5%88%9B%E5%BB%BAapi%E5%8C%85%EF%BC%8C%E5%B9%B6%E5%9C%A8init-py%E4%B8%AD%E5%A3%B0%E6%98%8Eapi-router%E5%AF%B9%E8%B1%A1"><span class="nav-text">1.3.1 创建api包，并在init.py中声明api_router对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-2-%E5%9C%A8api%E5%8C%85%E4%B8%8B%E5%88%9B%E5%BB%BAuser-py%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%B9%B6%E5%9C%A8%E8%84%9A%E6%9C%AC%E4%B8%AD%E5%A3%B0%E6%98%8E%E5%BA%8F%E5%88%97%E5%8C%96%E7%B1%BB%E5%92%8C%E8%A7%86%E5%9B%BE"><span class="nav-text">1.3.2 在api包下创建user.py脚本，并在脚本中声明序列化类和视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-3-%E5%9C%A8init-py%E8%84%9A%E6%9C%AC%E4%B8%AD%EF%BC%8C%E6%B3%A8%E5%86%8C%E8%A7%86%E5%9B%BE"><span class="nav-text">1.3.3 在init.py脚本中，注册视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-4-%E4%B8%BBurls-py%E9%85%8D%E7%BD%AE%E5%92%8Csettings-py%E9%85%8D%E7%BD%AE"><span class="nav-text">1.3.4 主urls.py配置和settings.py配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-5-%E8%AE%BF%E9%97%AE%E5%B9%B6%E5%B0%9D%E8%AF%95CURD%E6%93%8D%E4%BD%9C"><span class="nav-text">1.3.5 访问并尝试CURD操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-text">二、数据序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E4%B8%89%E7%A7%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%B1%BB"><span class="nav-text">2.1 三种序列化类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-text">2.2 序列化与反序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-text">2.3 关联关系的序列化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94"><span class="nav-text">三、请求与响应</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1Request"><span class="nav-text">3.1 请求对象Request</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1Response"><span class="nav-text">3.2 响应对象Response</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81API%E6%8E%88%E6%9D%83"><span class="nav-text">四、API授权</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E9%BB%98%E8%AE%A4%E6%8E%88%E6%9D%83%E8%AE%A4%E8%AF%81"><span class="nav-text">4.1 默认授权认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E8%87%AA%E5%AE%9A%E4%B9%89Token%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="nav-text">4.2 自定义Token身份认证</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Private</p>
  <div class="site-description" itemprop="description">程序语言记录</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Private</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
