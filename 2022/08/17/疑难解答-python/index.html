<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":true,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="python虚拟环境的常见命令原文：https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;d8833799d934  当做一个项目时，可能会用到一些模块，如果都用电脑自带的python环境，并且把所有的模块都安装在这上面，很容易使得自带python环境十分臃肿，而且到时候如果迁移到别的电脑时还需要重新安装对应模块，所以可以用虚拟环境，在不同的环境下安装对应的模块，迁移时也把整个环境迁移过去即可使用虚">
<meta property="og:type" content="article">
<meta property="og:title" content="疑难解答-python">
<meta property="og:url" content="http://example.com/2022/08/17/%E7%96%91%E9%9A%BE%E8%A7%A3%E7%AD%94-python/index.html">
<meta property="og:site_name" content="PeacefulRace">
<meta property="og:description" content="python虚拟环境的常见命令原文：https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;d8833799d934  当做一个项目时，可能会用到一些模块，如果都用电脑自带的python环境，并且把所有的模块都安装在这上面，很容易使得自带python环境十分臃肿，而且到时候如果迁移到别的电脑时还需要重新安装对应模块，所以可以用虚拟环境，在不同的环境下安装对应的模块，迁移时也把整个环境迁移过去即可使用虚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/202011191801199.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201119181741118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201119180815208.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201119180916654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2020111918101447.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201119181418500.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/24e14282389344a5ba64e93b786faf7d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARGFuaWVsX1hpZV84NA==,size_20,color_FFFFFF,t_70,g_se,x_16">
<meta property="og:image" content="https://img-blog.csdnimg.cn/453a8745f36b44a4aaec6faae1033d3b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARGFuaWVsX1hpZV84NA==,size_20,color_FFFFFF,t_70,g_se,x_16">
<meta property="og:image" content="https://img-blog.csdnimg.cn/09054a3da7b14c35af8756b04954cb5e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARGFuaWVsX1hpZV84NA==,size_20,color_FFFFFF,t_70,g_se,x_16">
<meta property="og:image" content="https://img-blog.csdnimg.cn/a0726661a71b48fca3ff574f394655ed.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARGFuaWVsX1hpZV84NA==,size_20,color_FFFFFF,t_70,g_se,x_16">
<meta property="og:image" content="https://img-blog.csdnimg.cn/db8a76d9d91340ca9607cfcfc6e24763.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARGFuaWVsX1hpZV84NA==,size_20,color_FFFFFF,t_70,g_se,x_16">
<meta property="og:image" content="https://img-blog.csdnimg.cn/db0e6deff567453cb7f4dab12fb7511a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQXNkenhjeXVpaGprcXdl,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/11cae4aca04f4468b62c872f60c2a756.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/06d7782d73f3445f89512dd4718ac967.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/fc4a64259d1944deb86a3b10fe39336a.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20191224115944580.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20c93d2929ec4a1b8e52a3d6baa4a38d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBATmFyY2lzc3VzYOWwj-aarg==,size_20,color_FFFFFF,t_70,g_se,x_16">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2e83a4ea95e44d30ba8f7dad5f2ce343.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/31924b5683e64ef3bc5efcb4fce45e6c.png">
<meta property="og:image" content="https://ghost.oss.sherlocky.com/2/b6/005d8038088246fa2ef2ff24fa7b9.png">
<meta property="og:image" content="https://images2018.cnblogs.com/blog/311516/201803/311516-20180301092953310-1075957612.png">
<meta property="og:image" content="https://images2018.cnblogs.com/blog/311516/201803/311516-20180301093125715-1619631377.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/5015daebd7d242448cf67ce5a320a52c.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/cd4f4ed238364438bbe9f4d8f90a3153.png">
<meta property="og:image" content="https://ask.qcloudimg.com/http-save/yehe-8223537/f923a908cfb9c07d8f96becaccfdbc87.png?imageView2/2/w/1620">
<meta property="og:image" content="https://ask.qcloudimg.com/http-save/yehe-8223537/3c84fc7008f2cf8f43c7fe78c21a43cb.png?imageView2/2/w/1620">
<meta property="og:image" content="https://ask.qcloudimg.com/http-save/yehe-8223537/638de9483aeab44a398e8e9d67d19b0d.png?imageView2/2/w/1620">
<meta property="og:image" content="https://ask.qcloudimg.com/http-save/yehe-8223537/399360a3793f6aca890fbb1835721664.png?imageView2/2/w/1620">
<meta property="og:image" content="https://pic3.zhimg.com/v2-efd1b807fe1437821873f03001cd8926_r.jpg">
<meta property="og:image" content="https://image.resetran.top/bolg_images/1594010413908.jpg">
<meta property="og:image" content="https://image.resetran.top/bolg_images/1594010616018.jpg">
<meta property="og:image" content="https://image.resetran.top/bolg_images/1594037026162.jpg">
<meta property="og:image" content="https://image.resetran.top/bolg_images/1594041407808.jpg">
<meta property="og:image" content="https://image.resetran.top/bolg_images/1594041429670.jpg">
<meta property="og:image" content="https://image.resetran.top/bolg_images/1594041443340.jpg">
<meta property="og:image" content="https://image.resetran.top/bolg_images/1594041878454.jpg">
<meta property="og:image" content="https://image.resetran.top/bolg_images/1594043291139.jpg">
<meta property="og:image" content="https://image.resetran.top/bolg_images/1594091758109.jpg">
<meta property="og:image" content="https://ask.qcloudimg.com/http-save/yehe-6525263/06eb6a1201bb48bfce6332b69be19668.png?imageView2/2/w/2560/h/7000">
<meta property="og:image" content="https://ask.qcloudimg.com/http-save/yehe-6525263/b042cf1d8c2cab85742fc8e74c7e04fb.png?imageView2/2/w/2560/h/7000">
<meta property="og:image" content="https://ask.qcloudimg.com/http-save/yehe-6525263/e5ea9fcdda825a408600a7e4f89c2a58.png?imageView2/2/w/2560/h/7000">
<meta property="og:image" content="https://ask.qcloudimg.com/http-save/yehe-6525263/93c3002ba703dd54eb7310433ab38a2d.png?imageView2/2/w/2560/h/7000">
<meta property="og:image" content="https://ask.qcloudimg.com/http-save/yehe-6525263/877ee8d87a735ff2a62f6a8a2909124d.png?imageView2/2/w/2560/h/7000">
<meta property="og:image" content="https://ask.qcloudimg.com/http-save/yehe-6525263/79c8edfc6957f80f93a41dd283e8913b.png?imageView2/2/w/2560/h/7000">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95ca9d5244284571bf641cf18a8bc842~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp">
<meta property="og:image" content="https://twilio-cms-prod.s3.amazonaws.com/images/tgB7FXmp5hTizg2kWabrersfXc28plHdKdNCPAp1CBwaEc.width-500.png">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d526a952e2a4fc595bbc19eee9e0891~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp">
<meta property="article:published_time" content="2022-08-17T02:16:24.923Z">
<meta property="article:modified_time" content="2023-03-18T04:54:58.011Z">
<meta property="article:author" content="Private">
<meta property="article:tag" content="问题排除记录">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/202011191801199.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center">

<link rel="canonical" href="http://example.com/2022/08/17/%E7%96%91%E9%9A%BE%E8%A7%A3%E7%AD%94-python/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>疑难解答-python | PeacefulRace</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">PeacefulRace</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">学习笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">6</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">27</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/17/%E7%96%91%E9%9A%BE%E8%A7%A3%E7%AD%94-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Private">
      <meta itemprop="description" content="程序语言记录">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PeacefulRace">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          疑难解答-python
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-17 10:16:24" itemprop="dateCreated datePublished" datetime="2022-08-17T10:16:24+08:00">2022-08-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-18 12:54:58" itemprop="dateModified" datetime="2023-03-18T12:54:58+08:00">2023-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/troubleshooting/" itemprop="url" rel="index"><span itemprop="name">troubleshooting</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="python虚拟环境的常见命令"><a href="#python虚拟环境的常见命令" class="headerlink" title="python虚拟环境的常见命令"></a>python虚拟环境的常见命令</h1><p>原文：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d8833799d934">https://www.jianshu.com/p/d8833799d934</a> </p>
<p>当做一个项目时，可能会用到一些模块，如果都用电脑自带的python环境，并且把所有的模块都安装在这上面，很容易使得自带python环境十分臃肿，而且到时候如果迁移到别的电脑时还需要重新安装对应模块，所以可以用虚拟环境，在不同的环境下安装对应的模块，迁移时也把整个环境迁移过去即可使用虚拟环境步骤</p>
<p>1.创建虚拟环境<br>输入命令：<code>virtualenv 环境名</code><br>（如果有多个python版本，可以通过命令：<code>virtualenv -p python路径 环境名</code>，来创建虚拟环境）<br>2.进入环境下的<code>Scripts</code>文件夹下<br>输入命令执行脚本：<code>activate</code><br>3.接下来就可以在该虚拟环境下pip安装包或者做各种事了，</p>
<p>比如要安装django2.0版本就可以：<code>pip install django==2.0</code></p>
<p><strong>退出虚拟环境</strong></p>
<p>输入命令：<code>deactivate</code></p>
<p><strong>管理虚拟环境</strong></p>
<p>虚拟环境还可以通过一些工具来管理，从而使用起来更加方便，这里推荐<code>virtualenvwrapper</code><br>输入命令：<code>pip install virtualenvwrapper-win</code>（window版），下载<code>virtualenvwrapper</code></p>
<p><strong>创建虚拟环境</strong></p>
<p>输入命令：<code>mkvirtualenv 环境名</code><br>与直接用virtualenv创建不同的是，前面那个是在当前文件夹下创建虚拟环境，而这个是统一在当前用户的<code>envs</code>文件夹下创建，并且会自动进入到该虚拟环境下<br>如果不想在默认地方创建（<code>c:userenvs</code>），可以新建个环境变量：<code>WORKON_HOME</code>，然后里面设置默认路径<br>如果要指定python版本，则输入：<code>mkvirtualenv --python=python路径（到exe文件） 环境名</code></p>
<p><strong>进入虚拟环境输入命令</strong>：<code>workon 环境名</code></p>
<p><strong>退出虚拟环境输入命令</strong>：<code>deactivate</code></p>
<p><strong>删除虚拟环境输入命令</strong>：<code>rmvirtualenv 环境名</code></p>
<p><strong>列出虚拟环境输入命令</strong>：<code>lsvirtualenv</code></p>
<p><strong>进入到虚拟环境目录输入命令</strong>：<code>cdvirtualenv 环境名</code></p>
<p>更多参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/codechangemyworld/p/5277032.html">https://www.cnblogs.com/codechangemyworld/p/5277032.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenxinming-top/p/7843178.html">https://www.cnblogs.com/chenxinming-top/p/7843178.html</a></p>
<h1 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h1><p>修改pip安装源：<br>在”c:\users***\pip&quot;下创建”pip.ini”文件<br>文件内写上：<br>[global]<br>index-url=<a target="_blank" rel="noopener" href="https://pypi.doubanio.com/simple">https://pypi.doubanio.com/simple</a></p>
<p>查看依赖库版本：pip freeze / pip list<br>安装指定版本依赖库：pip install ***==x.x.x<br>生成所需依赖库txt文件：pip freeze &gt; requirements.txt<br>根据已有依赖库txt文件安装库：pip install -r requirements.txt</p>
<h1 id="Python-flask-flask-script-报错：ModuleNotFoundError-No-module-named-‘flask-compat’解决方法"><a href="#Python-flask-flask-script-报错：ModuleNotFoundError-No-module-named-‘flask-compat’解决方法" class="headerlink" title="Python flask flask_script 报错：ModuleNotFoundError: No module named ‘flask._compat’解决方法"></a>Python flask flask_script 报错：ModuleNotFoundError: No module named ‘flask._compat’解决方法</h1><ul>
<li><a href="javascript:void(0);">levi</a> 编辑于 2021-06-27</li>
</ul>
<p>本文主要介绍Python中，使用flask中flask_script时，报错：ModuleNotFoundError: No module named ‘flask._compat’的解决方法，以及相关示例代码。</p>
<p><strong>manage.py：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from flask_script import Manager</span><br><span class="line">from main import app</span><br><span class="line">manager = Manager(app)</span><br><span class="line">@manager.command</span><br><span class="line">def hello():</span><br><span class="line">    print (&quot;hello&quot;)</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>

<p><strong>main.py:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br></pre></td></tr></table></figure>

<p><strong>报错信息：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(venv) cjavapy@cjavapy-PC:~/Proyectos Python/flask_script$ python3 manage.py hello</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;manage.py&quot;, line 1, in &lt;module&gt;</span><br><span class="line">    from flask_script import Manager</span><br><span class="line">  File &quot;/home/cjavapy/Proyectos Python/flask_script/venv/lib/python3.8/site-packages/flask_script/__init__.py&quot;, line 15, in &lt;module&gt;</span><br><span class="line">    from flask._compat import text_type</span><br><span class="line">ModuleNotFoundError: No module named &#x27;flask._compat&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>原因：</strong></p>
<p>可能是更新了Flask版本问题，导致<code>Flask._compat</code>的目录发生变化。</p>
<p><strong>解决方法：</strong></p>
<p>使用如下命令降级；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install &quot;Flask==1.1.4&quot;</span><br><span class="line">pip install &quot;werkzeug==1.0.1&quot;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<p>不使用<code>Flask-Script</code>，使用<code>flask</code>命令如下：</p>
<p>初始化数据库：<code>flask db init</code></p>
<p>迁移新更改：<code>flask db migrate</code></p>
<p>升级：<code>flask db upgrade</code></p>
<p>还有其它命令…</p>
<p>或者</p>
<p><strong>不降级则可以尝试修改一下<code>flask_script/__init__.py</code>中<code>from ._compat import text_type</code> 改成 <code>from flask_script._compat import text_type</code> 。</strong></p>
<h1 id="Error-Could-not-locate-a-Flask-application-You-did-not-provide-the-“FLASK-APP“-environment-variabl"><a href="#Error-Could-not-locate-a-Flask-application-You-did-not-provide-the-“FLASK-APP“-environment-variabl" class="headerlink" title="Error: Could not locate a Flask application. You did not provide the “FLASK_APP“ environment variabl"></a>Error: Could not locate a Flask application. You did not provide the “FLASK_APP“ environment variabl</h1><h2 id="报错详情"><a href="#报错详情" class="headerlink" title="报错详情"></a>报错详情</h2><p>flask环境下生成临时web可视网址时报错：<br>Error: Could not locate a Flask application. You did not provide the “FLASK_APP” <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=environment&spm=1001.2101.3001.7020">environment</a> variable, and a “wsgi.py” or “app.py” module was not found in the current directory.<br><img src="https://img-blog.csdnimg.cn/202011191801199.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center"></p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>解决很简单，因为=前后多了空格，没有识别到</p>
<blockquote>
<p>Set FLASK_APP=microblog.py<br>flask run</p>
</blockquote>
<p>就可以运行了。<br><img src="https://img-blog.csdnimg.cn/20201119181741118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center"></p>
<h2 id="没有解决问题原因1：可能是文件在目录中的位置不对"><a href="#没有解决问题原因1：可能是文件在目录中的位置不对" class="headerlink" title="没有解决问题原因1：可能是文件在目录中的位置不对"></a>没有解决问题原因1：可能是文件在目录中的位置不对</h2><p>附上我项目的目录，注意_init_.py文件，route.py文件都在blogapp目录下<br>主目录<br><img src="https://img-blog.csdnimg.cn/20201119180815208.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center"><br>blogapp目录<br><img src="https://img-blog.csdnimg.cn/20201119180916654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center"><br>templates目录（.env文件放在此目录下）<br><img src="https://img-blog.csdnimg.cn/2020111918101447.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yS3JhYnNfQ2FzaGllcg==,size_16,color_FFFFFF,t_70#pic_center"></p>
<h2 id="没有解决问题原因2：可能是flask指令时打开的位置不对"><a href="#没有解决问题原因2：可能是flask指令时打开的位置不对" class="headerlink" title="没有解决问题原因2：可能是flask指令时打开的位置不对"></a>没有解决问题原因2：可能是flask指令时打开的位置不对</h2><p>Windows环境下，在cmd中Set FLASK_APP=microblog.py的话，应该打开到有此py文件的目录下，不然找不到文件。（我的文件在blogapp下，所以打开到blogapp为止）<br><img src="https://img-blog.csdnimg.cn/20201119181418500.png#pic_center"><br>这就是目前经历过的一些问题，后续还有问题再做更改。</p>
<h1 id="【已解决】Python-3-10-使用pdf2docx报错ImportError-cannot-import-name-‘Iterable‘-from-‘collections‘的解决办法"><a href="#【已解决】Python-3-10-使用pdf2docx报错ImportError-cannot-import-name-‘Iterable‘-from-‘collections‘的解决办法" class="headerlink" title="【已解决】Python 3.10 使用pdf2docx报错ImportError:cannot import name ‘Iterable‘ from ‘collections‘的解决办法"></a>【已解决】Python 3.10 使用pdf2docx报错ImportError:cannot import name ‘Iterable‘ from ‘collections‘的解决办法</h1><p>本人初学Python，经推荐看到一个很简单快捷的pdf转docx方法，仅仅需要几行代码即可完成，于是想抄来用，但是因为我安装的Python是3.10.0版，运行的时候老是报错：ImportError:cannot import name ‘Iterable’ from ‘collections’，在“老表Max”的指导下，解决了此问题，感谢！</p>
<p>pdf2docx代码介绍：</p>
<p>Convert PDF — pdf2docx 0.5.2 documentation</p>
<p>运行报错状态：</p>
<p><img src="https://img-blog.csdnimg.cn/24e14282389344a5ba64e93b786faf7d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARGFuaWVsX1hpZV84NA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>原因查找：</p>
<p>经网上搜索，感谢几位网友的经验，应该是版本导致的问题</p>
<p><img src="https://img-blog.csdnimg.cn/453a8745f36b44a4aaec6faae1033d3b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARGFuaWVsX1hpZV84NA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>解决方法：</p>
<p>我尝试直接在代码前面加上‘from collections.abc import Iterable’, 测试结果是True,但是还是不能运行。经‘老表Max’指点，看最后一次报错的文件，去改那个文件的代码，然后保存即可 </p>
<p><img src="https://img-blog.csdnimg.cn/09054a3da7b14c35af8756b04954cb5e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARGFuaWVsX1hpZV84NA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/a0726661a71b48fca3ff574f394655ed.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARGFuaWVsX1hpZV84NA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>运行成功界面：</p>
<p><img src="https://img-blog.csdnimg.cn/db8a76d9d91340ca9607cfcfc6e24763.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBARGFuaWVsX1hpZV84NA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<h1 id="cannot-import-name-‘Mapping‘-from-‘collections‘"><a href="#cannot-import-name-‘Mapping‘-from-‘collections‘" class="headerlink" title="cannot import name ‘Mapping‘ from ‘collections‘"></a>cannot import name ‘Mapping‘ from ‘collections‘</h1><p>解决步骤：</p>
<p>①复制该地址<code>“C:\User\…\AppData\Local\Programs\Python\Python310\lib\collections_init_.py”</code><br>②打开这个地址<br>③加上这条语句：<code>from collections.abc import Mapping</code></p>
<p><img src="https://img-blog.csdnimg.cn/db0e6deff567453cb7f4dab12fb7511a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQXNkenhjeXVpaGprcXdl,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<p>保存，再输一遍，搞掂</p>
<p><img src="https://img-blog.csdnimg.cn/11cae4aca04f4468b62c872f60c2a756.png#pic_center" alt="在这里插入图片描述"></p>
<p>————————————————<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_51092297/article/details/122889327">https://blog.csdn.net/weixin_51092297/article/details/122889327</a></p>
<h1 id="AttributeError-module-‘collections‘-has-no-attribute-‘MutableMapping‘"><a href="#AttributeError-module-‘collections‘-has-no-attribute-‘MutableMapping‘" class="headerlink" title="AttributeError: module ‘collections‘ has no attribute ‘MutableMapping‘"></a>AttributeError: module ‘collections‘ has no attribute ‘MutableMapping‘</h1><p>情况说明<br>今天在装live server时遇到如下两个问题。</p>
<p>module ‘collections’ has no attribute ‘MutableSet’<br>AttributeError: module ‘collections’ has no attribute ‘MutableMapping’<br>部分错误结果如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(py3_django4-<span class="number">0</span>-<span class="number">4</span>) lds@lishuaige:~/Desktop/meiduo/front_end$ live-server </span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/home/lds/.local/bin/live-server&quot;</span>, line <span class="number">5</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">from</span> live_server.cli <span class="keyword">import</span> cli</span><br><span class="line">  File <span class="string">&quot;/home/lds/.local/lib/python3.10/site-packages/live_server/cli.py&quot;</span>, line <span class="number">4</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">from</span> . <span class="keyword">import</span> watcher</span><br><span class="line">  File <span class="string">&quot;/home/lds/.local/lib/python3.10/site-packages/live_server/watcher.py&quot;</span>, line <span class="number">7</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">from</span> . <span class="keyword">import</span> server</span><br><span class="line">  File <span class="string">&quot;/home/lds/.local/lib/python3.10/site-packages/live_server/server.py&quot;</span>, line <span class="number">5</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">import</span> tornado.web</span><br><span class="line">  File <span class="string">&quot;/home/lds/.local/lib/python3.10/site-packages/tornado/web.py&quot;</span>, line <span class="number">88</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">from</span> tornado <span class="keyword">import</span> httputil</span><br><span class="line">  File <span class="string">&quot;/home/lds/.local/lib/python3.10/site-packages/tornado/httputil.py&quot;</span>, line <span class="number">107</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">HTTPHeaders</span>(collections.MutableMapping):</span><br><span class="line">AttributeError: module <span class="string">&#x27;collections&#x27;</span> has no attribute <span class="string">&#x27;MutableMapping&#x27;</span></span><br></pre></td></tr></table></figure>

<p>解决方案<br>网上找了好多都是把问题贴出来然后就没下文了，琢磨了三四个小时幸亏解决了！！应该是python 3.10 那些 MutableMapping，MutableSet等放的位置变了，他们的上级模块原本直属collections的变成了abc，也就是说，需要把</p>
<p><code>collections.MutableMapping</code><br>改成</p>
<p><code>collections.abc.MutableMapping</code><br>那要怎么改呢？比如我这里报错，就点进源文件里面</p>
<p><img src="https://img-blog.csdnimg.cn/06d7782d73f3445f89512dd4718ac967.png" alt="在这里插入图片描述"></p>
<p>按上述方法修改即可。</p>
<p><img src="https://img-blog.csdnimg.cn/fc4a64259d1944deb86a3b10fe39336a.png" alt="在这里插入图片描述"></p>
<h1 id="Content-Type标头未在Tornado中设置"><a href="#Content-Type标头未在Tornado中设置" class="headerlink" title="Content-Type标头未在Tornado中设置"></a>Content-Type标头未在Tornado中设置</h1><p>我有以下基类：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CorsHandler</span>(tornado.web.RequestHandler):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_default_headers</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(CorsHandler, self).set_default_headers()</span><br><span class="line"></span><br><span class="line">        self.set_header(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, self.request.headers.get(<span class="string">&#x27;Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>))</span><br><span class="line">        self.set_header(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;GET, PUT, POST, DELETE, OPTIONS&#x27;</span>)</span><br><span class="line">        self.set_header(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">        self.set_header(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;,&#x27;</span>.join(</span><br><span class="line">            self.request.headers.get(<span class="string">&#x27;Access-Control-Request-Headers&#x27;</span>, <span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;,&#x27;</span>) +</span><br><span class="line">            [<span class="string">&#x27;Content-Type&#x27;</span>]</span><br><span class="line">        ))</span><br><span class="line"></span><br><span class="line">        self.set_header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">options</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>和以下处理程序：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, resource_id=<span class="literal">None</span>, field=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> resource_id <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            response = self.resource.query.filter_by(is_deleted=<span class="literal">False</span>).<span class="built_in">all</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record = self.resource.query.get(<span class="built_in">int</span>(resource_id))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> field <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                response = record</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                response = &#123;field: <span class="built_in">getattr</span>(record, field)&#125;</span><br><span class="line"></span><br><span class="line">        self.db.session.commit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">        self.db.session.rollback()</span><br><span class="line"></span><br><span class="line">        self.send_error(<span class="number">500</span>, message=e.message)</span><br><span class="line"></span><br><span class="line">    self.write(response)</span><br></pre></td></tr></table></figure>

<p>除了未设置Content-Type之外，其他所有内容都非常简单明了。请注意，其他任何标题均已正确设置。</p>
<p><strong>解决方案</strong></p>
<p>看来这是<code>304 Not Modified</code>回应。请记住，只有第一个<code>200 OK</code>响应包含<code>Content-Type</code>标头。如果您请求相同的资源，则以下响应将忽略此标头。</p>
<p>并且要注意，您实际上并不需要显式设置<code>Content-Type</code>。如果您查看Tornado的源代码，您将在以下注释中找到它<code>write(self, chunk)</code>：</p>
<blockquote>
<p>如果给定的块是字典，则将其编写为JSON并将响应的Content-Type设置为<code>application/json</code>。（如果您想以不同的方式发送JSON <code>Content-Type</code>，请<em>在</em>调用write（）<em>之后</em>调用set_header ）。</p>
</blockquote>
<h1 id="python报-DeprecationWarning-“-coroutine”-decorator-…-use-“async-def”-解决办法"><a href="#python报-DeprecationWarning-“-coroutine”-decorator-…-use-“async-def”-解决办法" class="headerlink" title="python报 DeprecationWarning: “@coroutine” decorator …. use “async def” 解决办法"></a>python报 DeprecationWarning: “@coroutine” decorator …. use “async def” 解决办法</h1><p>python报错：<br>DeprecationWarning: “@coroutine” decorator is deprecated since Python 3.8, use “async def” instea def logger_factory(app, handler):</p>
<p><img src="https://img-blog.csdnimg.cn/20191224115944580.png" alt="在这里插入图片描述"></p>
<p>报错原因：<br>用asyncio提供的@asyncio.coroutine可以把一个generator标记为coroutine类型，然后在coroutine内部用yield from调用另一个coroutine实现异步操作。<br>但是从Python 3.5开始引入了新的语法async和await，可以让coroutine的代码更简洁易读（抛弃了@asyncio.coroutine）。</p>
<p>解决办法：<br>async和await是针对coroutine的新语法，要使用新的语法，只需要做两步简单的替换：</p>
<p>1.把@asyncio.coroutine替换为async；<br>2.把yield from替换为await。<br>小结<br>Python从3.5版本开始为asyncio提供了async和await的新语法；<br>注意新语法只能用在Python 3.5以及后续版本，如果使用3.4版本，则仍需使用@asyncio.coroutine。</p>
<h1 id="DeprecationWarning-There-is-no-current-event-loop"><a href="#DeprecationWarning-There-is-no-current-event-loop" class="headerlink" title="DeprecationWarning: There is no current event loop"></a>DeprecationWarning: There is no current event loop</h1><p>我目前所发现的报错原因有以下两种：</p>
<ol>
<li><code>loop=asyncio.get_event_loop()</code><br>改为</li>
</ol>
<p>​    <code>loop = asyncio.new_event_loop() ​    asyncio.set_event_loop(loop)</code></p>
<ol start="2">
<li>由于使用 asyncio.ensure_future() ,需要传入参数以外还需要传入指定loop，如下所示：</li>
</ol>
<p><code>task = asyncio.ensure_future(c, loop=loop)</code><br>由于python代码的缩进问题十分严谨，所以new_event_loop以及set_event_loop必须放在ensure_future上面</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正确用法</span></span><br><span class="line"></span><br><span class="line">loop = asyncio.new_event_loop()</span><br><span class="line">asyncio.set_event_loop(loop)</span><br><span class="line">...</span><br><span class="line">task = asyncio.ensure_future(c, loop=loop)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c是你自己创建的协程对象，我这里忽略了</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误用法</span></span><br><span class="line"></span><br><span class="line">task = asyncio.ensure_future(c, loop=loop)</span><br><span class="line">...</span><br><span class="line">loop = asyncio.new_event_loop()</span><br><span class="line">asyncio.set_event_loop(loop)</span><br></pre></td></tr></table></figure>

<h1 id="使用Django管理员在后台添加数据库时出现no-such-table-main-auth-user-old解决方法"><a href="#使用Django管理员在后台添加数据库时出现no-such-table-main-auth-user-old解决方法" class="headerlink" title="使用Django管理员在后台添加数据库时出现no such table: main.auth_user__old解决方法"></a>使用Django管理员在后台添加数据库时出现no such table: main.auth_user__old解决方法</h1><p><img src="https://img-blog.csdnimg.cn/20c93d2929ec4a1b8e52a3d6baa4a38d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBATmFyY2lzc3VzYOWwj-aarg==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>在学习Django开发时，创建好管理员账号后，准备通过Django内置的管理网页来测试能否在表中添加记录，选择save后出现如上图所示的报错。</p>
<p>解决方案是升级Django的版本，原Django version==2.0<br>在命令行中输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Django --upgrade</span><br></pre></td></tr></table></figure>

<p>删除掉app下的migrations文件夹，删除掉db.sqlite3</p>
<p>然后开始对默认的app进行迁移</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<p>执行完这条命令就可以看到db.sqlite新建好了</p>
<p>然后迁移自己的app</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations common</span><br><span class="line">python manage.py migrate common</span><br></pre></td></tr></table></figure>

<p>完成数据库迁移之后，再次创建超级用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br></pre></td></tr></table></figure>

<p>可以在新的auth_user表中查看到自己新建的超级用户</p>
<p><img src="https://img-blog.csdnimg.cn/2e83a4ea95e44d30ba8f7dad5f2ce343.png" alt="在这里插入图片描述"></p>
<p>保证服务器的运行，进入<a target="_blank" rel="noopener" href="http://127.0.0.1/admin/">http://127.0.0.1/admin/</a><br>再次新建用户，此时就可以正常的创建了，问题解决！</p>
<p><img src="https://img-blog.csdnimg.cn/31924b5683e64ef3bc5efcb4fce45e6c.png" alt="在这里插入图片描述"></p>
<h1 id="TemplateDoesNotExist-at"><a href="#TemplateDoesNotExist-at" class="headerlink" title="TemplateDoesNotExist at/****"></a>TemplateDoesNotExist at/****</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TemplateDoesNotExist at /user/find</span><br><span class="line">fruit/list.html</span><br><span class="line">Request Method:	GET</span><br><span class="line">Request URL:	http://localhost:8000/user/find?price1=5</span><br><span class="line">Django Version:	4.0.6</span><br><span class="line">Exception Type:	TemplateDoesNotExist</span><br><span class="line">Exception Value:	</span><br><span class="line">fruit/list.html</span><br><span class="line">Exception Location:	I:\CDriveSW\desktop\python\python-web2\hiDjango\venv\lib\site-packages\django\template\loader.py, line 19, in get_template</span><br><span class="line">Python Executable:	I:\CDriveSW\desktop\python\python-web2\hiDjango\venv\Scripts\python.exe</span><br><span class="line">Python Version:	3.10.4</span><br><span class="line">Python Path:	</span><br><span class="line">[&#x27;I:\\CDriveSW\\desktop\\python\\python-web2\\hiDjango\\helloDjango&#x27;,</span><br><span class="line"> &#x27;C:\\Users\\Private\\AppData\\Local\\Programs\\Python\\Python310\\python310.zip&#x27;,</span><br><span class="line"> &#x27;C:\\Users\\Private\\AppData\\Local\\Programs\\Python\\Python310\\DLLs&#x27;,</span><br><span class="line"> &#x27;C:\\Users\\Private\\AppData\\Local\\Programs\\Python\\Python310\\lib&#x27;,</span><br><span class="line"> &#x27;C:\\Users\\Private\\AppData\\Local\\Programs\\Python\\Python310&#x27;,</span><br><span class="line"> &#x27;I:\\CDriveSW\\desktop\\python\\python-web2\\hiDjango\\venv&#x27;,</span><br><span class="line"> &#x27;I:\\CDriveSW\\desktop\\python\\python-web2\\hiDjango\\venv\\lib\\site-packages&#x27;]</span><br><span class="line">Server time:	Sat, 16 Jul 2022 14:11:19 +0800</span><br></pre></td></tr></table></figure>

<p>出错原因：访问不到templates里面的模板<br><strong>解决方式</strong></p>
<ul>
<li><p>方法1、 复制hello.html文件至安装路径下的Python27\lib\site-packages\django-1.8.18-py2.7.egg文件下<br>启动服务python manage.py runserver 127.0.0.1:8000<br>运行<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/hello%EF%BC%8C%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3%E3%80%82">http://127.0.0.1:8000/hello，错误解决。</a></p>
</li>
<li><p>方法2、文件夹templates复制到project项目文件夹下。</p>
</li>
<li><p>方法3、在settings.py里确认TEMPLATES目录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">  BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))  <span class="comment"># 项目内路径</span></span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  TEMPLATES = [</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;DIRS&#x27;</span>: [</span><br><span class="line">              os.path.join(BASE_DIR, <span class="string">&#x27;../templates&#x27;</span>),  <span class="comment"># 后面参数表示模板主目录相对内路径的所在位置</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">          <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">              <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                  <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">              ],</span><br><span class="line">          &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu 系统下如何安装pip3工具</span></span><br><span class="line"></span><br><span class="line">一、【导读】</span><br><span class="line">Ubuntu 系统内置了 Python2 和 Python3 两个版本的开发环境，却没有内置相应的 pip3 管理工具，本文将介绍如何在Ubuntu下如何快速安装 pip3 工具，并升级到最新可用版本（教程同样适用于Linux下安装）。</span><br><span class="line"></span><br><span class="line">二、安装</span><br><span class="line">直接在 Ubuntu 终端下输入“pip3 -V”命令尝试查看对应 pip3 工具的版本信息：</span><br><span class="line"></span><br><span class="line">![img](https://img-blog.csdnimg.cn/<span class="number">20190419093412955.</span>png)</span><br><span class="line"></span><br><span class="line">提示没有相关的pip工具，但可以尝试使用 “sudo apt install python3-pip” 命令进行安装，所以只需在终端输入：</span><br><span class="line"></span><br><span class="line">```sudo apt-get install python3-pip```</span><br><span class="line">回车即可安装，但安装的 pip3 工具并不是最新版本的：</span><br><span class="line"></span><br><span class="line">![img](https://img-blog.csdnimg.cn/<span class="number">20190419095622525.</span>png)</span><br><span class="line"></span><br><span class="line">接下来需要进行pip工具的升级更新。</span><br><span class="line"></span><br><span class="line">三、升级</span><br><span class="line">运行更新升级指令：</span><br><span class="line"></span><br><span class="line">```sudo pip3 install --upgrade pip```</span><br><span class="line">升级成功后：</span><br><span class="line"></span><br><span class="line">![img](https://img-blog.csdnimg.cn/<span class="number">20190419105203265.</span>png)</span><br><span class="line"></span><br><span class="line">四、卸载</span><br><span class="line">```sudo apt-get remove python3-pip```</span><br><span class="line"></span><br><span class="line"><span class="comment"># python安装curl</span></span><br><span class="line"></span><br><span class="line">`pycurl`是`libcurl`的 Python 接口，用C语言写的，速度比较快，是一个常用的网络开发库。</span><br><span class="line"></span><br><span class="line">`pycurl`无论在 Linux 还是 Windows 安装都会有点问题。</span><br><span class="line"></span><br><span class="line"><span class="comment">## Linux 下安装</span></span><br><span class="line"></span><br><span class="line">只需要先安装对应的开发包即可(需要root权限)</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">yum install python-devel curl-devel  </span><br><span class="line">pip install pycurl  </span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Windows-下安装"><a href="#Windows-下安装" class="headerlink" title="Windows 下安装"></a>Windows 下安装</h2><p>Windows 下安装<code>pycurl</code>要稍微麻烦些。如果是用的 Python 低于 3.6，可以直接使用 pip 命令安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pycurl  </span><br></pre></td></tr></table></figure>

<p>若使用的 Python 版本是 **3.6+**，则会报找不到对应的<code>pycurl</code>版本，导致安装失败。（截止20190911这天还没有）</p>
<p>报错如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Command errored <span class="keyword">out</span> <span class="keyword">with</span> exit status <span class="number">10</span>:  </span><br><span class="line">     command: <span class="string">&#x27;e:\green_tools\python\python37\python.exe&#x27;</span> <span class="operator">-</span>c <span class="string">&#x27;import sys, setuptools, tokenize; sys.argv[0] = &#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;C:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\pip-install-1t1yx2hf\\pycur</span></span><br><span class="line"><span class="string">l\\setup.py&#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;; __file__=&#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;C:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\pip-install-1t1yx2hf\\pycurl\\setup.py&#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;;f=getattr(tokenize, &#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;open&#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;, open)(__file__);code=f.read().  </span></span><br><span class="line"><span class="string">replace(&#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;\r\n&#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;, &#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;\n&#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;);f.close();exec(compile(code, __file__, &#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;exec&#x27;</span>&quot;&#x27;&quot;<span class="string">&#x27;))&#x27;</span> egg_info <span class="comment">--egg-base pip-egg-info  </span></span><br><span class="line">         cwd: C:\Users\ADMINI<span class="operator">~</span><span class="number">1</span>\AppData\<span class="keyword">Local</span>\Temp\pip<span class="operator">-</span>install<span class="number">-1</span>t1yx2hf\pycurl\</span><br><span class="line">    Complete output (<span class="number">1</span> lines):</span><br><span class="line">    Please specify <span class="comment">--curl-dir=/path/to/built/libcurl</span></span><br><span class="line">    <span class="comment">----------------------------------------</span></span><br><span class="line">ERROR: Command errored <span class="keyword">out</span> <span class="keyword">with</span> exit status <span class="number">10</span>: python setup.py egg_info <span class="keyword">Check</span> the logs <span class="keyword">for</span> <span class="keyword">full</span> command output.</span><br></pre></td></tr></table></figure>

<p>我们换一种办法安装，使用<code>whl</code>文件安装，需要借助<code>wheel</code>库，执行如下命令安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install wheel  </span><br></pre></td></tr></table></figure>

<p>打开网址：<a target="_blank" rel="noopener" href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#pycurl">https://www.lfd.uci.edu/~gohlke/pythonlibs/#pycurl</a> ，下载对应的<code>pycurl</code>版本的<code>whl</code>文件。 <a target="_blank" rel="noopener" href="https://ghost.oss.sherlocky.com/2/b6/005d8038088246fa2ef2ff24fa7b9.png"><img src="https://ghost.oss.sherlocky.com/2/b6/005d8038088246fa2ef2ff24fa7b9.png" alt="img"></a> </p>
<p>这里我下载的是：pycurl-7.43.0.3-cp37-cp37m-win_amd64.whl</p>
<blockquote>
<p>其中 cp37 指的是 Python3.7<br>win_amd64 指的是 Python 是 64 位的 Windows 版本</p>
</blockquote>
<p>执行如下命令安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install C:\Users\Administrator\Downloads\pycurl-7.43.0.3-cp37-cp37m-win_amd64.whl  </span><br></pre></td></tr></table></figure>

<p>至此安装完毕，以后有类似库找不到对应的版本安装的话，也可以利用<code>wheel</code>安装<code>whl</code>文件。</p>
<h1 id="pip-install-报错Caused-by-SSLError-SSLEOFError-8-‘EOF-occurred-in-violation-of-protocol"><a href="#pip-install-报错Caused-by-SSLError-SSLEOFError-8-‘EOF-occurred-in-violation-of-protocol" class="headerlink" title="pip install 报错Caused by SSLError(SSLEOFError(8, ‘EOF occurred in violation of protocol"></a>pip install 报错Caused by SSLError(SSLEOFError(8, ‘EOF occurred in violation of protocol</h1><p>我的报错原因是：<br>直接原因：系统挂有代理导致</p>
<p>根本原因：不太清楚。</p>
<p>解决方法（以下任一即可）<br>方法一：<br>关掉系统代理（PAC 也不可，需要  清除（关掉）系统代理</p>
<p>方法二：<br>在使用 pip 的终端设置正确的 https 代理</p>
<p>临时设置命令为: set https_proxy=<a href="http://127.0.0.1:port(自己的本地代理端口号)">http://127.0.0.1:port(自己的本地代理端口号)</a></p>
<p>长期设置 or 终端启动 自动设置代理请自行 google 或者 bing</p>
<h1 id="pip-install-weditor安装出错解决方法"><a href="#pip-install-weditor安装出错解决方法" class="headerlink" title="pip install weditor安装出错解决方法"></a>pip install weditor安装出错解决方法</h1><p>报错信息：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">Looking in indexes: https:<span class="comment">//pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line">Collecting weditor</span><br><span class="line">Using cachedhttps:<span class="comment">//pypi.tuna.tsinghua.edu.cn/packages/04/9b/ec6c2b8ab08fecd21d98121e2b91244632d1836669bb9c917ff01406bd1a/wedito</span></span><br><span class="line">r<span class="number">-0.6</span><span class="number">.5</span>.tar.gz (<span class="number">2.2</span> MB)</span><br><span class="line">Preparing <span class="title function_">metadata</span> <span class="params">(setup.py)</span> ... error</span><br><span class="line">error: subprocess-exited-with-error</span><br><span class="line"></span><br><span class="line">× python setup.py egg_info did not run successfully.</span><br><span class="line">│ <span class="built_in">exit</span> code: 1</span><br><span class="line">╰─&gt; [34 lines of output]</span><br><span class="line">WARNING: Ignoring invalid distribution -pencv-<span class="title function_">python</span> <span class="params">(c:\users\administrator.desktop<span class="number">-3488</span>grn\appdata\roaming\python\python38</span></span><br><span class="line"><span class="params">site-packages)</span></span><br><span class="line">WARNING: Ignoring invalid distribution -<span class="title function_">ip</span> <span class="params">(e:\ziyuanbao\lib\site-packages)</span></span><br><span class="line">E:\ziyuanbao\lib\site-packages\setuptools\dist.py:738: UserWarning: Usage of dash-separated &#x27;author-email&#x27; will not be suppor</span><br><span class="line">ted in <span class="built_in">future</span> versions. Please use the underscore name &#x27;author_email&#x27; instead</span><br><span class="line">warnings.<span class="title function_">warn</span><span class="params">(</span></span><br><span class="line"><span class="params">E:\ziyuanbao\lib\site-packages\setuptools\dist.py:<span class="number">738</span>: UserWarning: Usage of dash-separated <span class="string">&#x27;home-page&#x27;</span> will not be supported</span></span><br><span class="line"><span class="params">in <span class="built_in">future</span> versions. Please use the underscore name <span class="string">&#x27;home_page&#x27;</span> instead</span></span><br><span class="line"><span class="params">warnings.warn(</span></span><br><span class="line"><span class="params">E:\ziyuanbao\lib\site-packages\setuptools\dist.py:<span class="number">738</span>: UserWarning: Usage of dash-separated <span class="string">&#x27;description-file&#x27;</span> will not be su</span></span><br><span class="line"><span class="params">pported in <span class="built_in">future</span> versions. Please use the underscore name <span class="string">&#x27;description_file&#x27;</span> instead</span></span><br><span class="line"><span class="params">warnings.warn(</span></span><br><span class="line"><span class="params">E:\ziyuanbao\lib\site-packages\pkg_resources_init.py:<span class="number">122</span>: PkgResourcesDeprecationWarning: <span class="number">4.0</span><span class="number">.0</span>-unsupported is an invalid</span></span><br><span class="line"><span class="params">version and will not be supported in a <span class="built_in">future</span> release</span></span><br><span class="line"><span class="params">warnings.warn(</span></span><br><span class="line"><span class="params">E:\ziyuanbao\lib\site-packages\setuptools\installer.py:<span class="number">27</span>: SetuptoolsDeprecationWarning: setuptools.installer is deprecated.</span></span><br><span class="line"><span class="params">Requirements should be satisfied by a PEP <span class="number">517</span> installer.</span></span><br><span class="line"><span class="params">warnings.warn(</span></span><br><span class="line"><span class="params">Error parsing</span></span><br><span class="line"><span class="params">Traceback (most recent call last):</span></span><br><span class="line"><span class="params">File <span class="string">&quot;c:\users\administrator.desktop-3488grn\appdata\local\temp\pip-install-c_1owwyj\weditor_c837051f5af04a9893def95fbce5da</span></span></span><br><span class="line"><span class="string"><span class="params">7e.eggs\pbr-5.8.1-py3.8.egg\pbr\core.py&quot;</span>, line <span class="number">111</span>, in pbr</span></span><br><span class="line"><span class="params">attrs = util.cfg_to_args(path, dist.script_args)</span></span><br><span class="line"><span class="params">File <span class="string">&quot;c:\users\administrator.desktop-3488grn\appdata\local\temp\pip-install-c_1owwyj\weditor_c837051f5af04a9893def95fbce5da</span></span></span><br><span class="line"><span class="string"><span class="params">7e.eggs\pbr-5.8.1-py3.8.egg\pbr\util.py&quot;</span>, line <span class="number">272</span>, in cfg_to_args</span></span><br><span class="line"><span class="params">pbr.hooks.setup_hook(config)</span></span><br><span class="line"><span class="params">File <span class="string">&quot;c:\users\administrator.desktop-3488grn\appdata\local\temp\pip-install-c_1owwyj\weditor_c837051f5af04a9893def95fbce5da</span></span></span><br><span class="line"><span class="string"><span class="params">7e.eggs\pbr-5.8.1-py3.8.egg\pbr\hooks_init.py&quot;</span>, line <span class="number">25</span>, in setup_hook</span></span><br><span class="line"><span class="params">metadata_config.run()</span></span><br><span class="line"><span class="params">File <span class="string">&quot;c:\users\administrator.desktop-3488grn\appdata\local\temp\pip-install-c_1owwyj\weditor_c837051f5af04a9893def95fbce5da</span></span></span><br><span class="line"><span class="string"><span class="params">7e.eggs\pbr-5.8.1-py3.8.egg\pbr\hooks\base.py&quot;</span>, line <span class="number">27</span>, in run</span></span><br><span class="line"><span class="params">self.hook()</span></span><br><span class="line"><span class="params">File <span class="string">&quot;c:\users\administrator.desktop-3488grn\appdata\local\temp\pip-install-c_1owwyj\weditor_c837051f5af04a9893def95fbce5da</span></span></span><br><span class="line"><span class="string"><span class="params">7e.eggs\pbr-5.8.1-py3.8.egg\pbr\hooks\metadata.py&quot;</span>, line <span class="number">25</span>, in hook</span></span><br><span class="line"><span class="params">self.config[<span class="string">&#x27;version&#x27;</span>] = packaging.get_version(</span></span><br><span class="line"><span class="params">File <span class="string">&quot;c:\users\administrator.desktop-3488grn\appdata\local\temp\pip-install-c_1owwyj\weditor_c837051f5af04a9893def95fbce5da</span></span></span><br><span class="line"><span class="string"><span class="params">7e.eggs\pbr-5.8.1-py3.8.egg\pbr\packaging.py&quot;</span>, line <span class="number">860</span>, in get_version</span></span><br><span class="line"><span class="params">version =get_version_from_pkg_metadata(package_name)</span></span><br><span class="line"><span class="params">File <span class="string">&quot;c:\users\administrator.desktop-3488grn\appdata\local\temp\pip-install-c_1owwyj\weditor_c837051f5af04a9893def95fbce5da</span></span></span><br><span class="line"><span class="string"><span class="params">7e.eggs\pbr-5.8.1-py3.8.egg\pbr\packaging.py&quot;</span>, line <span class="number">828</span>, in get_version_from_pkg_metadata</span></span><br><span class="line"><span class="params">pkg_metadata = email.message_from_file(pkg_metadata_file)</span></span><br><span class="line"><span class="params">File <span class="string">&quot;E:\ziyuanbao\lib\email_init.py&quot;</span>, line <span class="number">54</span>, in message_from_file</span></span><br><span class="line"><span class="params"><span class="keyword">return</span> Parser(*args, **kws).parse(fp)</span></span><br><span class="line"><span class="params">File <span class="string">&quot;E:\ziyuanbao\lib\email\parser.py&quot;</span>, line <span class="number">53</span>, in parse</span></span><br><span class="line"><span class="params">data = fp.read(<span class="number">8192</span>)</span></span><br><span class="line"><span class="params">UnicodeDecodeError: <span class="string">&#x27;gbk&#x27;</span> codec can<span class="string">&#x27;t decode byte 0xad in position 825: illegal multibyte sequence</span></span></span><br><span class="line"><span class="string"><span class="params">error in setup command: Error parsing C:\Users\Administrator.DESKTOP-3488GRN\AppData\Local\Temp\pip-install-c_1owwyj\weditor</span></span></span><br><span class="line"><span class="string"><span class="params">c837051f5af04a9893def95fbce5da7e\setup.cfg: UnicodeDecodeError: &#x27;</span>gbk<span class="string">&#x27; codec can&#x27;</span>t decode byte <span class="number">0xad</span> in position <span class="number">825</span>: illegal multiby</span></span><br><span class="line"><span class="params">te sequence</span></span><br><span class="line"><span class="params">[end of output]</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">note: This error originates from a subprocess, and is likely not a problem with pip.</span></span><br><span class="line"><span class="params">error: metadata-generation-failed</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">× Encountered error <span class="keyword">while</span> generating package metadata.</span></span><br><span class="line"><span class="params">╰─&gt; See above <span class="keyword">for</span> output.</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">note: This is an issue with the package mentioned above, not pip.</span></span><br><span class="line"><span class="params">hint: See above <span class="keyword">for</span> details.</span></span><br></pre></td></tr></table></figure>

<p>解决方法：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//github.com/openatx/weditor</span></span><br><span class="line">pip3 install -e weditor</span><br></pre></td></tr></table></figure>

<h1 id="小米手机Uiautomator启动失败问题-uiautomator2-GatewayError报错"><a href="#小米手机Uiautomator启动失败问题-uiautomator2-GatewayError报错" class="headerlink" title="小米手机Uiautomator启动失败问题 uiautomator2.GatewayError报错"></a>小米手机Uiautomator启动失败问题 uiautomator2.GatewayError报错</h1><p>先看报错:</p>
<p><code>WinError adb shell am instrument -w -r -e debug false -e class com.github.uiautomator.stub.Stub com.github.uiautomator.test/android.support.test.runner.AndroidJUnitRunner] uiautomator2.GatewayError</code><br>打开 <a target="_blank" rel="noopener" href="https://github.com/openatx/uiautomator2/wiki/Common-issues">Common issues · openatx/uiautomator2 Wiki · GitHub</a></p>
<p>是说 app-uiautomator.apk or app-uiautomator-test.apk not installed. 但是实际用</p>
<p><code>python -m uiautomator2 init</code><br>是没有任何报错的，而且可以看到上面的两个app安装成功的信息，所以问题点不在uiautomator app安装失败。</p>
<p>解决方案：</p>
<p>打开小米手机的设置—开启开发者选项—开启USB调试—开启USB安装—开启USB调试（安全设置）—-开启通过USB验证应用（默认开启）—-开启无线显示认证（可选择），关键选项，必须不要启用MIUI优化，操作完上述设置，然后再执行 python -m uiautomator2 init （不会报错），就可以执行相关脚本了。</p>
<h1 id="uiautomator2-使用Python测试-Android应用"><a href="#uiautomator2-使用Python测试-Android应用" class="headerlink" title="uiautomator2 使用Python测试 Android应用"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fnng/p/8486863.html">uiautomator2 使用Python测试 Android应用</a></h1><p>GitHub地址：<a target="_blank" rel="noopener" href="https://github.com/openatx/uiautomator2">https://github.com/openatx/uiautomator2</a></p>
<p>###介绍</p>
<p>uiautomator2 是一个可以使用Python对Android设备进行UI自动化的库。其底层基于Google uiautomator，Google提供的uiautomator库可以获取屏幕上任意一个APP的任意一个控件属性，并对其进行任意操作，但有两个缺点：</p>
<p>1、测试脚本只能使用Java语言。</p>
<p>2、测试脚本必须每次被上传到设备上运行。 我们希望测试能够用一个更脚本化的语言，例如Python编写，同时可以每次所见即所得地修改测试、运行测试。</p>
<p>###安装</p>
<p>安装uiautomator2</p>
<pre><code>pip install --pre uiautomator2

pip install pillow
</code></pre>
<p>###初始化</p>
<p>部署相关的守护进程。</p>
<p>电脑连接上一个手机或多个手机, 确保adb已经添加到环境变量中，执行下面的命令会自动安装本库所需要的设备端程序：uiautomator-server 、atx-agent、openstf/minicap、openstf/minitouch</p>
<pre><code>python -m uiautomator2 init
</code></pre>
<p>安装完成，设备上会多一个uiautomator的应用。</p>
<p>配置手机设备参数：</p>
<p>有两种方法，一种是通过WIFI，另一种是通过USB数据线将手机链接电脑。</p>
<p>WiFi连接更方便一点，需要保持PC和手机使用的一个WIFI，查看手机连接WIFI的IP地址。</p>
<p><img src="https://images2018.cnblogs.com/blog/311516/201803/311516-20180301092953310-1075957612.png"></p>
<p>###测试</p>
<p>编写以下脚本进行验证：</p>
<pre><code>import uiautomator2 as u2

d = u2.connect(&#39;192.168.31.234&#39;)
print(d.info)
</code></pre>
<p>运行结果：</p>
<p>###定位元素：</p>
<p>我们可以借助Android SDK自的uiautomatorviewer查看元素，这就要求手机必须以USB的方式连接PC，我前面使用的是WIFI连接进行连接的。所以，openatx提供了另外一个工具weditor 来解决这个问题。</p>
<p>GitHub地址：<a target="_blank" rel="noopener" href="https://github.com/openatx/weditor">https://github.com/openatx/weditor</a></p>
<p>1、安装：</p>
<pre><code>pip install --pre --upgrade weditor
</code></pre>
<p>2、使用：</p>
<pre><code>python3 -m weditor
</code></pre>
<p>默认会通过浏览器打开页面：<a target="_blank" rel="noopener" href="http://atx.open.netease.com/">http://atx.open.netease.com/</a></p>
<p><img src="https://images2018.cnblogs.com/blog/311516/201803/311516-20180301093125715-1619631377.png"></p>
<p>在页面左上角选择Android，输入设备IP（192.168.31.234），点击Connect按钮。</p>
<p>当我们操作完手机后，可以点击“Reload”按钮进行刷新，从而保持与设备上的界面保持同步。weditor 还可以帮我们生成代码。总之，你研究一下就会用了。</p>
<p>###编写测试脚本</p>
<p>这里针对魅族社区App进行测试。</p>
<pre><code>import uiautomator2 as u2
from time import sleep

d = u2.connect(&#39;192.168.31.234&#39;)

# 启动App
d.app_start(&quot;com.meizu.mzbbs&quot;)

# 搜索
d(resourceId=&quot;com.meizu.mzbbs:id/j0&quot;).click()

# 输入关键字
d(resourceId=&quot;com.meizu.mzbbs:id/p9&quot;).set_text(&quot;flyme&quot;)

# 搜索按钮
d(resourceId=&quot;com.meizu.mzbbs:id/tp&quot;).click()

sleep(2)

# 停止app
d.app_stop(&quot;com.meizu.mzbbs&quot;) 
</code></pre>
<p>app_start()和app_stop()用于启动和停止应用。</p>
<p>常用的定位方式：</p>
<ul>
<li>ResourceId定位：<br>  d(resourceId=”com.meizu.mzbbs:id/tp”).click()</li>
<li>Text定位：<br>  d(text=”精选”).click()</li>
<li>Description定位：<br>  d(description=”..”).click()</li>
<li>ClassName定位：<br>  d(className=”android.widget.TextView”).click()</li>
</ul>
<p><strong>小结</strong>：其实关注该项目已经好几个月了，目前该项目已经趋于稳定，整个测试环境的搭建过程也要比Appium简单得多。</p>
<h1 id="requests库中使用response-json-报错：json-decoder-JSONDecodeError-Expecting-value"><a href="#requests库中使用response-json-报错：json-decoder-JSONDecodeError-Expecting-value" class="headerlink" title="requests库中使用response.json()报错：json.decoder.JSONDecodeError: Expecting value"></a>requests库中使用response.json()报错：json.decoder.JSONDecodeError: Expecting value</h1><p>本文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Gabriel_wei/article/details/125843426">https://blog.csdn.net/Gabriel_wei/article/details/125843426</a></p>
<p> 报错</p>
<p><img src="https://img-blog.csdnimg.cn/5015daebd7d242448cf67ce5a320a52c.png"></p>
<p>原因</p>
<p>请求得到的数据，不是标准的json格式数据，不能采用<code>response.json()</code>函数解析，采用<code>response.text</code>查看一下数据格式，发现多了jQueryxxxxxxxxx<br><img src="https://img-blog.csdnimg.cn/cd4f4ed238364438bbe9f4d8f90a3153.png"></p>
<p>解决</p>
<p>数据请求的地址为</p>
<pre><code>url = &#39;https://liveapi.huya.com/moment/getMomentContent?callback=jQuery1124023700002544508125_1658109026112&amp;videoId=699727183&amp;uid=&amp;_=1658109026118&#39;
</code></pre>
<p>将地址里面的callback删除，变为</p>
<pre><code>url = &#39;https://liveapi.huya.com/moment/getMomentContent?videoId=699727183&amp;uid=&amp;_=1658109026118&#39;
</code></pre>
<p>改变url请求地址以后，再次使用<code>response.json()</code>就可以了</p>
<h1 id="python中一次替换字符串中的多个字符-通俗易懂"><a href="#python中一次替换字符串中的多个字符-通俗易懂" class="headerlink" title="python中一次替换字符串中的多个字符[通俗易懂]"></a>python中一次替换字符串中的多个字符[通俗易懂]</h1><p><a target="_blank" rel="noopener" href="https://www.runoob.com/python/python-reg-expressions.html">https://www.runoob.com/python/python-reg-expressions.html</a></p>
<p>先直接上解决方案：</p>
<p>比如下面给出的字符串a，有字母、’（单引号）、\n（换行符）、数字、：（冒号）、，（逗号），目标是只保留字符串中的数字和字母，且看我如何操作。</p>
<pre><code>import re
a=&#39;eew \&#39; eawr,2 fd\n sa:21&#39;

b=re.sub(r&#39;[\&#39;:\s ,]*&#39;, &#39;&#39;, a) # 前面是正则表达式，匹配多种字符（串）
print(b)
</code></pre>
<p>复制</p>
<p>具体运行展示一下：</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-8223537/f923a908cfb9c07d8f96becaccfdbc87.png?imageView2/2/w/1620"></p>
<p>解释一下这个正则表达式的意思：r’[\’:\s ,]*’</p>
<p>1：添加r，说明该字符串中全为普通字符（可参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zhangxinrun/article/details/8124333">以r或u开头的字符串</a>，按评论里<a target="_blank" rel="noopener" href="https://me.csdn.net/IwillbecomeAIgod">IwillbecomeAIgod</a>同学的说法是用于防转义），常用于正则表达式</p>
<p>2：[]内是一个字符集，字符集内的字符任何一个被匹配，都算匹配成功，比如r’a[bcd]e’，可以匹配到’abe’、’ace’、’ade’。</p>
<p>3：*代表匹配前一个字符0次或无限次。</p>
<p>4：\s代表的是空白字符，比如空格、换行符、制表符等等。</p>
<p>于是r’[\’:\s ,]*’组合起来就是匹配字符串中所有的的‘（单引号）、\n（换行符）、：（冒号）、，（逗号）</p>
<p>最后re.sub(a, b, string)表示将string中a所匹配到的所有字符通通替换成b，我们这个例子就是将匹配到的’（单引号）、\n（换行符）、：（冒号）、，（逗号）通通替换成”（nothing）。</p>
<p>关于<a target="_blank" rel="noopener" href="https://www.cnblogs.com/huxi/archive/2010/07/04/1771073.html">正则表达式</a>，另外我是受了<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4c076da1b7f7">这篇文章</a>的启发（在此感谢）：启发就是re.sub可以传给他正则表达式。</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-8223537/3c84fc7008f2cf8f43c7fe78c21a43cb.png?imageView2/2/w/1620"></p>
<p>在此之前，先试了一下用正则表达式来匹配多个字符串，然后用<a target="_blank" rel="noopener" href="http://www.runoob.com/python/att-string-replace.html">replace</a>方法行不通，但这个思路也是很正确的，最终还是帮我解决了问题。先看replace：</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-8223537/638de9483aeab44a398e8e9d67d19b0d.png?imageView2/2/w/1620"></p>
<p>看看在replace中用上面提到的思路是什么结果：</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-8223537/399360a3793f6aca890fbb1835721664.png?imageView2/2/w/1620"></p>
<p>看到了吗，我的正则表达式可没写错，是replace不行，就是说replace不接受我的正则表达式。</p>
<h1 id="超强反爬虫方案！Requests-什么的通通爬不了"><a href="#超强反爬虫方案！Requests-什么的通通爬不了" class="headerlink" title="超强反爬虫方案！Requests 什么的通通爬不了"></a>超强反爬虫方案！Requests 什么的通通爬不了</h1><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/372825949">https://zhuanlan.zhihu.com/p/372825949</a></p>
<p>上一篇文章介绍了如何升级网站到 HTTP/2.0，但是实际上并没有显式地声明禁用 HTTP 1.x 的请求。</p>
<p>想到这里，你可能就想到了一个非常强的反爬虫方案 —— 禁用所有 HTTP 1.x 的请求！</p>
<p>现在很多爬虫库其实对 HTTP/2.0 支持得不好，比如大名鼎鼎的 Python 库 —— requests，到现在为止还只支持 HTTP/1.1，啥时候支持 HTTP/2.0 还不知道。</p>
<p>Scrapy 框架最新版本 2.5.0（2021.04.06 发布）加入了对 HTTP/2.0 的支持，但是官网明确提示，现在是实验性的功能，不推荐用到生产环境，原文如下：</p>
<blockquote>
<p>HTTP/2 support in Scrapy is experimental, and not yet recommended for production environments. Future Scrapy versions may introduce related changes without a deprecation period or warning.  </p>
</blockquote>
<p>插一句，Scrapy 中怎么支持 HTTP/2.0 呢？在 settings.py 里面换一下 Download Handlers 即可：</p>
<pre><code>DOWNLOAD_HANDLERS = &#123;
    &#39;https&#39;: &#39;scrapy.core.downloader.handlers.http2.H2DownloadHandler&#39;,
&#125;
</code></pre>
<p>当前 Scrapy 的 HTTP/2.0 实现的已知限制包括：</p>
<ul>
<li>  不支持 HTTP/2.0 明文（h2c），因为没有主流浏览器支持未加密的 HTTP/2.0。</li>
<li>  没有用于指定最大[帧大小](<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7540">https://tools.ietf.org/html/rfc7540</a> class=)大于默认值 16384 的设置，发送更大帧的服务器的连接将失败。</li>
<li>  不支持[服务器推送](<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7540">https://tools.ietf.org/html/rfc7540</a> class=)。</li>
<li>  不支持<code>[bytes_received](https://docs.scrapy.org/en/latest/topics/signals.html class=)</code>和 <code>[headers_received](https://docs.scrapy.org/en/latest/topics/signals.html class=)</code>信号。</li>
</ul>
<p>关于其他的一些库，也不必多说了，对 HTTP/2.0 的支持也不好，目前对 HTTP/2.0 支持得还可以的有 hyper 和 httpx，后者更加简单易用一些。</p>
<h2 id="反爬虫"><a href="#反爬虫" class="headerlink" title="反爬虫"></a>反爬虫</h2><p>所以，你想到反爬虫方案了吗？</p>
<p>如果我们禁用所有的 HTTP/1.x 的请求，是不是能通杀掉一大半爬虫？requests 没法用了，Scrapy 除非升级到最新版本才能勉强用个实验性版本，其他的语言也不用多说，也会杀一大部分。</p>
<p>而浏览器对 HTTP/2.0 的支持现在已经很好了，所以不会影响用户浏览网页的体验。</p>
<h2 id="措施"><a href="#措施" class="headerlink" title="措施"></a>措施</h2><p>那就让我们来吧！</p>
<p>这个怎么做呢？其实很简单，在 Nginx 里面配置一下就好了，主要就是加这么个判断就行了：</p>
<pre><code>if ($server_protocol !~* &quot;HTTP/2.0&quot;) &#123;
  return 444;
&#125;
</code></pre>
<p>就是这么简单，这里 <code>$server_protocol</code> 就是传输协议，其结果目前有三个：<code>HTTP/1.0</code>、<code>HTTP/1.1</code> 和 <code>HTTP/2.0</code>，另外判断条件我们使用了 <code>!~*</code> ，意思就是不等于，这里的判断条件就是，如果不是 <code>HTTP/2.0</code>，那就直接返回 444 状态码，444 一般代表 CONNECTION CLOSED WITHOUT RESPONSE，就是不返回任何结果关闭连接。</p>
<p>我的服务是在 Kubernetes 里面运行的，所以要加这个配置还得改下 Nginx Ingress 的配置，不过还好 <a target="_blank" rel="noopener" href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/">https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/</a> 预留了一个配置叫做 <code>nginx.ingress.kubernetes.io/server-snippet</code>，利用它我们可以自定义 Nginx 的判定逻辑。</p>
<p>官方用法如下：</p>
<pre><code>apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  annotations:
    nginx.ingress.kubernetes.io/server-snippet: |
        set $agentflag 0;
        if ($http_user_agent ~* &quot;(Mobile)&quot; )&#123;
          set $agentflag 1;
        &#125;
        if ( $agentflag = 1 ) &#123;
          return 301 https://m.example.com;
        &#125;
</code></pre>
<p>所以这里，我们只需要改成刚才的配置就好了：</p>
<pre><code>apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  annotations:
    nginx.ingress.kubernetes.io/server-snippet: |
      if ($server_protocol !~* &quot;HTTP/2.0&quot;) &#123;
        return 444;
      &#125;
</code></pre>
<p>大功告成！</p>
<p>配置完成了，示例网站是：<a target="_blank" rel="noopener" href="https://spa16.scrape.center/">https://spa16.scrape.center/</a></p>
<p>我们在浏览器中看下效果：</p>
<p><img src="https://pic3.zhimg.com/v2-efd1b807fe1437821873f03001cd8926_r.jpg"></p>
<p>可以看到所有请求都是走的 HTTP 2.0，页面完全正常加载。</p>
<p>然而，我们使用 requests 来请求一下：</p>
<pre><code>import requests
response = requests.get(&#39;https://spa16.scrape.center/&#39;)
print(response.text)
</code></pre>
<p>非常欢乐的报错：</p>
<pre><code>Traceback (most recent call last):
  ...
    raise RemoteDisconnected(&quot;Remote end closed connection without&quot;
http.client.RemoteDisconnected: Remote end closed connection without response

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  ...
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
requests.packages.urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host=&#39;spa16.scrape.center&#39;, port=443): Max retries exceeded with url: / (Caused by ProxyError(&#39;Cannot connect to proxy.&#39;, RemoteDisconnected(&#39;Remote end closed connection without response&#39;)))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
    ...
requests.exceptions.ProxyError: HTTPSConnectionPool(host=&#39;spa16.scrape.center&#39;, port=443): Max retries exceeded with url: / (Caused by ProxyError(&#39;Cannot connect to proxy.&#39;, RemoteDisconnected(&#39;Remote end closed connection without response&#39;)))
</code></pre>
<p>如果你用 requests，无论如何都不行的，因为它就不支持 HTTP 2.0。</p>
<p>那我们换一个支持 HTTP 2.0 的库呢？比如 httpx，安装方法如下：</p>
<pre><code>pip3 install &#39;httpx[http2]&#39;
</code></pre>
<p>主意，Python 版本需要在 3.6 及以上才能用 httpx。</p>
<p>安装好了之后测试下：</p>
<pre><code>import httpx
client = httpx.Client(http2=True)

response = client.get(&#39;https://spa16.scrape.center/&#39;)
print(response.text)
</code></pre>
<p>结果如下：</p>
<pre><code>&lt;!DOCTYPE html&gt;&lt;html lang=en&gt;&lt;head&gt;&lt;meta charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=&quot;IE=edge&quot;&gt;&lt;meta name=viewport content=&quot;width=device-width,initial-scale=1&quot;&gt;&lt;meta name=referrer content=no-referrer&gt;&lt;link rel=icon href=/favicon.ico&gt;&lt;title&gt;Scrape | Book&lt;/title&gt;&lt;link href=/css/chunk-50522e84.e4e1dae6.css rel=prefetch&gt;&lt;link href=/css/chunk-f52d396c.4f574d24.css rel=prefetch&gt;&lt;link href=/js/chunk-50522e84.6b3e24aa.js rel=prefetch&gt;&lt;link href=/js/chunk-f52d396c.f8f41620.js rel=prefetch&gt;&lt;link href=/css/app.ea9d802a.css rel=preload as=style&gt;&lt;link href=/js/app.b93891e2.js rel=preload as=script&gt;&lt;link href=/js/chunk-vendors.a02ff921.js rel=preload as=script&gt;&lt;link href=/css/app.ea9d802a.css rel=stylesheet&gt;&lt;/head&gt;&lt;body&gt;&lt;noscript&gt;&lt;strong&gt;We&#39;re sorry but portal doesn&#39;t work properly without JavaScript enabled. Please enable it to continue.&lt;/strong&gt;&lt;/noscript&gt;&lt;div id=app&gt;&lt;/div&gt;&lt;script src=/js/chunk-vendors.a02ff921.js&gt;&lt;/script&gt;&lt;script src=/js/app.b93891e2.js&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre>
<p>可以看到，HTML 就成功被我们获取到了！这就是 HTTP/2.0 的魔法！</p>
<p>我们如果把 <code>http2</code> 参数设置为 False 呢？</p>
<pre><code>import httpx
client = httpx.Client(http2=False)

response = client.get(&#39;https://spa16.scrape.center/&#39;)
print(response.text)
</code></pre>
<p>一样很不幸：</p>
<pre><code>Traceback (most recent call last):
    ...
    raise RemoteProtocolError(msg)
httpcore.RemoteProtocolError: Server disconnected without sending a response.

The above exception was the direct cause of the following exception:
  ...
    raise mapped_exc(message) from exc
httpx.RemoteProtocolError: Server disconnected without sending a response.
</code></pre>
<h3 id="反反爬之-封禁ip"><a href="#反反爬之-封禁ip" class="headerlink" title="反反爬之 封禁ip"></a>反反爬之 封禁ip</h3><p>可以使用代理IP进行网站数据的爬取</p>
<p>在reqest.get中添加参数proxies=</p>
<p><code>response = requests.get(url=url, headers=headers,proxies=&#123;&#39;http&#39;:&#39;http://121.232.148.26:9000&#39;&#125;)</code></p>
<h3 id="反反爬之-账号限制"><a href="#反反爬之-账号限制" class="headerlink" title="反反爬之 账号限制"></a>反反爬之 账号限制</h3><ul>
<li>  通过post请求携带参数 使用session登录</li>
</ul>
<p>http/https协议特性：无状态</p>
<p>没有请求到对应数据的原因：</p>
<p> 发起的第二次基于个人主页请求时，服务器并不知道该次请求时基于登录状态下的请求</p>
<p>cookie：让服务器保留客户端的相关状态</p>
<ul>
<li><p>  通过抓包工具手动处理cookie封装到headers中</p>
</li>
<li><p>cookie时模拟登陆psot后，由服务器端创建</p>
<ul>
<li>session会话对象<ul>
<li>  进行请求发送</li>
<li>  如果请求过程中产生了cookie，则cookie会被自动存储/携带到session对象中</li>
</ul>
</li>
</ul>
</li>
<li><p>  创建session对象：request.Session()</p>
</li>
<li><p>  使用session对象进行模拟登陆post请求发送</p>
</li>
<li><p>session进行get请求发送（携带cookie）</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment"># -*-coding:utf-8-*-</span></span><br><span class="line">    <span class="keyword">import</span> requests</span><br><span class="line">    <span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">    <span class="keyword">from</span> chaojiying <span class="keyword">import</span> Chaojiying_Client</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">        <span class="comment"># 创建一个session对象</span></span><br><span class="line">        session = requests.Session()</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        url = <span class="string">&#x27;https://so.gushiwen.cn/user/login.aspx?from=http://so.gushiwen.cn/user/collect.aspx&#x27;</span></span><br><span class="line">        page_txt = session.get(url=url,headers=headers).text</span><br><span class="line">        <span class="comment"># 解析img的src的zhi</span></span><br><span class="line">        tree = etree.HTML(page_txt)</span><br><span class="line">        src = <span class="string">&#x27;https://so.gushiwen.cn&#x27;</span> + tree.xpath(<span class="string">&#x27;//*[@id=&quot;imgCode&quot;]/@src&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        img_data = session.get(url = src,headers=headers).content</span><br><span class="line">        chaojiying = Chaojiying_Client(<span class="string">&#x27;超级鹰账号&#x27;</span>, <span class="string">&#x27;超级鹰密码&#x27;</span>, <span class="string">&#x27;软件ID&#x27;</span>)</span><br><span class="line">        dic = chaojiying.PostPic(img_data, <span class="number">1902</span>)</span><br><span class="line">        code = dic[<span class="string">&quot;pic_str&quot;</span>]</span><br><span class="line">        login_url = <span class="string">&#x27;https://so.gushiwen.cn/user/login.aspx?from=http%3a%2f%2fso.gushiwen.cn%2fuser%2fcollect.aspx&#x27;</span></span><br><span class="line">        data=&#123;</span><br><span class="line">        <span class="string">&#x27;__VIEWSTATE&#x27;</span>: <span class="string">&#x27;gBVayz6 / Fp6Yz2JMFpdRAYclMzJDgyBrLu8SbsEttWCMF9wc8vxeoB6ZWl7gUyyc9zRqeCRNQNn44WGoqL5yrKi85ff84dAiva + yPVTdl7mplq6s7qaOffXZd / 0 =&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__VIEWSTATEGENERATOR&#x27;</span> : <span class="string">&#x27;C93BE1AE&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;from&#x27;</span>: <span class="string">&#x27;http: // so.gushiwen.cn / user / collect.aspx&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;古诗文网账号&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pwd&#x27;</span>: <span class="string">&#x27;古诗文密码&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;code&#x27;</span>: code,</span><br><span class="line">        <span class="string">&#x27;denglu&#x27;</span>: <span class="string">&#x27;登录&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">#使用session进行post请求的发送</span></span><br><span class="line">        login_txt = session.post(url=login_url,headers=headers,data=data)</span><br><span class="line">        <span class="built_in">print</span>(login_txt.status_code)</span><br><span class="line">    </span><br><span class="line">        user_url = <span class="string">&#x27;https://so.gushiwen.cn/user/collect.aspx&#x27;</span></span><br><span class="line">        <span class="comment">#使用携带cookie的session进行请求</span></span><br><span class="line">        user_txt = session.get(url=user_url,headers=headers).text</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;user.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(user_txt)</span><br><span class="line"></span><br><span class="line">requests操作cookie出现相同字段名丢失的问题（python）</span><br><span class="line">====================================</span><br><span class="line"></span><br><span class="line">* * *</span><br><span class="line"></span><br><span class="line"><span class="number">2023</span>年01月<span class="number">14</span>日 <span class="number">11</span>:05 阅读 <span class="number">219</span></span><br><span class="line"></span><br><span class="line">背景：</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">接口访问后返回的cookies，需要保存在文本中，然后其他接口请求时直接去读取文本中的内容。问题在于转储cookies时出现同一字段内容丢失的情况；</span><br><span class="line"></span><br><span class="line">cookies内容查看（CSDN为例）：</span><br><span class="line">--------------------</span><br><span class="line"></span><br><span class="line">**Request Cookies:**</span><br><span class="line"></span><br><span class="line">![](http://cdn.h3blog.com/<span class="number">20230114111214</span>)</span><br><span class="line"></span><br><span class="line">**Response Cookies**</span><br><span class="line"></span><br><span class="line">![](https://img-blog.csdnimg.cn/<span class="number">20181229143728260.</span>png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTM5NDg4NTg=,size_16,color_FFFFFF,t_70)</span><br><span class="line"></span><br><span class="line">同上两套图可以看出：Cookie的内容很丰富，有很多属性，有name、value、domain、path等特征。不同的域不同的路径下可以存在同样名字的cookie。也就是说同一个请求或返回不会存在所有字段都一样的内容的cookie。当让我们一般的请求里，只会设置cookie的name和value，所以在这种意识下处理cookie会导致一些数据丢失。</span><br><span class="line"></span><br><span class="line">cookies的字段说明：</span><br><span class="line">-------------</span><br><span class="line"></span><br><span class="line">**属性**</span><br><span class="line"></span><br><span class="line">**描述**</span><br><span class="line"></span><br><span class="line">name</span><br><span class="line"></span><br><span class="line">Cookie的名称，Cookie一旦创建，名称便不可更改</span><br><span class="line"></span><br><span class="line">value</span><br><span class="line"></span><br><span class="line">Cookie的值。如果值为Unicode字符，需要为字符编码。如果值为二进制数据，则需要使用BASE64编码</span><br><span class="line"></span><br><span class="line">expires/maxAge</span><br><span class="line"></span><br><span class="line">Cookie失效的时间，单位秒。如果为正数，则该Cookie在maxAge秒之后失效。如果为负数，该Cookie为临时Cookie，关闭浏览器即失效，浏览器也不会以任何形式保存该Cookie。如果为<span class="number">0</span>，表示删除该Cookie。默认为-<span class="number">1</span>。</span><br><span class="line"></span><br><span class="line">secure</span><br><span class="line"></span><br><span class="line">该Cookie是否仅被使用安全协议传输。安全协议。安全协议有HTTPS，SSL等，在网络上传输数据之前先将数据加密。默认为false。</span><br><span class="line"></span><br><span class="line">path</span><br><span class="line"></span><br><span class="line">Cookie的使用路径。如果设置为“/sessionWeb/”，则只有contextPath为“/sessionWeb”的程序可以访问该Cookie。如果设置为“/”，则本域名下contextPath都可以访问该Cookie。注意最后一个字符必须为“/”。</span><br><span class="line"></span><br><span class="line">domain</span><br><span class="line"></span><br><span class="line">可以访问该Cookie的域名。如果设置为“.google.com”，则所有以“google.com”结尾的域名都可以访问该Cookie。注意第一个字符必须为“.”。</span><br><span class="line"></span><br><span class="line">comment</span><br><span class="line"></span><br><span class="line">该Cookie的用处说明，浏览器显示Cookie信息的时候显示该说明。</span><br><span class="line"></span><br><span class="line">version</span><br><span class="line"></span><br><span class="line">Cookie使用的版本号。<span class="number">0</span>表示遵循Netscape的Cookie规范，<span class="number">1</span>表示遵循W3C的RFC <span class="number">2109</span>规范</span><br><span class="line"></span><br><span class="line">由上面的表我们大致的了解下字段的含义啊，可能一些字段没有点出来，但是够用了，上图中有http，应该是http-only。用不上也就暂时不管了。</span><br><span class="line"></span><br><span class="line">应用：python+requests去处理接口--cookies(防止丢失)</span><br><span class="line">--------------------------------------</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8-*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests,json</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">renren_login</span>():</span><br><span class="line">    url=<span class="string">&#x27;http://&#x27;</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    headers = &#123;&#125;</span><br><span class="line">    r = requests.post(url=url, headers=headers, data=data)</span><br><span class="line">    cookies_file=requests.utils.dict_from_cookiejar(r.cookies)    <span class="comment"># 将cookiejar转化为字典</span></span><br><span class="line">    json.dump(cookies_file,<span class="built_in">open</span>(<span class="string">&#x27;renren_cookies&#x27;</span>,<span class="string">&#x27;w&#x27;</span>))            <span class="comment">#  用json.dump写到文件中</span></span><br><span class="line">    <span class="keyword">return</span> r.cookies</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">up_files</span>():</span><br><span class="line">    url=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    headers = &#123;&#125;</span><br><span class="line">    files=&#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;1.jpg&#x27;</span>,<span class="built_in">open</span>(<span class="string">&#x27;C:\\1.jpg&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>),<span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">    cookies=json.load(<span class="built_in">open</span>(<span class="string">&#x27;renren_cookies&#x27;</span>,<span class="string">&#x27;r&#x27;</span>))    <span class="comment"># 读取文件中的cookies</span></span><br><span class="line">    <span class="comment"># 此处有个问题:&quot;dict转为cookiesjar时候,cookie中有个字段是重复的,因此字典中就少了一个key值&quot;</span></span><br><span class="line">  dict_cookiesjar=requests.utils.cookiejar_from_dict(cookies,cookiejar=<span class="literal">None</span>,overwrite=<span class="literal">True</span>)</span><br><span class="line">    r = requests.post(url=url,headers=headers,data=data,cookies=cookies,files=files)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line">up_files()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>分析一下：dict_from_cookiejar方法去转存cookie的时候，他只保留了name和value，其他的字段没有考虑在内，所以原来同名的cookie会被去重，那么我们想要保存cookie到文件里怎么办？那么就重新设计一种方式去存，因为我们现在知道cookie都有哪些字段了，我们需要什么，我们就存什么，上示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8-*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests,json</span><br><span class="line"><span class="keyword">from</span> requests.cookies <span class="keyword">import</span> RequestsCookieJar,create_cookie</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法有很多，可以选择把requests.utils.dict_from_cookiejar方法重写一下 改成list，</span></span><br><span class="line"><span class="comment"># 要点是要保证数据的唯一性，list可重复，还有就是每一位都是一个tuple，</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_from_cookiejar</span>(<span class="params">cj</span>):</span><br><span class="line">    cookie_list = <span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> cookie <span class="keyword">in</span> cj:</span><br><span class="line">        <span class="comment"># 可以根据需求去保存cookie的特征值</span></span><br><span class="line">        cookie_list.append((cookie.name, cookie.value, cookie.path))   </span><br><span class="line">    <span class="keyword">return</span> cookie_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去加载文件中list，核心代码是create_cookie:回给人多cookie对象的参数去实例化</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reload_cookie_from_file</span>(<span class="params">cookiejar=<span class="literal">None</span>, overwrite=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">if</span> cookiejar <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        cookiejar = RequestsCookieJar()</span><br><span class="line">    names_from_jar = [cookie.name <span class="keyword">for</span> cookie <span class="keyword">in</span> cookiejar]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;cookie_file&quot;</span>, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> cf:</span><br><span class="line">        <span class="keyword">for</span> c_ <span class="keyword">in</span> cf:</span><br><span class="line">            c_ = <span class="built_in">str</span>(c_).strip().split(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> overwrite <span class="keyword">or</span> (c_[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> names_from_jar):</span><br><span class="line">                <span class="comment"># 根据保存的重新读取 并实例化为cookie</span></span><br><span class="line">                cookiejar.set_cookie(create_cookie(c_[<span class="number">0</span>], c_[<span class="number">1</span>], path=c_[<span class="number">2</span>]))   </span><br><span class="line">    <span class="keyword">return</span> cookiejar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把接口获取的cookies转化为list，保存到文件中</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">renren_login_for_dump</span>():</span><br><span class="line">    url=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    headers = &#123;&#125;</span><br><span class="line">    r = requests.post(url=url, headers=headers, data=data)</span><br><span class="line">    cookies_file=list_from_cookiejar(r.cookies)  <span class="comment">#将cookiejar转化为二位数组</span></span><br><span class="line">    <span class="built_in">print</span> cookies_file</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;cookie_file&quot;</span>, <span class="string">&quot;w+&quot;</span>) <span class="keyword">as</span> cf:</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> cookies_file:</span><br><span class="line">            cf.write(<span class="built_in">str</span>(c[<span class="number">0</span>]+<span class="string">&quot;=&quot;</span>+c[<span class="number">1</span>]+<span class="string">&quot;=&quot;</span>+ c[<span class="number">2</span>]) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        cf.flush()</span><br><span class="line">    <span class="comment"># return r.cookies</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接调用方法就可以使用了，没必要使用json去dump和reload</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">up_files_with_cookie</span>():</span><br><span class="line">    url=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    headers = &#123;&#125;</span><br><span class="line">    files=&#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;1.jpg&#x27;</span>,<span class="built_in">open</span>(<span class="string">&#x27;C:\\1.jpg&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>),<span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">    cookies=reload_cookie_from_file()</span><br><span class="line">    r = requests.post(url=url,headers=headers,data=data,cookies=cookies,files=files)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># print reload_cookie_from_file()</span></span><br><span class="line">up_files_with_cookie()</span><br></pre></td></tr></table></figure>

<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>1.对操作的对象要有特征上的认识；</p>
<p>2.一些问题一般都在官方文档和源码里给出了，需要去探索和发现；</p>
<blockquote>
<p><strong>版权声明：</strong>如无特殊说明，文章均为<a target="_blank" rel="noopener" href="https://www.h3blog.com/">何三笔记</a>原创，转载请注明出处</p>
<p><strong>本文链接：</strong><a target="_blank" rel="noopener" href="https://www.h3blog.com/article/392/">https://www.h3blog.com/article/392/</a></p>
</blockquote>
<h1 id="python爬虫（3）——cookie与requests库"><a href="#python爬虫（3）——cookie与requests库" class="headerlink" title="python爬虫（3）——cookie与requests库"></a>python爬虫（3）——cookie与requests库</h1><h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a><a href="#" title="cookie"></a>cookie</h2><p>在网站中，http请求是无状态的。也就是说即使第一次和服务器连接后并且登录成功后，第二次请求服务器依然不能知道当前请求是哪个用户。cookie 的出现就是为了解决这个问题，第一次登录后服务器返回一些数据（cookie）给浏览器，然后浏览器保存在本地，当该用户发送第二次请求的时候，就会自动的把上次请求存储的 cookie 数据自动的携带给服务器，服务器通过浏览器携带的数据就能判断当前用户是哪个了。cookie 存储的数据量有限，不同的浏览器有不同的存储大小，但一般不超过 4KB。因此使用 cookie 只能存储一些小量的数据。<br>cookie的一般格式如下：<br><code>Set-Cookie: NAME=VALUE；Expires/Max-age=DATE；Path=PATH；Domain=DOMAIN_NAME；SECURE</code><br>参数的描述如下表：</p>
<p>参数名</p>
<p>参数描述</p>
<p>NAME</p>
<p>cookie的名字</p>
<p>VALUE</p>
<p>cookie的值</p>
<p>Expires</p>
<p>cookie的过期时间</p>
<p>Path</p>
<p>cookie作用的路径</p>
<p>Domain</p>
<p>cookie作用的域名</p>
<p>SECURE</p>
<p>是否只在https协议下起作用</p>
<p>浏览器保存了cookie，后面每次访问时就方便，如果要用代码来向那些需要登录才能访问的（进行更多操作）网站，就需要把cookie信息传给目标服务器，登录说白了也就是要有cookie信息。要获取cookie信息，首先第一想法就是直接去网站上登录，然后按F12，就能找到cookie信息，以人人网（访问演员大鹏主页，需要登录才能访问）为例子：</p>
<p>python</p>
<pre><code>from urllib import request,parse
#先注释掉cookie
headers=&#123;&#39;user-agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)\
         AppleWebKit/537.36 (KHTML, like Gecko) \
         Chrome/83.0.4103.116 Safari/537.36 Edg/83.0.478.58&#39;,
         # &#39;Cookie&#39;: &#39;ick_login=0ddad9f3-7fa0-4787-b916-5248ea8bb154; anonymid=kca04u42-rmbvi0; depovince=GW; _r01_=1; JSESSIONID=abchsJm52fkNjfdE5xImx; taihe_bi_sdk_uid=15a8a286885699bb6771e6212cc23aa5; taihe_bi_sdk_session=d83833b4a0fb72a6a466205c9329e993; ick=07bea91b-c6d1-4955-ad33-0980db50a672; t=c2a3a8d10309229b0555eb589c8482575; societyguester=c2a3a8d10309229b0555eb589c8482575; id=974715915; xnsid=dd9ddee7; XNESSESSIONID=6c76a75ff812; WebOnLineNotice_974715915=1; ver=7.0; loginfrom=null; jebe_key=060c174f-c2df-4669-9a2c-584b47a0e4a8%7C032338e00e79b21248aaa07a19d3e44d%7C1594009812653%7C1%7C1594009810029; jebe_key=060c174f-c2df-4669-9a2c-584b47a0e4a8%7C032338e00e79b21248aaa07a19d3e44d%7C1594009812653%7C1%7C1594009810031; wp_fold=0; jebecookies=ba0612a2-0ce7-4a4d-95d1-1f71f38ee8ce|||||&#39;
    &#125;
url=&quot;http://www.renren.com/880151247/profile&quot;
req = request.Request(url ,headers=headers)
resp = request.urlopen(req)
with open(&#39;result.html&#39;,&#39;w&#39;,encoding = &#39;utf-8&#39;) as f:
    f.writelines(resp.read().decode(&#39;utf-8&#39;))
</code></pre>
<p>运行代码，会生成一个html文件，我们用浏览器打开它，发现结果如下：  </p>
<p><img src="https://image.resetran.top/bolg_images/1594010413908.jpg"></p>
<p>这并不是我们想要的页面，然后将上面的代码中cookie部分取消注释，再运行，打开result.html：  </p>
<p><img src="https://image.resetran.top/bolg_images/1594010616018.jpg"></p>
<p>可以看到出现了我们想要的页面！这就很好的体现出cookie的作用。</p>
<h2 id="http-cookiejar模块"><a href="#http-cookiejar模块" class="headerlink" title="http.cookiejar模块"></a><a href="#" title="http.cookiejar模块"></a>http.cookiejar模块</h2><p>上面介绍了一种可行的方法，不过我写爬虫不就是为了提高效率嘛，你还每次让我手动去复制粘贴cookie信息？再想想，我们能通过请求获得状态码之类的网站信息，cookie也能用同样的方式获得呀，那不就完事了。这里我们的http.cookiejar模块就闪亮登场了，该模块主要的类有 CookieJar、FileCookieJar、MozillaCookieJar、LWPCookieJar。这四个类的作用分别如下：</p>
<p>类名</p>
<p>描述</p>
<p>CookieJar</p>
<p>管理 HTTP cookie 值、存储 HTTP 请求生成的 cookie、向传出的 HTTP 请求添加 cookie 的对象。整个 cookie 都存储在内存中，对 CookieJar 实例进行垃圾回收后 cookie也将丢失。</p>
<p>FileCookieJar (filename,delayload=None,policy=None)</p>
<p>从 CookieJar 派生而来，用创建 FileCookieJar 实例，检索 cookie 信息并将 cookie 存储到文件中。filename 是存储cookie的文件名。delayload 为 True 时支持延迟访问访问文件，即只有在需要时才读取文件或在文件中存储数据。</p>
<p>MozillaCookieJar (filename,delayload=None,policy=None)</p>
<p>从 FileCookieJar 派生而来，创建与 Mozilla 浏览器 cookies.txt 兼容的 FileCookieJar 实例。</p>
<p>LWPCookieJar (filename,delayload=None,policy=None)</p>
<p>从 FileCookieJar 派生而来，创建与 libwww-perl 标准的 Set-Cookie3 文件格式兼容的 FileCookieJar 实例。</p>
<p>再用该模块实现访问人人网大鹏的主页：</p>
<p>python</p>
<pre><code>from urllib import request,parse
from http.cookiejar import CookieJar

headers=&#123;&#39;user-agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)\
         AppleWebKit/537.36 (KHTML, like Gecko) \
         Chrome/83.0.4103.116 Safari/537.36 Edg/83.0.478.58&#39;
    &#125;
#创造一个opener
def get_opener():
    cookjar=CookieJar()
    handler=request.HTTPCookieProcessor(cookjar)
    opener=request.build_opener(handler)
    return opener

#利用创造好的opener发送请求，请求返回的数据中就有cookie信息，他会保存到cookiejar类中
def save_cookie(opener):
    login_url=&quot;http://www.renren.com/PLogin.do&quot;
    #账号密码不能泄露啊😂😂😂
    data=&#123;&quot;email&quot;:&quot;##########&quot;,
          &#39;password&#39;:&quot;##########&quot;
        &#125;
    res = request.Request(login_url,data= parse.urlencode(data).encode(&#39;utf8&#39;),method=&#39;POST&#39;,headers=headers)
    opener.open(res)

#访问大鹏主页
def get_profile(opener):
    url=&quot;http://www.renren.com/880151247/profile&quot;
    res=request.Request(url,headers=headers)
    resp=opener.open(res)
    with open(&#39;result2.html&#39;,&#39;w&#39;,encoding = &#39;utf-8&#39;) as f:
        f.writelines(resp.read().decode(&#39;utf-8&#39;))

if __name__==&#39;__main__&#39;:
    opener=get_opener()
    save_cookie(opener)
    get_profile(opener)
</code></pre>
<p>结果如下：  </p>
<p><img src="https://image.resetran.top/bolg_images/1594037026162.jpg"></p>
<h2 id="cookie的保存与加载"><a href="#cookie的保存与加载" class="headerlink" title="cookie的保存与加载"></a><a href="#" title="cookie的保存与加载"></a>cookie的保存与加载</h2><h3 id="保存到本地"><a href="#保存到本地" class="headerlink" title="保存到本地"></a><a href="#" title="保存到本地"></a>保存到本地</h3><p>保存 cookie 到本地，可以使用 MozillaCookieJar 的 save 方法，并且需要指定一个文件名。这里我们再用**<a target="_blank" rel="noopener" href="http://httpbin.org/">http://httpbin.org</a>**这个网站来演示，该网站可以让我们自定义该网站的cookie信息，话不多说，先上图；<br>主页是这样的，先点击cookie选项:  </p>
<p><img src="https://image.resetran.top/bolg_images/1594041407808.jpg"></p>
<p>跟着步骤来：  </p>
<p><img src="https://image.resetran.top/bolg_images/1594041429670.jpg"></p>
<p>设置好后是这样：</p>
<p><img src="https://image.resetran.top/bolg_images/1594041443340.jpg"></p>
<p>如果想重新设置，可以先清除该网站的cookie数据哦，怎么清除点<a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/09ea3ede592a34c0afde394e.html">它</a></p>
<p>python</p>
<pre><code>from urllib import request,parse
from http.cookiejar import MozillaCookieJar

headers=&#123;&#39;user-agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)\
         AppleWebKit/537.36 (KHTML, like Gecko) \
         Chrome/83.0.4103.116 Safari/537.36 Edg/83.0.478.58&#39;
&#125;
url=&quot;http://httpbin.org/cookies/set/python/spyder&quot;
    
cookiejar=MozillaCookieJar()
handler=request.HTTPCookieProcessor(cookiejar)    
opener=request.build_opener(handler)
req=request.Request(url,headers=headers)
opener.open(req)
cookiejar.save(&#39;cookie.txt&#39;,ignore_discard=True,ignore_expires=True)
#由于该网站的cookie不会可能会过期或者被丢弃，所以这里得设置一下参数
#ignore_discard 的意思是即使 cookies 将被丢弃也将它保存下来
#ignore_expires 的意思是如果 cookies 已经过期也将它保存并且文件已存在时将覆盖
with open(&#39;cookie.txt&#39;,&#39;r&#39;) as f:
    print(f.read())
</code></pre>
<p>可以看到已经生成了cookie.txt文件，里边就存储着cookie信息，结果如下（出现这种格式应该是save方法的问题）：  </p>
<p><img src="https://image.resetran.top/bolg_images/1594041878454.jpg"></p>
<h3 id="加载cookie信息"><a href="#加载cookie信息" class="headerlink" title="加载cookie信息"></a><a href="#" title="加载cookie信息"></a>加载cookie信息</h3><p>然后再来看看加载cookie信息，跟上边很类似：</p>
<p>python</p>
<pre><code>headers=&#123;&#39;user-agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)\
         AppleWebKit/537.36 (KHTML, like Gecko) \
         Chrome/83.0.4103.116 Safari/537.36 Edg/83.0.478.58&#39;
&#125;
url=&quot;http://httpbin.org/cookies&quot;
cookiejar=MozillaCookieJar()
cookiejar.load(&#39;cookie.txt&#39;,ignore_discard=True,ignore_expires=True)
handler=request.HTTPCookieProcessor(cookiejar)    
opener=request.build_opener(handler)
req=request.Request(url,headers=headers)
resp=opener.open(req)
print(resp.read().decode())
</code></pre>
<p>输出：  </p>
<p><img src="https://image.resetran.top/bolg_images/1594043291139.jpg"></p>
<h2 id="Requests库"><a href="#Requests库" class="headerlink" title="Requests库"></a><a href="#" title="Requests库"></a>Requests库</h2><p>虽然 Python 的标准库中 urllib 模块已经包含了平常我们使用的大多数功能，但是它的 API使用起来让人感觉不太好，而 Requests 宣传是 “HTTP for Humans”，说明使用更简洁方便。接下来我们就用requests库来实现和urllib同样的功能</p>
<h3 id="发送get请求"><a href="#发送get请求" class="headerlink" title="发送get请求"></a><a href="#" title="发送get请求"></a>发送get请求</h3><p>requests库发送get请求直接使用get方法即可，返回的是一个response对象，如果想添加 headers，可以传入 headers 参数来增加请求头中的 headers 信息。如果要将参数放在 url 中传递，可以利用params 参数</p>
<p>python</p>
<pre><code>import requests
url=&quot;https://www.baidu.com&quot;
headers=&#123;&#39;user-agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)\
         AppleWebKit/537.36 (KHTML, like Gecko) \
         Chrome/83.0.4103.116 Safari/537.36 Edg/83.0.478.58&#39;
&#125;
kw=&#123;&#39;wd&#39;:&#39;高考&#39;&#125;
# params 是一个字典或者字符串的查询参数，字典自动转换为 url 编码，不需要urlencode()
response = requests.get(url, params = kw, headers = hea
ders)
# 查看响应内容，response.text 返回的是 Unicode 格式的数据(python 会利用自己猜测的编码方式解码，可能会产生乱码的问题)
print(response.text)
# 查看响应头部字符编码
print(response.encoding)
# python 会根据网页内容来得到一个字符编码
print(response.apparent_encoding)
# 如果 response.text 乱码了，可以先设置
response.encoding= response.apparent_encoding
# 查看响应内容，response.content 返回的字节流 bytes 数据
print(response.content)
print(response.content .decode(&#39;utf-8&#39;))
# 查看完整 url 地址
print(response.url)
# 查看响应码
print(response.status_code)
#如果网页返回的是 json，那么可以通过 response.json()转换为 dict 或者 list
print(response.json())
</code></pre>
<h3 id="发送-POST-请求"><a href="#发送-POST-请求" class="headerlink" title="发送 POST 请求"></a><a href="#" title="发送 POST 请求"></a>发送 POST 请求</h3><p>最基本的 POST 请求可以使用 post 方法，传入 data 数据（这时候就不要再使用 urlencode 进行编码了，直接传入一个字典进去就可以了）。返回的也是response对象，可以进行的操作同上。比如请求拉勾网的数据的代码：</p>
<p>python</p>
<pre><code>import requests

params = &#123;&#39;px&#39;: &#39;default&#39;,
          &#39;city&#39;: &#39;北京&#39;,
          &#39;needAddtionalResult&#39;: &#39;false&#39;&#125;
data = &#123;&#39;first&#39;: &#39;true&#39;,
        &#39;pn&#39;: 1,
        &#39;kd&#39;: &#39;python&#39;&#125;
headers = &#123;&#39;Referer&#39;: &quot;https://www.lagou.com/jobs/list_python&quot;,
           &#39;Cookie&#39;: &#39;JSEIONID=ABAAABA9B2BCC46&#39;,
           &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)&#39;&#125;
url = &#39;https://www.lagou.com/jobs/list_python#filterBox&#39;
response = requests.post(url,
                         params=params,
                         headers=headers,
                         data=data,
                         timeout=5)
response.encoding = &#39;UTF-8&#39;
print(response.text)
</code></pre>
<h3 id="使用代理"><a href="#使用代理" class="headerlink" title="使用代理"></a><a href="#" title="使用代理"></a>使用代理</h3><p>使用 requests 添加代理也非常简单，只要在请求的方法中（比如 get 或者 post）传递 proxies参数即可（挂了科学上网软件的最好先关一下，我就因为没关被坑惨了）：</p>
<p>python</p>
<pre><code>import requests

url = &#39;http://www.httpbin.org/ip&#39;
proxy = &#123;
    &#39;http&#39;: &#39;161.35.110.112:3128&#39;
&#125;
resp_1 = requests.get(url, timeout=5)
print(resp_1.text)
resp_2 = requests.get(url, proxies=proxy, timeout=5)
print(resp_2.text)
</code></pre>
<p>输出如下：  </p>
<p><img src="https://image.resetran.top/bolg_images/1594091758109.jpg"></p>
<h3 id="使用requests-session保存cookie"><a href="#使用requests-session保存cookie" class="headerlink" title="使用requests.session保存cookie"></a><a href="#" title="使用requests.session保存cookie"></a>使用requests.session保存cookie</h3><p>之前使用 urllib 库，是可以使用 opener 发送多个请求，多个请求之间是可以共享 cookie 的。那么如果使用 requests，也要达到共享 cookie 的目的，那么可以使用 requests 库给我们提供的 session 对象。注意，这里的 session 不是 web 开发中的那个 session，这个地方只是一个会话的对象而已。还是以登录人人网为例，使用 requests 来实现。示例代码如下：</p>
<p>python</p>
<pre><code>import requests

url = &quot;http://www.renren.com/PLogin.do&quot;
data = &#123;&quot;email&quot;: &quot;970138074@qq.com&quot;, &#39;password&#39;: &quot;pythonspider&quot;&#125;
headers = &#123;
    &#39;UserAgent&#39;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36&quot;
&#125;
# 登录
session = requests.session()
session.post(url, data=data, headers=headers)
# 访问大鹏个人中心
resp = session.get(&#39;http://www.renren.com/880151247/profile&#39;)
print(resp.status_code)
#输出：
200
</code></pre>
<h2 id="总结一下"><a href="#总结一下" class="headerlink" title="总结一下"></a><a href="#" title="总结一下"></a>总结一下</h2><p>个人感觉使用方面确实requests库比起urllib的API接口要舒适许多，所以以后能用requests俺就不用urllib🤣🤣🤣</p>
<hr>
<p><em>文章作者:</em> <a target="_blank" rel="noopener" href="https://resetran.top/about">Reset Ran</a></p>
<p><em>文章链接:</em> <a target="_blank" rel="noopener" href="https://resetran.top/python-spyder-3/">https://resetran.top/python-spyder-3/</a></p>
<h1 id="mitmproxy抓包-Python实时生成接口自动化用例（三）"><a href="#mitmproxy抓包-Python实时生成接口自动化用例（三）" class="headerlink" title="mitmproxy抓包 | Python实时生成接口自动化用例（三）"></a>mitmproxy抓包 | Python实时生成接口自动化用例（三）</h1><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1956164">https://cloud.tencent.com/developer/article/1956164</a></p>
<p>发布于2022-03-14 14:27:15阅读 1.2K0</p>
<p>[抓包工具mitmproxy环境配置使用（一）](<a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=Mzg5MzI1NTI0Mw==&amp;mid=2247485040&amp;idx=1&amp;sn=2bec68eb00d7dfb084b696b9216430e1&amp;chksm=c030ed54f747644204b510c43220af53cf549833f2f83b57ffa1ce0ff3b252f139b6c1a4b575&amp;scene=21">http://mp.weixin.qq.com/s?__biz=Mzg5MzI1NTI0Mw==&amp;mid=2247485040&amp;idx=1&amp;sn=2bec68eb00d7dfb084b696b9216430e1&amp;chksm=c030ed54f747644204b510c43220af53cf549833f2f83b57ffa1ce0ff3b252f139b6c1a4b575&amp;scene=21</a> target=)</p>
<p>[抓包工具mitmproxy | mitmweb基本用法（二）](<a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=Mzg5MzI1NTI0Mw==&amp;mid=2247486272&amp;idx=1&amp;sn=f79e2f7ee08e749139d93d9c0935edb2&amp;chksm=c030e064f7476972ac283a84b238cede0652249b698c9e794ea7a82a7a841c3cc57c00f99e60&amp;scene=21">http://mp.weixin.qq.com/s?__biz=Mzg5MzI1NTI0Mw==&amp;mid=2247486272&amp;idx=1&amp;sn=f79e2f7ee08e749139d93d9c0935edb2&amp;chksm=c030e064f7476972ac283a84b238cede0652249b698c9e794ea7a82a7a841c3cc57c00f99e60&amp;scene=21</a> target=)</p>
<p>前面已经给大家分享了mitmproxy的环境配置和基本使用，文章浏览量很高，相信对抓包工具感兴趣的朋友，已经熟练运用起来了。</p>
<p>这期给大家分享下mitmproxy结合python脚本对抓包信息的（请求头、请求头、接口url、请求方式、响应头、响应体等）进行监控，实时抓取数据并存储到文件里，实现了接口自动化测试中的接口用例设计自动化，无需花费大量时间手动编写接口用例，大大提高了工作效率，相信很多人看到这里已经欣喜难耐了，一定要关注下方公众号，有更多精彩技术文章。</p>
<p>一、mitmproxy介绍</p>
<p>mitmproxy是Python编写的一款功能完善的代理工具，mitmproxy是一款支持拦截HTTP和HTTPS请求和响应并即时修改它们的交互式中间人代理工具。最强大之处在于对python脚步的支持，它提供了Python API给开发者编写插件用来自定义对流量进行处理和修改，可以在python代码中直接处理数据包。</p>
<p>二、mitmproxy的功能：</p>
<p>1、拦截HTTP和HTTPS请求和响应</p>
<p>2、保存HTTP会话并进行分析</p>
<p>3、模拟客户端发起请求，模拟<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/cvm?from=10680">服务器</a>端返回响应</p>
<p>4、利用反向代理将流量转发给指定的服务器</p>
<p>5、支持Mac和linux上的透明代理</p>
<p>6、利用Python对HTTP请求与响应进行实时处理</p>
<p>三、环境</p>
<p>1、部署python环境</p>
<p>2、安装mitmproxy，pip install mitmproxy</p>
<p>mitmproxy提供了HTTP、WebSocket、TCP事件。本次只考虑HTTP事件，HTTP事件提供一些api，详情参考<a target="_blank" rel="noopener" href="https://docs.mitmproxy.org/stable/addons-events/">https://docs.mitmproxy.org/stable/addons-events/</a></p>
<p>四、启动web抓包，抓包信息全量存入文件</p>
<p>1、cmd下执行：</p>
<p>mitmweb -p 8889 -w C:\Users\la\Desktop\test.txt</p>
<p>启动抓包服务，实时抓取全量数据存入文件</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-6525263/06eb6a1201bb48bfce6332b69be19668.png?imageView2/2/w/2560/h/7000"></p>
<p>2、自动打开web抓包页面</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-6525263/b042cf1d8c2cab85742fc8e74c7e04fb.png?imageView2/2/w/2560/h/7000"></p>
<p>3、边抓包，边将抓包的全量信息实时存入文件</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-6525263/e5ea9fcdda825a408600a7e4f89c2a58.png?imageView2/2/w/2560/h/7000"></p>
<p>五、python脚本</p>
<p>编写python脚本，获取接口（请求头、请求头、接口url、请求方式、响应头、响应体等）需要的信息，脚本变更，保存后实时同步，无需重新启动抓包服务</p>
<pre><code>import mitmproxy.http
import csv,json
</code></pre>
<p>​<br>    class CaptureInfoWriteFile:<br>        def <strong>init</strong>(self):<br>            pass</p>
<pre><code>    def request(self, flow: mitmproxy.http.HTTPFlow):
        flow_request = flow.request  # 获取请求对象
        self.url = flow_request.url  # 接口url
        self.host = flow_request.host  # 域名
        self.path = flow_request.path  # 接口地址
        self.method = flow_request.method  # 请求方式
        self.content = flow_request.content
        self.timestamp_start = flow_request.timestamp_start  # 请求开始时间戳
        self.timestamp_end = flow_request.timestamp_end  # 请求结束时间戳
        self.header = flow_request.headers  # 请求头
        self.text = flow_request.text  # 请求体

    def response(self, flow: mitmproxy.http.HTTPFlow):
        flow_response = flow.response  # 获取响应对象
        response_status_code = flow_response.status_code  # 响应状态码
        response_text = flow_response.text  # 响应体
        response_content = flow_response.content
        response_timestamp_start = flow_response.timestamp_start  # 响应开始时间
        response_timestamp_end = flow_response.timestamp_end  # 响应结束时间
        response_header = flow_response.headers  # 响应头

        with open(r&#39;C:\Users\xia\Desktop\test15.csv&#39;, &#39;a+&#39;,newline=&#39;&#39;) as f:
            f_csv = csv.writer(f)
            f_csv.writerows([[self.url, self.host, self.path, self.method, self.header, self.text, response_status_code, response_header, response_text]])
</code></pre>
<p>​<br>    addons = [CaptureInfoWriteFile()]</p>
<p>复制</p>
<p>六、启动web抓包，调用python脚本</p>
<p>1、cmd下执行：</p>
<p>mitmweb -p 8889 -s C:\Users\xia\Desktop\test_maplocal.py</p>
<p>启动抓包服务，实时监控获取抓包信息</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-6525263/93c3002ba703dd54eb7310433ab38a2d.png?imageView2/2/w/2560/h/7000"></p>
<p>2、自动打开web抓包页面</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-6525263/877ee8d87a735ff2a62f6a8a2909124d.png?imageView2/2/w/2560/h/7000"></p>
<p>3、边抓包，边调用python脚本，将获取的抓包信息实时存储到文件里，方便接口自动测试使用</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-6525263/79c8edfc6957f80f93a41dd283e8913b.png?imageView2/2/w/2560/h/7000"></p>
<h1 id="使用HTTPX和asyncio的Python异步HTTP请求"><a href="#使用HTTPX和asyncio的Python异步HTTP请求" class="headerlink" title="使用HTTPX和asyncio的Python异步HTTP请求"></a>使用HTTPX和asyncio的Python异步HTTP请求</h1><p>异步代码已经日益成为Python开发的主流。随着<a href="https://link.juejin.cn/?target=https://docs.python.org/3/library/asyncio.html" title="https://docs.python.org/3/library/asyncio.html">asyncio</a>成为标准库的一部分和许多第三方软件包提供与之兼容的功能，这种模式不会很快消失。</p>
<p>让我们来看看如何使用<a href="https://link.juejin.cn/?target=https://www.python-httpx.org/" title="https://www.python-httpx.org/">HTTPX</a>库来利用它来进行异步的HTTP请求，这是非阻塞代码最常见的用例之一。</p>
<h2 id="什么是非阻塞代码？"><a href="#什么是非阻塞代码？" class="headerlink" title="什么是非阻塞代码？"></a>什么是非阻塞代码？</h2><p>你可能会听到 “异步”、”非阻塞 “或 “并发 “这样的术语，并对它们的含义感到有点困惑。根据这个<a href="https://link.juejin.cn/?target=https://realpython.com/async-io-python/%23where-does-async-io-fit-in" title="https://realpython.com/async-io-python/#where-does-async-io-fit-in">更详细的教程</a>，其中两个主要属性是。</p>
<ul>
<li>  异步程序能够在等待其最终结果时 “暂停”，让其他程序在此期间运行。</li>
<li>  <a href="https://link.juejin.cn/?target=https://realpython.com/python-async-features/" title="https://realpython.com/python-async-features/">异步代码</a>，通过上述机制，促进了并发执行。换句话说，异步代码给人以并发的外观和感觉。</li>
</ul>
<p>因此，异步代码是可以在等待结果时挂起的代码，以便让其他代码在这期间运行。它不会 “阻止 “其他代码的运行，所以我们可以称它为 “非阻塞 “代码。</p>
<p><a href="https://link.juejin.cn/?target=https://docs.python.org/3/library/asyncio.html" title="https://docs.python.org/3/library/asyncio.html">asyncio库为</a>Python开发者提供了各种工具来实现这一点，而aiohttp为HTTP请求提供了更具体的功能。HTTP请求是非常适合异步性的一个典型例子，因为它们涉及到等待服务器的响应，在这期间，让其他代码运行是很方便和有效的。</p>
<h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><p>在我们开始之前，请确保设置好你的Python环境。如果你需要一些帮助，请按照<a href="https://link.juejin.cn/?target=https://www.twilio.com/docs/guides/how-to-set-up-your-python-and-flask-development-environment%23create-a-simple-flask-application" title="https://www.twilio.com/docs/guides/how-to-set-up-your-python-and-flask-development-environment#create-a-simple-flask-application">本指南</a>中的virtualenv部分进行。如果你有多个项目在同一台机器上运行，让一切正常工作，尤其是<a href="https://link.juejin.cn/?target=https://www.twilio.com/docs/guides/how-to-set-up-your-python-and-flask-development-environment%23start-a-new-project-with-virtualenv" title="https://www.twilio.com/docs/guides/how-to-set-up-your-python-and-flask-development-environment#start-a-new-project-with-virtualenv">虚拟环境</a>对于隔离你的依赖关系非常重要。你至少需要Python 3.7或更高的版本，以便运行这篇文章中的代码。</p>
<p>现在你的环境已经设置好了，你将需要安装<a href="https://link.juejin.cn/?target=https://www.python-httpx.org/" title="https://www.python-httpx.org/">HTTPX</a>库，用于发出请求，包括异步和同步请求，我们将对此进行比较。在激活你的虚拟环境后，用下面的命令安装它。</p>
<pre><code>pip install httpx==0.18.2
复制代码
</code></pre>
<p>有了这个，你应该准备好继续写一些代码了。</p>
<h2 id="用HTTPX做一个HTTP请求"><a href="#用HTTPX做一个HTTP请求" class="headerlink" title="用HTTPX做一个HTTP请求"></a>用HTTPX做一个HTTP请求</h2><p>让我们开始使用HTTPX做一个单一的GET请求，以证明关键字<code>async</code> 和<code>await</code> 工作。我们将使用<a href="https://link.juejin.cn/?target=https://pokeapi.co/docs/v2" title="https://pokeapi.co/docs/v2">口袋妖怪API</a>作为一个例子，所以让我们开始尝试获取与传说中的第151个口袋妖怪<a href="https://link.juejin.cn/?target=https://www.youtube.com/watch?v=d--IkSWn7j8" title="https://www.youtube.com/watch?v=d--IkSWn7j8">Mew</a>相关的<a href="https://link.juejin.cn/?target=https://pokeapi.co/api/v2/pokemon/151" title="https://pokeapi.co/api/v2/pokemon/151">数据</a>。</p>
<p>运行下面的Python代码，你应该看到名字 “Mew “被打印到终端。</p>
<pre><code>import asyncio
import httpx
</code></pre>
<p>​<br>    async def main():<br>        pokemon_url = ‘<a target="_blank" rel="noopener" href="https://pokeapi.co/api/v2/pokemon/151&#39;">https://pokeapi.co/api/v2/pokemon/151&#39;</a></p>
<pre><code>    async with httpx.AsyncClient() as client:

        resp = await client.get(pokemon_url)

        pokemon = resp.json()
        print(pokemon[&#39;name&#39;])

asyncio.run(main())
复制代码
</code></pre>
<p>在这段代码中，我们正在创建一个叫做main的程序，我们用<a href="https://link.juejin.cn/?target=https://realpython.com/async-io-python/%23the-event-loop-and-asynciorun" title="https://realpython.com/async-io-python/#the-event-loop-and-asynciorun">asyncio事件循环来</a>运行它。在这里，我们正在向Pokemon API发出请求，然后等待响应。</p>
<p>这个<code>async</code> 关键字基本上告诉 Python 解释器，我们定义的 coroutine 应该用一个事件循环异步运行。<code>await</code> 关键字将控制权传回给事件循环，暂停周围的 coroutine 的执行，让事件循环运行其他的东西，直到被 “等待 “的结果被返回。</p>
<h2 id="提出大量的请求"><a href="#提出大量的请求" class="headerlink" title="提出大量的请求"></a>提出大量的请求</h2><p>提出一个单一的异步HTTP请求是很好的，因为我们可以让事件循环在其他任务上工作，而不是在等待响应时阻塞整个线程。这个功能在尝试进行大量请求时才真正发挥了作用。让我们通过执行与之前相同的请求来证明这一点，不过是为了<a href="https://link.juejin.cn/?target=https://www.youtube.com/watch?v=xMk8wuw7nek" title="https://www.youtube.com/watch?v=xMk8wuw7nek">所有150个原始小精灵</a>。</p>
<p>让我们把之前的请求代码放在一个循环中，更新哪个小精灵的数据正在被请求，并对每个请求使用<code>await</code> 。</p>
<pre><code>import asyncio
import httpx
import time

start_time = time.time()
</code></pre>
<p>​<br>    async def main():</p>
<pre><code>    async with httpx.AsyncClient() as client:

        for number in range(1, 151):
            pokemon_url = f&#39;https://pokeapi.co/api/v2/pokemon/&#123;number&#125;&#39;

            resp = await client.get(pokemon_url)
            pokemon = resp.json()
            print(pokemon[&#39;name&#39;])

asyncio.run(main())
print(&quot;--- %s seconds ---&quot; % (time.time() - start_time))
复制代码
</code></pre>
<p>这一次，我们也要测量整个过程需要多少时间。如果你在你的Python shell中运行这段代码，你应该看到类似下面的东西打印到你的终端。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95ca9d5244284571bf641cf18a8bc842~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp"></p>
<p>对于150个请求来说，8.6秒似乎很不错，但我们并没有什么可以比较的。让我们试着用同步方式完成同样的事情。</p>
<h2 id="比较同步请求的速度"><a href="#比较同步请求的速度" class="headerlink" title="比较同步请求的速度"></a>比较同步请求的速度</h2><p>要像以前一样打印前150个小精灵，但没有async/await，运行以下代码。</p>
<pre><code>import httpx
import time

start_time = time.time()
client = httpx.Client()

for number in range(1, 151):
    url = f&#39;https://pokeapi.co/api/v2/pokemon/&#123;number&#125;&#39;
    resp = client.get(url)
    pokemon = resp.json()
    print(pokemon[&#39;name&#39;])

print(&quot;--- %s seconds ---&quot; % (time.time() - start_time))
复制代码
</code></pre>
<p>你应该看到相同的输出，但运行时间不同。</p>
<p><img src="https://twilio-cms-prod.s3.amazonaws.com/images/tgB7FXmp5hTizg2kWabrersfXc28plHdKdNCPAp1CBwaEc.width-500.png"></p>
<p>尽管它看起来并没有比以前慢多少。这很可能是因为HTTPX<code>Client</code> 所做的连接池正在做大部分的重活。然而，我们可以利用更多的<code>asyncio</code> 功能来获得比这更好的性能。</p>
<h2 id="利用asyncio来提高性能"><a href="#利用asyncio来提高性能" class="headerlink" title="利用asyncio来提高性能"></a>利用asyncio来提高性能</h2><p><code>asyncio</code> 提供了更多的工具，可以大大改善我们的整体性能。在原来的例子中，我们在每个单独的HTTP请求后使用await，这不是很理想。我们可以将所有这些请求作为<code>asyncio</code> 任务 “并发 “运行，然后在最后使用<code>asyncio.ensure_future</code> 和<code>asyncio.gather</code> 检查结果。</p>
<p>如果实际发出请求的代码被分解成自己的coroutine函数，我们可以创建一个任务列表，由每个请求的 <a href="https://link.juejin.cn/?target=https://docs.python.org/3/library/asyncio-future.html" title="https://docs.python.org/3/library/asyncio-future.html">期货</a>组成。然后，我们可以将这个列表解压到一个 <a href="https://link.juejin.cn/?target=https://docs.python.org/3/library/asyncio-task.html%23id6" title="https://docs.python.org/3/library/asyncio-task.html#id6">集合</a>调用，将它们全部运行起来。当我们<code>await</code> 这个调用到<code>asyncio.gather</code> ，我们将得到一个所有被传入的期货的可迭代文件，保持它们在列表中的顺序。这样，我们就只用了一次<code>await</code> 。</p>
<p>为了看看我们实现这个方法后会发生什么，请运行以下代码。</p>
<pre><code>import asyncio
import httpx
import time
</code></pre>
<p>​<br>    start_time = time.time()</p>
<p>​<br>    async def get_pokemon(client, url):<br>            resp = await client.get(url)<br>            pokemon = resp.json()</p>
<pre><code>        return pokemon[&#39;name&#39;]
</code></pre>
<p>​<br>    async def main():</p>
<pre><code>    async with httpx.AsyncClient() as client:

        tasks = []
        for number in range(1, 151):
            url = f&#39;https://pokeapi.co/api/v2/pokemon/&#123;number&#125;&#39;
            tasks.append(asyncio.ensure_future(get_pokemon(client, url)))

        original_pokemon = await asyncio.gather(*tasks)
        for pokemon in original_pokemon:
            print(pokemon)

asyncio.run(main())
print(&quot;--- %s seconds ---&quot; % (time.time() - start_time))
复制代码
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d526a952e2a4fc595bbc19eee9e0891~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp"></p>
<p>这使我们的时间降到了150个HTTP请求的1.54秒！这比以前有很大的进步。这比之前的例子有了很大的进步。这是完全无阻塞的，所以运行所有150个请求的总时间将大致等于最长请求的运行时间。确切的数字会因你的互联网连接而有所不同。</p>
<h2 id="结论性的想法"><a href="#结论性的想法" class="headerlink" title="结论性的想法"></a>结论性的想法</h2><p>正如你所看到的，使用像HTTPX这样的库来重新思考你进行HTTP请求的方式，可以为你的代码增加一个巨大的性能提升，并在进行大量的请求时节省大量的时间。</p>
<p>在这个教程中，我们只是触及了用asyncio可以做什么的表面，但我希望这能使你开始进入异步Python世界的旅程更容易一些。如果你对另一个类似的异步 HTTP 请求库感兴趣，可以<a href="https://link.juejin.cn/?target=https://www.twilio.com/blog/asynchronous-http-requests-in-python-with-aiohttp" title="https://www.twilio.com/blog/asynchronous-http-requests-in-python-with-aiohttp">看看我写的关于 aiohttp 的另一篇博文。</a></p>
<ul>
<li>  <a href="https://link.juejin.cn/?target=http://www.twitch.tv/sagnewshreds">https://link.juejin.cn?target=http%3A%2F%2Fwww.twitch.tv%2Fsagnewshreds</a> “<a target="_blank" rel="noopener" href="http://www.twitch.tv/sagnewshreds&quot;">http://www.twitch.tv/sagnewshreds&quot;</a>)</li>
</ul>
<h1 id="RuntimeError：无法从正在运行的事件循环中调用asyncio-run（）"><a href="#RuntimeError：无法从正在运行的事件循环中调用asyncio-run（）" class="headerlink" title="RuntimeError：无法从正在运行的事件循环中调用asyncio.run（）"></a><a href="#">RuntimeError：无法从正在运行的事件循环中调用asyncio.run（）</a></h1><p><a href="/sf/users/552672361/" title="Jav*_*tin">Jav*_*tin</a> 4 <a target="_blank" rel="noopener" href="https://qa.1r1g.com/sf/ask/tagged/python/">python</a> <a target="_blank" rel="noopener" href="https://qa.1r1g.com/sf/ask/tagged/python-asyncio/">python-asyncio</a> <a target="_blank" rel="noopener" href="https://qa.1r1g.com/sf/ask/tagged/python-3.7/">python-3.7</a></p>
<p>我正在尝试为websockets客户端学习异步。我尝试的每一段代码都会出现以下错误：</p>
<blockquote>
<p>RuntimeError：无法从正在运行的事件循环中调用asyncio.run（）</p>
</blockquote>
<p>我尝试了最简单的代码，它始终会给出RuntimeError。我尝试再次安装完整的anaconda发行版，等等，但找不到问题所在。</p>
<p>我正在将Spyder 3.3.3与Python 3.7.3结合使用</p>
<p>可以正常工作的代码示例：</p>
<pre><code>import asyncio

async def main():
    print(&#39;hello&#39;)
    await asyncio.sleep(1)
    print(&#39;world&#39;)

asyncio.run(main())
</code></pre>
<p>错误信息：</p>
<pre><code>File &quot;C:\Users\jmart\Anaconda3\lib\site-packages\spyder_kernels\customize\spydercustomize.py&quot;, line 786, in runfile
  execfile(filename, namespace)
File &quot;C:\Users\jmart\Anaconda3\lib\site-packages\spyder_kernels\customize\spydercustomize.py&quot;, line 110, in execfile
  exec(compile(f.read(), filename, &#39;exec&#39;), namespace)
File &quot;C:/Users/jmart/Documents/asynk2.py&quot;, line 8, in &lt;module&gt;
  asyncio.run(main())
File &quot;C:\Users\jmart\Anaconda3\lib\asyncio\runners.py&quot;, line 34, in run
  &quot;asyncio.run() cannot be called from a running event loop&quot;)
RuntimeError: asyncio.run() cannot be called from a running event loop
</code></pre>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E9%99%A4%E8%AE%B0%E5%BD%95/" rel="tag"># 问题排除记录</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/17/HTML%E5%9F%BA%E7%A1%80/" rel="prev" title="HTML基础">
      <i class="fa fa-chevron-left"></i> HTML基础
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/08/17/python-web-flask-1/" rel="next" title="python-web-flask-1">
      python-web-flask-1 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E7%9A%84%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4"><span class="nav-text">python虚拟环境的常见命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#notes"><span class="nav-text">notes</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Python-flask-flask-script-%E6%8A%A5%E9%94%99%EF%BC%9AModuleNotFoundError-No-module-named-%E2%80%98flask-compat%E2%80%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="nav-text">Python flask flask_script 报错：ModuleNotFoundError: No module named ‘flask._compat’解决方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Error-Could-not-locate-a-Flask-application-You-did-not-provide-the-%E2%80%9CFLASK-APP%E2%80%9C-environment-variabl"><span class="nav-text">Error: Could not locate a Flask application. You did not provide the “FLASK_APP“ environment variabl</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%A5%E9%94%99%E8%AF%A6%E6%83%85"><span class="nav-text">报错详情</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="nav-text">解决办法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B2%A1%E6%9C%89%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A01%EF%BC%9A%E5%8F%AF%E8%83%BD%E6%98%AF%E6%96%87%E4%BB%B6%E5%9C%A8%E7%9B%AE%E5%BD%95%E4%B8%AD%E7%9A%84%E4%BD%8D%E7%BD%AE%E4%B8%8D%E5%AF%B9"><span class="nav-text">没有解决问题原因1：可能是文件在目录中的位置不对</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B2%A1%E6%9C%89%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A02%EF%BC%9A%E5%8F%AF%E8%83%BD%E6%98%AFflask%E6%8C%87%E4%BB%A4%E6%97%B6%E6%89%93%E5%BC%80%E7%9A%84%E4%BD%8D%E7%BD%AE%E4%B8%8D%E5%AF%B9"><span class="nav-text">没有解决问题原因2：可能是flask指令时打开的位置不对</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E3%80%90%E5%B7%B2%E8%A7%A3%E5%86%B3%E3%80%91Python-3-10-%E4%BD%BF%E7%94%A8pdf2docx%E6%8A%A5%E9%94%99ImportError-cannot-import-name-%E2%80%98Iterable%E2%80%98-from-%E2%80%98collections%E2%80%98%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="nav-text">【已解决】Python 3.10 使用pdf2docx报错ImportError:cannot import name ‘Iterable‘ from ‘collections‘的解决办法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#cannot-import-name-%E2%80%98Mapping%E2%80%98-from-%E2%80%98collections%E2%80%98"><span class="nav-text">cannot import name ‘Mapping‘ from ‘collections‘</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AttributeError-module-%E2%80%98collections%E2%80%98-has-no-attribute-%E2%80%98MutableMapping%E2%80%98"><span class="nav-text">AttributeError: module ‘collections‘ has no attribute ‘MutableMapping‘</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Content-Type%E6%A0%87%E5%A4%B4%E6%9C%AA%E5%9C%A8Tornado%E4%B8%AD%E8%AE%BE%E7%BD%AE"><span class="nav-text">Content-Type标头未在Tornado中设置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#python%E6%8A%A5-DeprecationWarning-%E2%80%9C-coroutine%E2%80%9D-decorator-%E2%80%A6-use-%E2%80%9Casync-def%E2%80%9D-%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="nav-text">python报 DeprecationWarning: “@coroutine” decorator …. use “async def” 解决办法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DeprecationWarning-There-is-no-current-event-loop"><span class="nav-text">DeprecationWarning: There is no current event loop</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Django%E7%AE%A1%E7%90%86%E5%91%98%E5%9C%A8%E5%90%8E%E5%8F%B0%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%B6%E5%87%BA%E7%8E%B0no-such-table-main-auth-user-old%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="nav-text">使用Django管理员在后台添加数据库时出现no such table: main.auth_user__old解决方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TemplateDoesNotExist-at"><span class="nav-text">TemplateDoesNotExist at&#x2F;****</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Windows-%E4%B8%8B%E5%AE%89%E8%A3%85"><span class="nav-text">Windows 下安装</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pip-install-%E6%8A%A5%E9%94%99Caused-by-SSLError-SSLEOFError-8-%E2%80%98EOF-occurred-in-violation-of-protocol"><span class="nav-text">pip install 报错Caused by SSLError(SSLEOFError(8, ‘EOF occurred in violation of protocol</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pip-install-weditor%E5%AE%89%E8%A3%85%E5%87%BA%E9%94%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="nav-text">pip install weditor安装出错解决方法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%8F%E7%B1%B3%E6%89%8B%E6%9C%BAUiautomator%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98-uiautomator2-GatewayError%E6%8A%A5%E9%94%99"><span class="nav-text">小米手机Uiautomator启动失败问题 uiautomator2.GatewayError报错</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#uiautomator2-%E4%BD%BF%E7%94%A8Python%E6%B5%8B%E8%AF%95-Android%E5%BA%94%E7%94%A8"><span class="nav-text">uiautomator2 使用Python测试 Android应用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#requests%E5%BA%93%E4%B8%AD%E4%BD%BF%E7%94%A8response-json-%E6%8A%A5%E9%94%99%EF%BC%9Ajson-decoder-JSONDecodeError-Expecting-value"><span class="nav-text">requests库中使用response.json()报错：json.decoder.JSONDecodeError: Expecting value</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#python%E4%B8%AD%E4%B8%80%E6%AC%A1%E6%9B%BF%E6%8D%A2%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E5%A4%9A%E4%B8%AA%E5%AD%97%E7%AC%A6-%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82"><span class="nav-text">python中一次替换字符串中的多个字符[通俗易懂]</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B6%85%E5%BC%BA%E5%8F%8D%E7%88%AC%E8%99%AB%E6%96%B9%E6%A1%88%EF%BC%81Requests-%E4%BB%80%E4%B9%88%E7%9A%84%E9%80%9A%E9%80%9A%E7%88%AC%E4%B8%8D%E4%BA%86"><span class="nav-text">超强反爬虫方案！Requests 什么的通通爬不了</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E7%88%AC%E8%99%AB"><span class="nav-text">反爬虫</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%AA%E6%96%BD"><span class="nav-text">措施</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%8F%8D%E7%88%AC%E4%B9%8B-%E5%B0%81%E7%A6%81ip"><span class="nav-text">反反爬之 封禁ip</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%8F%8D%E7%88%AC%E4%B9%8B-%E8%B4%A6%E5%8F%B7%E9%99%90%E5%88%B6"><span class="nav-text">反反爬之 账号限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="nav-text">总结：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#python%E7%88%AC%E8%99%AB%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94cookie%E4%B8%8Erequests%E5%BA%93"><span class="nav-text">python爬虫（3）——cookie与requests库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#cookie"><span class="nav-text">cookie</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#http-cookiejar%E6%A8%A1%E5%9D%97"><span class="nav-text">http.cookiejar模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cookie%E7%9A%84%E4%BF%9D%E5%AD%98%E4%B8%8E%E5%8A%A0%E8%BD%BD"><span class="nav-text">cookie的保存与加载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E5%88%B0%E6%9C%AC%E5%9C%B0"><span class="nav-text">保存到本地</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BDcookie%E4%BF%A1%E6%81%AF"><span class="nav-text">加载cookie信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Requests%E5%BA%93"><span class="nav-text">Requests库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E9%80%81get%E8%AF%B7%E6%B1%82"><span class="nav-text">发送get请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E9%80%81-POST-%E8%AF%B7%E6%B1%82"><span class="nav-text">发送 POST 请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86"><span class="nav-text">使用代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8requests-session%E4%BF%9D%E5%AD%98cookie"><span class="nav-text">使用requests.session保存cookie</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B"><span class="nav-text">总结一下</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mitmproxy%E6%8A%93%E5%8C%85-Python%E5%AE%9E%E6%97%B6%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E8%87%AA%E5%8A%A8%E5%8C%96%E7%94%A8%E4%BE%8B%EF%BC%88%E4%B8%89%EF%BC%89"><span class="nav-text">mitmproxy抓包 | Python实时生成接口自动化用例（三）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8HTTPX%E5%92%8Casyncio%E7%9A%84Python%E5%BC%82%E6%AD%A5HTTP%E8%AF%B7%E6%B1%82"><span class="nav-text">使用HTTPX和asyncio的Python异步HTTP请求</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%9D%9E%E9%98%BB%E5%A1%9E%E4%BB%A3%E7%A0%81%EF%BC%9F"><span class="nav-text">什么是非阻塞代码？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE"><span class="nav-text">设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8HTTPX%E5%81%9A%E4%B8%80%E4%B8%AAHTTP%E8%AF%B7%E6%B1%82"><span class="nav-text">用HTTPX做一个HTTP请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%90%E5%87%BA%E5%A4%A7%E9%87%8F%E7%9A%84%E8%AF%B7%E6%B1%82"><span class="nav-text">提出大量的请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AF%94%E8%BE%83%E5%90%8C%E6%AD%A5%E8%AF%B7%E6%B1%82%E7%9A%84%E9%80%9F%E5%BA%A6"><span class="nav-text">比较同步请求的速度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A9%E7%94%A8asyncio%E6%9D%A5%E6%8F%90%E9%AB%98%E6%80%A7%E8%83%BD"><span class="nav-text">利用asyncio来提高性能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA%E6%80%A7%E7%9A%84%E6%83%B3%E6%B3%95"><span class="nav-text">结论性的想法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RuntimeError%EF%BC%9A%E6%97%A0%E6%B3%95%E4%BB%8E%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E4%B8%AD%E8%B0%83%E7%94%A8asyncio-run%EF%BC%88%EF%BC%89"><span class="nav-text">RuntimeError：无法从正在运行的事件循环中调用asyncio.run（）</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Private</p>
  <div class="site-description" itemprop="description">程序语言记录</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Private</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
